<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>BLAST FURNACE SYSTEM - ROURKELA STEEL PLANT</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¥</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style> 
        /* CSS Variables */
        :root { 
            --bg-primary: #FFFFFF;
            --bg-secondary: #F5F5F5;
            --bg-tertiary: #EEEEEE;
            --bg-quaternary: #E0E0E0;
            --bg-quinary: #BDBDBD;
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-tertiary: #BDBDBD;
            --text-inverted: #FFFFFF;
            --header-bg: #1976D2;
            --header-text: #FFFFFF;
            --button-bg: #1976D2;
            --button-fg: #FFFFFF;
            --statusbar-bg: #F5F5F5;
            --statusbar-fg: #757575;
            --shift-a-color: #4CAF50;
            --shift-b-color: #2196F3;
            --shift-c-color: #FF9800;
            --entry-field-color: #1976D2;
            --calculated-field-color: #F44336;
            --primary-color: #1976D2;
            --primary-dark: #0D47A1;
            --accent-color: #FF4081;
            --card-bg: #FFFFFF;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.1);
            --input-shadow: 0 0 0 2px rgba(25, 118, 210, 0.5);
            --chart-hot-metal: #F44336;
            --chart-coke-rate: #2196F3;
            --chart-nc-rate: #4CAF50;
            --chart-pci-rate: #FF9800;
            --chart-spo2-rate: #9C27B0;
            --desktop-font-size: 14px;
            --desktop-header-font: 16px;
            --desktop-title-font: 18px;
            --desktop-input-font: 14px;
            --desktop-table-font: 13px;
            --desktop-padding: 8px;
            --desktop-margin: 8px;
            --icon-size: 20px;
            --grid-gap: 12px;
            --mobile-font-size: 14px;
            --mobile-header-font: 16px;
            --mobile-title-font: 18px;
            --mobile-input-font: 14px;
            --mobile-table-font: 12px;
            --mobile-padding: 6px;
            --mobile-margin: 6px;
            --mobile-icon-size: 18px;
            --theme-transition: all 0.3s ease;
        } 
        
        /* Dark Mode */
        [data-theme="dark"] { 
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --bg-tertiary: #2D2D2D;
            --bg-quaternary: #3D3D3D;
            --bg-quinary: #4D4D4D;
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --text-tertiary: #808080;
            --text-inverted: #121212;
            --header-bg: #1E88E5;
            --card-bg: #1E1E1E;
            --card-shadow: 0 2px 4px rgba(0,0,0,0.3);
            --input-shadow: 0 0 0 2px rgba(30, 136, 229, 0.5);
            --chart-hot-metal: #EF5350;
            --chart-coke-rate: #42A5F5;
            --chart-nc-rate: #66BB6A;
            --chart-pci-rate: #FFB74D;
            --chart-spo2-rate: #AB47BC;
        }
        
        /* Enhanced theme transitions */
        body {
            transition: var(--theme-transition);
        }
        
        .md-app-bar, .md-nav, .md-bottom-nav, .auth-card, .table-container, 
        .results-item, .params-item, .hearth-calculator, .chart-container {
            transition: var(--theme-transition);
        }
        
        /* Theme selector styles */
        .theme-selector {
            position: relative;
            display: inline-block;
        }
        
        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            min-width: 180px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 8px;
        }
        
        .theme-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .theme-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: var(--text-primary);
            min-height: 44px;
        }
        
        .theme-option:hover {
            background-color: var(--bg-tertiary);
        }
        
        .theme-option.active {
            background-color: var(--bg-quaternary);
            font-weight: 500;
        }
        
        .theme-option i {
            margin-right: 12px;
            font-size: 20px;
            color: var(--primary-color);
        }
        
        .theme-option.active i {
            color: var(--accent-color);
        }
        
        .theme-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--bg-tertiary);
            margin-left: 8px;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        /* Global Styles */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; 
            font-size: var(--desktop-font-size); 
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: var(--bg-secondary);
            overflow: hidden;
            box-sizing: border-box;
        }
        
        body {
            color: var(--text-primary);
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Material Design Components */
        .md-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 12px;
            height: 32px;
            border-radius: 4px;
            background-color: var(--button-bg);
            color: var(--button-fg);
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            outline: none;
            min-height: 44px;
        }
        
        .md-button:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .md-button:active {
            transform: scale(0.98);
        }
        
        .md-button .material-icons {
            margin-right: 6px;
            font-size: 16px;
        }
        
        .md-button-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            padding: 0;
            min-width: 36px;
        }
        
        .md-button-icon .material-icons {
            margin-right: 0;
        }
        
        /* Ripple effect for touch interactions */
        .md-button, .auth-button {
            position: relative;
            overflow: hidden;
        }
        
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .md-app-bar {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 0 12px;
            display: flex;
            align-items: center;
            height: 56px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
        }
        
        .md-app-bar-title {
            flex: 1;
            font-size: 20px;
            font-weight: 500;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .md-app-bar-title .material-icons {
            margin-right: 10px;
            font-size: 24px;
        }
        
        .md-app-bar-logo {
            width: 36px;
            height: 36px;
            margin-right: 12px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .md-app-bar-actions {
            display: flex;
            align-items: center;
        }
        
        .md-app-bar-actions .md-button-icon {
            margin-left: 6px;
        }
        
        .md-nav {
            background-color: var(--header-bg);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 280px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 8px rgba(0,0,0,0.2);
        }
        
        .md-nav.open {
            transform: translateX(0);
        }
        
        .md-nav-header {
            padding: 12px;
            display: flex;
            align-items: center;
        }
        
        .md-nav-header img {
            width: 40px;
            height: 40px;
            margin-right: 12px;
            border-radius: 4px;
        }
        
        .md-nav-header h3 {
            color: var(--header-text);
            font-size: 18px;
            font-weight: 500;
            margin: 0;
        }
        
        .md-nav-items {
            flex: 1;
            overflow-y: auto;
        }
        
        .md-nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--header-text);
            text-decoration: none;
            transition: background-color 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 44px;
        }
        
        .md-nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .md-nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .md-nav-item:active {
            transform: scale(0.98);
        }
        
        .md-nav-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .md-nav-item:active::after {
            animation: ripple 0.6s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .md-nav-item .material-icons {
            margin-right: 24px;
            font-size: 24px;
        }
        
        .md-nav-item span {
            font-size: 16px;
            font-weight: 500;
        }
        
        .md-bottom-nav {
            background-color: var(--header-bg);
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .md-bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--header-text);
            text-decoration: none;
            padding: 6px 0;
            transition: background-color 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 44px;
        }
        
        .md-bottom-nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .md-bottom-nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .md-bottom-nav-item:active {
            transform: scale(0.98);
        }
        
        .md-bottom-nav-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .md-bottom-nav-item:active::after {
            animation: ripple 0.6s ease-out;
        }
        
        .md-bottom-nav-item .material-icons {
            font-size: 24px;
            margin-bottom: 2px;
        }
        
        .md-bottom-nav-item span {
            font-size: 12px;
            font-weight: 500;
        }
        
        .md-snackbar {
            background-color: #323232;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2), 0 6px 10px rgba(0,0,0,0.2);
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            transition: transform 0.3s ease;
            z-index: 2000;
            display: flex;
            align-items: center;
            max-width: 90%;
        }
        
        .md-snackbar.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .md-snackbar-text {
            flex: 1;
            margin-right: 20px;
        }
        
        .md-snackbar-action {
            color: var(--accent-color);
            text-transform: uppercase;
            font-weight: 500;
            cursor: pointer;
            padding: 6px;
            margin: -6px;
        }
        
        .md-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-primary);
        }
        
        .md-table th {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 8px 10px;
            text-align: left;
            font-weight: 500;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .md-table td {
            padding: 8px 10px;
            border-bottom: 1px solid var(--bg-quaternary);
            font-size: 14px;
            position: relative;
        }
        
        .md-table tr:last-child td {
            border-bottom: none;
        }
        
        .md-table input {
            width: 100%;
            padding: 6px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
            min-height: 44px;
            box-sizing: border-box;
        }
        
        .md-table input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .md-table .calculated {
            background-color: var(--bg-tertiary);
            padding: 6px;
            border-radius: 4px;
            text-align: right;
            font-size: 14px;
            font-weight: 500;
            color: var(--calculated-field-color);
        }
        
        /* Auth Container */
        .auth-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            min-height: 100%;
            min-width: 100%;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            margin: 0;
            overflow: auto;
            box-sizing: border-box;
        }
        
        .auth-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            width: 100%;
            max-width: 400px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .auth-card.hidden {
            display: none;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .logo-img {
            width: 60px;
            height: 60px;
            margin-right: 12px;
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .logo-text {
            flex: 1;
        }
        
        .auth-title {
            color: var(--header-bg);
            margin-bottom: 8px;
            font-size: 20px;
            font-weight: 500;
            text-align: left;
        }
        
        .auth-subtitle {
            color: var(--text-tertiary);
            margin-bottom: 0;
            font-size: 14px;
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 16px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .form-group .input-icon {
            position: absolute;
            left: 12px;
            top: 36px;
            color: var(--text-tertiary);
            font-size: 18px;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.3s, box-shadow 0.3s;
            min-width: 80px;
            min-height: 44px;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            border-color: var(--header-bg);
            outline: none;
            box-shadow: var(--input-shadow);
        }
        
        .auth-button {
            width: 100%;
            padding: 12px;
            background-color: var(--header-bg);
            color: var(--header-text);
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            position: relative;
            overflow: hidden;
        }
        
        .auth-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .auth-button:active {
            transform: translateY(0);
        }
        
        .auth-button i {
            margin-right: 8px;
            font-size: 16px;
        }
        
        .auth-links {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
        }
        
        .auth-links a {
            color: var(--header-bg);
            text-decoration: none;
            font-weight: 500;
            display: inline-block;
            margin: 8px 16px;
            min-height: 44px;
            line-height: 44px;
        }
        
        .auth-links a:hover {
            text-decoration: underline;
        }
        
        .auth-links a i {
            font-size: 16px;
        }
        
        .alert {
            padding: 12px;
            margin-bottom: 16px;
            border-radius: 4px;
            display: none;
            font-size: 14px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-danger {
            background-color: #FFEBEE;
            color: #C62828;
            border: 1px solid #EF9A9A;
        }
        
        .alert-success {
            background-color: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #A5D6A7;
        }
        
        /* Dashboard */
        .dashboard {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            min-height: 100%;
            min-width: 100%;
            height: 100%;
            width: 100%;
            display: none;
            flex-direction: column;
            background-color: var(--bg-secondary);
            margin: 0;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        .dashboard.active {
            display: flex;
        }
        
        .content {
            flex: 1;
            padding: 64px 8px 56px 8px;
            overflow: hidden;
            width: 100%;
            min-height: 0;
            height: calc(100% - 56px - 56px); /* App bar height + status bar height */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        
        .view {
            display: none;
            width: 100%;
            height: 100%;
            flex: 1;
            min-height: 0;
            max-height: 100%;
            overflow: auto;
            box-sizing: border-box;
            background-color: var(--bg-secondary);
        }
        
        .view.active {
            display: flex;
            flex-direction: column;
        }
        
        .view h2 {
            font-size: 18px;
            margin-bottom: 12px;
            padding-bottom: 4px;
            border-bottom: 2px solid var(--header-bg);
            display: flex;
            align-items: center;
            color: var(--text-primary);
            flex-shrink: 0;
        }
        
        .view h2 i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        /* Table Containers */
        .table-container {
            background-color: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--bg-quaternary);
            overflow-x: auto;
            margin-bottom: 12px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            position: relative;
        }
        
        /* Add scroll indicators for tables */
        .table-container::before, .table-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 20px;
            pointer-events: none;
            z-index: 1;
            transition: opacity 0.3s;
        }
        
        .table-container::before {
            left: 0;
            background: linear-gradient(to right, var(--bg-primary), transparent);
            opacity: 0;
        }
        
        .table-container::after {
            right: 0;
            background: linear-gradient(to left, var(--bg-primary), transparent);
            opacity: 1;
        }
        
        .table-container.scroll-left::before {
            opacity: 1;
        }
        
        .table-container.scroll-right::after {
            opacity: 1;
        }
        
        /* Touch scrolling indicator */
        .table-container.scrolling {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        /* Results Items - Modified for 4-column layout */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .results-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
            font-size: 14px;
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: 12px;
            height: 100%;
            box-sizing: border-box;
            min-height: 44px;
        }
        
        .results-label {
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .results-value {
            background-color: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 4px;
            text-align: right;
            font-size: 14px;
            font-weight: 500;
            color: var(--calculated-field-color);
            margin-top: auto;
        }
        
        /* Results Sections */
        .results-section {
            margin-bottom: 16px;
        }
        
        .results-section-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--bg-quaternary);
            display: flex;
            align-items: center;
        }
        
        .results-section-title i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        /* Blast Parameters Items - Modified for 2-column layout */
        .blast-params-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .params-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
            align-items: flex-start;
            font-size: 14px;
            background-color: var(--bg-primary);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--bg-quaternary);
            height: 100%;
            box-sizing: border-box;
            min-height: 44px;
        }
        
        .params-label {
            font-weight: 500;
            width: 100%;
            font-size: 14px;
            display: flex;
            align-items: center;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .params-label i {
            margin-right: 8px;
            color: var(--primary-color);
            font-size: 16px;
        }
        
        .params-input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            color: var(--entry-field-color);
            background-color: var(--bg-primary);
            transition: border-color 0.3s, box-shadow 0.3s;
            min-width: 80px;
            min-height: 44px;
            box-sizing: border-box;
        }
        
        .params-input:focus {
            border-color: var(--header-bg);
            outline: none;
            box-shadow: var(--input-shadow);
        }
        
        .params-value {
            background-color: var(--bg-tertiary);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--bg-quaternary);
            width: 100%;
            text-align: right;
            font-size: 14px;
            font-weight: 500;
            color: var(--calculated-field-color);
            min-height: 44px;
            box-sizing: border-box;
        }
        
        /* Blast Parameters Sections */
        .blast-params-section {
            margin-bottom: 16px;
        }
        
        .blast-params-section-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--bg-quaternary);
            display: flex;
            align-items: center;
        }
        
        .blast-params-section-title i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        /* Shift Production */
        .shift-controls {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .shift-controls label {
            margin-right: 12px;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            color: var(--text-primary);
        }
        
        .shift-controls label i {
            margin-right: 8px;
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .shift-controls select {
            padding: 8px 12px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            width: 180px;
            font-size: 14px;
            font-weight: 500;
            color: var(--entry-field-color);
            background-color: var(--bg-primary);
            min-width: 80px;
            min-height: 44px;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        .shift-legend {
            display: flex;
            margin-top: 12px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            border-radius: 4px;
        }
        
        /* Status Bar */
        .status-bar {
            background-color: var(--statusbar-bg);
            color: var(--statusbar-fg);
            padding: 6px 16px;
            border-top: 1px solid var(--bg-quaternary);
            display: flex;
            align-items: center;
            flex-shrink: 0;
            z-index: 100;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 32px; /* Fixed height */
        }
        
        .status-message {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .status-message i {
            margin-right: 8px;
            color: var(--header-bg);
            font-size: 18px;
        }
        
        .auto-save-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4CAF50;
            margin-left: 8px;
            animation: pulse 1.5s infinite;
        }
        
        .auto-save-indicator.saving {
            background-color: #FF9800;
            animation: none;
        }
        
        .shift-a-row {
            background-color: rgba(76, 175, 80, 0.1) !important;
        }
        
        .shift-b-row {
            background-color: rgba(33, 150, 243, 0.1) !important;
        }
        
        .shift-c-row {
            background-color: rgba(255, 152, 0, 0.1) !important;
        }
        
        .performance-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .performance-good {
            background-color: #4CAF50;
        }
        
        .performance-average {
            background-color: #FFC107;
        }
        
        .performance-poor {
            background-color: #F44336;
        }
        
        /* Hearth Calculator */
        .hearth-calculator {
            background-color: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--bg-quaternary);
            overflow: hidden;
            margin-bottom: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            padding: 16px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }
        
        .hearth-section {
            margin-bottom: 16px;
            min-height: 0;
        }
        
        .hearth-section-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--bg-quaternary);
            display: flex;
            align-items: center;
        }
        
        .hearth-section-title i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .hearth-input-group {
            margin-bottom: 12px;
        }
        
        .hearth-input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .hearth-input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: border 0.3s, box-shadow 0.3s;
            min-width: 80px;
            min-height: 44px;
            box-sizing: border-box;
        }
        
        .hearth-input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }
        
        .hearth-input-group input:disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--bg-quaternary);
            cursor: not-allowed;
        }
        
        .formula-hint {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
            font-style: italic;
        }
        
        .result-highlight {
            font-weight: 500;
            color: var(--accent-color);
            font-size: 16px;
        }
        
        .calculation-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #4CAF50;
            margin-left: 8px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        /* Chart Container */
        .chart-container {
            background-color: var(--bg-primary);
            border-radius: 8px;
            border: 1px solid var(--bg-quaternary);
            padding: 16px;
            margin-bottom: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            height: calc(100% - 40px);
        }
        
        .chart-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-shrink: 0;
        }
        
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .chart-legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .chart-legend-color {
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .chart-filter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-filter select {
            padding: 8px 12px;
            border: 1px solid var(--bg-quinary);
            border-radius: 4px;
            font-size: 14px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-width: 80px;
            min-height: 44px;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }
        
        /* Mobile table improvements */
        @media (max-width: 767px) {
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: 16px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            
            .md-table {
                min-width: 600px; /* Ensure table is scrollable but not too narrow */
            }
            
            .md-table th, .md-table td {
                padding: 8px 6px;
                font-size: 12px;
                white-space: nowrap;
            }
            
            .md-table input {
                font-size: 12px;
                padding: 6px 4px;
                min-width: 60px;
                min-height: 44px;
            }
            
            .md-table .calculated {
                font-size: 12px;
                padding: 6px 4px;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .blast-params-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .calculator-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                padding: 12px;
            }
            
            .md-button {
                height: 48px;
                padding: 0 16px;
                font-size: 16px;
            }
            
            .md-button-icon {
                width: 48px;
                height: 48px;
                min-width: 48px;
            }
            
            .form-group input {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
                min-height: 44px; /* Minimum touch target size */
            }
            
            .params-input, .params-value {
                padding: 12px;
                font-size: 16px;
                min-height: 44px;
            }
            
            .results-value, .params-value {
                padding: 10px;
                font-size: 14px;
            }
            
            .chart-container {
                height: 300px;
                padding: 12px;
                margin-bottom: 16px;
            }
            
            .chart-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .chart-legend {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .chart-legend-item {
                font-size: 12px;
            }
            
            .chart-filter {
                width: 100%;
                justify-content: space-between;
            }
            
            .chart-filter select {
                flex: 1;
                max-width: 180px;
            }
            
            .md-app-bar {
                height: 56px;
                padding: 0 8px;
            }
            
            .md-app-bar-title {
                font-size: 16px;
            }
            
            .md-app-bar-logo {
                width: 32px;
                height: 32px;
            }
            
            .md-bottom-nav {
                height: 64px; /* Slightly taller for better touch */
            }
            
            .md-bottom-nav-item {
                padding: 10px 0;
            }
            
            .md-bottom-nav-item .material-icons {
                font-size: 24px;
            }
            
            .md-bottom-nav-item span {
                font-size: 12px;
            }
            
            .view h2 {
                font-size: 18px;
                margin-bottom: 12px;
                padding-bottom: 6px;
            }
            
            .view h2 i {
                font-size: 20px;
                margin-right: 8px;
            }
            
            .auth-card {
                max-width: 100%;
                padding: 16px;
                margin: 16px;
                border-radius: 12px;
            }
            
            .logo-img {
                width: 50px;
                height: 50px;
            }
            
            .auth-title {
                font-size: 18px;
            }
            
            .auth-subtitle {
                font-size: 13px;
            }
            
            .form-group {
                margin-bottom: 16px;
            }
            
            .auth-button {
                padding: 14px;
                font-size: 16px;
                margin-top: 20px;
            }
            
            .hearth-input-group label {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .hearth-input-group input {
                padding: 12px;
                font-size: 16px;
                min-height: 44px;
            }
            
            .status-bar {
                display: none; /* Hidden on mobile as we have bottom nav */
            }
            
            .md-snackbar {
                bottom: 80px; /* Above bottom navigation */
                left: 16px;
                right: 16px;
                max-width: none;
                border-radius: 8px;
                padding: 14px 16px;
            }
            
            .md-snackbar-text {
                font-size: 14px;
            }
            
            .md-snackbar-action {
                padding: 8px;
                margin: -8px;
            }
            
            .theme-dropdown {
                right: -8px;
                min-width: 160px;
            }
            
            body {
                font-size: 14px;
            }
            
            .content {
                padding: 56px 8px 64px 8px; /* Adjust for app bar and bottom nav */
            }
            
            .results-section-title, .blast-params-section-title, .hearth-section-title {
                font-size: 16px;
                margin-bottom: 10px;
                padding-bottom: 4px;
            }
            
            .results-item, .params-item {
                padding: 16px;
                border-radius: 8px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            
            .shift-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                margin-bottom: 16px;
            }
            
            .shift-controls label {
                margin-right: 0;
                margin-bottom: 4px;
            }
            
            .shift-controls select {
                width: 100%;
                max-width: none;
            }
            
            .shift-legend {
                gap: 8px;
                margin-top: 10px;
            }
            
            .legend-item {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .chart-container {
                height: 250px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .md-app-bar-title {
                font-size: 14px;
            }
            
            .view h2 {
                font-size: 16px;
            }
            
            .view h2 i {
                font-size: 18px;
                margin-right: 6px;
            }
            
            .md-table th, .md-table td {
                padding: 6px 4px;
                font-size: 11px;
            }
            
            .md-table input {
                font-size: 11px;
                padding: 4px;
            }
            
            .theme-dropdown {
                right: -16px;
                min-width: 140px;
            }
        }
        
        @media (min-width: 768px) {
            .md-bottom-nav {
                display: none;
            }
        }
        
        @media (min-width: 992px) {
            .calculator-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1200px) {
            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style> 
</head> 
<body> 
    <!-- Authentication Container --> 
    <div class="auth-container" id="authContainer"> 
        <div class="auth-card" id="loginCard"> 
            <div class="logo-container"> 
                <img src="sailrsp.png" alt="" class="logo-img"> 
                <div class="logo-text"> 
                    <h1 class="auth-title">BLAST FURNACE SYSTEM</h1> 
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div> 
                </div> 
            </div> 
            <div id="loginAlert" class="alert"></div> 
            <form id="loginForm"> 
                <div class="form-group"> 
                    <label for="loginEmail">Email</label> 
                    <i class="fas fa-envelope input-icon"></i> 
                    <input type="email" id="loginEmail" name="email" required> 
                </div> 
                <div class="form-group"> 
                    <label for="loginPassword">Password</label> 
                    <i class="fas fa-lock input-icon"></i> 
                    <input type="password" id="loginPassword" name="password" required> 
                </div> 
                <button type="submit" class="auth-button"> 
                    <i class="fas fa-sign-in-alt"></i> Login 
                </button> 
            </form> 
            <div class="auth-links"> 
                <a href="#" id="showRegister"><i class="fas fa-user-plus"></i> Create Account</a> 
                <a href="#" id="showForgotPassword"><i class="fas fa-key"></i> Forgot Password?</a> 
            </div> 
        </div> 
         
        <div class="auth-card hidden" id="registerCard"> 
            <div class="logo-container"> 
                <img src="sailrsp.png" alt="BF" class="logo-img"> 
                <div class="logo-text"> 
                    <h1 class="auth-title">CREATE ACCOUNT</h1> 
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div> 
                </div> 
            </div> 
            <div id="registerAlert" class="alert"></div> 
            <form id="registerForm"> 
                <div class="form-group"> 
                    <label for="registerName">Full Name</label> 
                    <i class="fas fa-user input-icon"></i> 
                    <input type="text" id="registerName" name="name" required> 
                </div> 
                <div class="form-group"> 
                    <label for="registerEmail">Email</label> 
                    <i class="fas fa-envelope input-icon"></i> 
                    <input type="email" id="registerEmail" name="email" required> 
                </div> 
                <div class="form-group"> 
                    <label for="registerPassword">Password</label> 
                    <i class="fas fa-lock input-icon"></i> 
                    <input type="password" id="registerPassword" name="password" required> 
                </div> 
                <div class="form-group"> 
                    <label for="confirmPassword">Confirm Password</label> 
                    <i class="fas fa-lock input-icon"></i> 
                    <input type="password" id="confirmPassword" name="confirmPassword" required> 
                </div> 
                <button type="submit" class="auth-button"> 
                    <i class="fas fa-user-plus"></i> Register 
                </button> 
            </form> 
            <div class="auth-links"> 
                <a href="#" id="showLoginFromRegister"><i class="fas fa-arrow-left"></i> Back to Login</a> 
            </div> 
        </div> 
         
        <div class="auth-card hidden" id="forgotPasswordCard"> 
            <div class="logo-container"> 
                <img src="sailrsp.png" alt="BF" class="logo-img"> 
                <div class="logo-text"> 
                    <h1 class="auth-title">RESET PASSWORD</h1> 
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div> 
                </div> 
            </div> 
            <div id="forgotPasswordAlert" class="alert"></div> 
            <form id="forgotPasswordForm"> 
                <div class="form-group"> 
                    <label for="forgotEmail">Email</label> 
                    <i class="fas fa-envelope input-icon"></i> 
                    <input type="email" id="forgotEmail" name="email" required> 
                </div> 
                <div class="form-group"> 
                    <label for="newPassword">New Password</label> 
                    <i class="fas fa-lock input-icon"></i> 
                    <input type="password" id="newPassword" name="newPassword" required> 
                </div> 
                <div class="form-group"> 
                    <label for="confirmNewPassword">Confirm New Password</label> 
                    <i class="fas fa-lock input-icon"></i> 
                    <input type="password" id="confirmNewPassword" name="confirmNewPassword" required> 
                </div> 
                <button type="submit" class="auth-button"> 
                    <i class="fas fa-key"></i> Reset Password 
                </button> 
            </form> 
            <div class="auth-links"> 
                <a href="#" id="showLoginFromForgot"><i class="fas fa-arrow-left"></i> Back to Login</a> 
            </div> 
        </div> 
    </div> 
    
    <!-- Dashboard --> 
    <div class="dashboard" id="dashboard"> 
        <div class="md-app-bar"> 
            <button class="md-button md-button-icon" id="menuToggle"> 
                <i class="material-icons">menu</i> 
            </button> 
            <img src="sailrsp.png" alt="" class="md-app-bar-logo">
            <h1 class="md-app-bar-title"> 
            
                    BLAST FURNACE - RSP
            </h1> 
            <div class="md-app-bar-actions"> 
                <button class="md-button md-button-icon reset-btn" onclick="resetToDefault()"> 
                    <i class="material-icons">refresh</i> 
                </button> 
                <button class="md-button md-button-icon save-btn" onclick="setCurrentAsDefault()"> 
                    <i class="material-icons">save</i> 
                </button> 
                <div class="theme-selector">
                    <button class="md-button md-button-icon" id="theme-toggle" onclick="toggleThemeDropdown()"> 
                        <i class="material-icons" id="theme-icon">dark_mode</i> 
                    </button>
                    <div class="theme-dropdown" id="theme-dropdown">
                        <div class="theme-option" id="theme-light" onclick="setTheme('light')">
                            <i class="material-icons">light_mode</i>
                            <span>Light Theme</span>
                        </div>
                        <div class="theme-option" id="theme-dark" onclick="setTheme('dark')">
                            <i class="material-icons">dark_mode</i>
                            <span>Dark Theme</span>
                        </div>
                        <div class="theme-option" id="theme-system" onclick="setTheme('system')">
                            <i class="material-icons">settings_brightness</i>
                            <span>System Theme</span>
                        </div>
                    </div>
                </div>
                <button class="md-button md-button-icon" onclick="logout()"> 
                    <i class="material-icons">logout</i> 
                </button> 
            </div> 
        </div> 
         
        <nav class="md-nav" id="mdNav"> 
            <div class="md-nav-header"> 
                <img src="sailrsp.png" alt="BF"> 
                <h3>Rourkela Steel Plant</h3> 
            </div> 
            <div class="md-nav-items"> 
                <div class="md-nav-item active" onclick="showView('materials')"> 
                    <i class="material-icons">science</i> 
                    <span>Material Properties</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('inputs')"> 
                    <i class="material-icons">scale</i> 
                    <span>Input Quantities</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('results')"> 
                    <i class="material-icons">analytics</i> 
                    <span>Results</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('blast_params')"> 
                    <i class="material-icons">local_fire_department</i> 
                    <span>Blast Parameters</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('shift_production')"> 
                    <i class="material-icons">schedule</i> 
                    <span>Shift Production</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('coke_rate_trend')"> 
                    <i class="material-icons">area_chart</i> 
                    <span>Coke Rate Trend</span> 
                </div> 
                <div class="md-nav-item" onclick="showView('hearth_status')"> 
                    <i class="material-icons">thermostat</i> 
                    <span>Hearth Status</span> 
                </div> 
            </div> 
        </nav> 
         
        <nav class="md-bottom-nav"> 
            <div class="md-bottom-nav-item active" onclick="showView('materials')"> 
                <i class="material-icons">science</i> 
                <span>Materials</span> 
            </div> 
            <div class="md-bottom-nav-item" onclick="showView('inputs')"> 
                <i class="material-icons">scale</i> 
                <span>Inputs</span> 
            </div> 
            <div class="md-bottom-nav-item" onclick="showView('results')"> 
                <i class="material-icons">analytics</i> 
                <span>Results</span> 
            </div> 
            <div class="md-bottom-nav-item" onclick="showView('blast_params')"> 
                <i class="material-icons">local_fire_department</i> 
                <span>Blast</span> 
            </div> 
            <div class="md-bottom-nav-item" onclick="showView('shift_production')"> 
                <i class="material-icons">schedule</i> 
                <span>Shifts</span> 
            </div> 
        </nav> 
         
        <div class="content"> 
            <!-- Material Properties View --> 
            <div id="materials-view" class="view active"> 
                <h2><i class="material-icons">science</i> Material Properties</h2> 
                <div class="table-container"> 
                    <table class="md-table" id="materials-table"> 
                        <thead> 
                            <tr> 
                                <th>Material</th> 
                                <th>C (%)</th> 
                                <th>Moisture (%)</th> 
                                <th>FE (%)</th> 
                                <th>SiO2 (%)</th> 
                                <th>CAO (%)</th> 
                                <th>MGO (%)</th> 
                                <th>AL203 (%)</th> 
                                <th>Density</th> 
                            </tr> 
                        </thead> 
                        <tbody id="materials-tbody"></tbody> 
                    </table> 
                </div> 
            </div> 
             
            <!-- Input Quantities View --> 
            <div id="inputs-view" class="view"> 
                <h2><i class="material-icons">scale</i> Input Quantities</h2> 
                <div class="table-container"> 
                    <table class="md-table" id="inputs-table"> 
                        <thead> 
                            <tr> 
                                <th>Material</th> 
                                <th>Weight (Kg)</th> 
                                <th>Moisture Adj.</th> 
                                <th>Dry Weight</th> 
                                <th>Fe Input</th> 
                                <th>C Input</th> 
                                <th>SiO2 Input</th> 
                                <th>CaO Input</th> 
                                <th>MgO Input</th> 
                                <th>Al2O3 Input</th> 
                            </tr> 
                        </thead> 
                        <tbody id="inputs-tbody"></tbody> 
                    </table> 
                </div> 
            </div> 
             
            <!-- Results View - Modified for 4-column layout --> 
            <div id="results-view" class="view"> 
                <h2><i class="material-icons">analytics</i> Results</h2> 
                
                <div class="results-section">
                    <div class="results-section-title">
                        <i class="material-icons">speed</i> Consumption Rates
                    </div>
                    <div class="results-grid" id="consumption-rates"></div>
                </div>
                
                <div class="results-section">
                    <div class="results-section-title">
                        <i class="material-icons">summarize</i> Input Totals
                    </div>
                    <div class="results-grid" id="input-totals"></div>
                </div>
                
                <div class="results-section">
                    <div class="results-section-title">
                        <i class="material-icons">view_in_ar</i> Volume Calculations
                    </div>
                    <div class="results-grid" id="volume-calculations"></div>
                </div>
                
                <div class="results-section">
                    <div class="results-section-title">
                        <i class="material-icons">insights</i> Production Metrics
                    </div>
                    <div class="results-grid" id="production-metrics"></div>
                </div>
            </div> 
             
            <!-- Blast Parameters View - Modified for 2-column layout --> 
            <div id="blast_params-view" class="view"> 
                <h2><i class="material-icons">local_fire_department</i> Blast Parameters</h2> 
                
                <div class="blast-params-section">
                    <div class="blast-params-section-title">
                        <i class="material-icons">tune</i> Input Parameters
                    </div>
                    <div class="blast-params-grid" id="blast-params"></div>
                </div>
                
                <div class="blast-params-section">
                    <div class="blast-params-section-title">
                        <i class="material-icons">analytics</i> Derived Parameters
                    </div>
                    <div class="blast-params-grid" id="derived-params"></div>
                </div>
            </div> 
             
            <!-- Shift Production View --> 
            <div id="shift_production-view" class="view"> 
                <h2><i class="material-icons">schedule</i> Shift Production</h2> 
                <div class="shift-controls"> 
                    <label for="shift-filter"> 
                        <i class="material-icons">filter_list</i> Filter Shift Columns: 
                    </label> 
                    <select id="shift-filter" onchange="filterShiftColumns()"> 
                        <option value="all">All Shifts</option> 
                        <option value="A">Shift A</option> 
                        <option value="B">Shift B</option> 
                        <option value="C">Shift C</option> 
                    </select> 
                </div> 
                <div class="table-container"> 
                    <table class="md-table" id="shift-table"> 
                        <thead> 
                            <tr> 
                                <th>Hour</th> 
                                <th>Shift</th> 
                                <th>Coke</th> 
                                <th>Sinter</th> 
                                <th>Iron Ore</th> 
                                <th>Pellets</th> 
                                <th>Scraps</th> 
                                <th>Nut Coke</th> 
                                <th>PCI</th> 
                                <th>CB Vol(NmÂ³)</th> 
                                <th>O2 Vol(NmÂ³)</th> 
                                <th>Hot Metal</th> 
                                <th>Coke Rate</th> 
                                <th>NC Rate</th> 
                                <th>PCI Rate</th> 
                                <th>Fuel Rate</th> 
                                <th>SPO2 Rate</th> 
                            </tr> 
                        </thead> 
                        <tbody id="shift-tbody"></tbody> 
                    </table> 
                </div>
                <h3 style="margin-top: 20px; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 2px solid var(--header-bg); display: flex; align-items: center; color: var(--text-primary);"> 
                    <i class="material-icons" style="margin-right: 10px; font-size: 20px;">summarize</i> Shift Report Card 
                </h3> 
                <div class="table-container"> 
                    <table class="md-table" id="shift-report-table"> 
                        <thead> 
                            <tr> 
                                <th>Shift</th> 
                                <th>Total Hot Metal</th> 
                                <th>Avg Coke Rate</th> 
                                <th>Avg NC Rate</th> 
                                <th>Avg PCI Rate</th> 
                                <th>Avg Fuel Rate</th> 
                                <th>Avg SPO2 Rate</th> 
                                <th>Performance</th> 
                            </tr> 
                        </thead> 
                        <tbody id="shift-report-tbody"></tbody> 
                    </table> 
                </div> 
            </div> 
             
            <!-- Coke Rate Trend View --> 
            <div id="coke_rate_trend-view" class="view"> 
                <h2><i class="material-icons">area_chart</i> Coke Rate Trend</h2> 
                <div class="chart-container"> 
                    <div class="chart-controls"> 
                        <div class="chart-legend"> 
                            <div class="chart-legend-item"> 
                                <div class="chart-legend-color" style="background-color: var(--chart-hot-metal);"></div> 
                                <span>Hot Metal</span> 
                            </div> 
                            <div class="chart-legend-item"> 
                                <div class="chart-legend-color" style="background-color: var(--chart-coke-rate);"></div> 
                                <span>Coke Rate</span> 
                            </div> 
                            <div class="chart-legend-item"> 
                                <div class="chart-legend-color" style="background-color: var(--chart-nc-rate);"></div> 
                                <span>NC Rate</span> 
                            </div> 
                            <div class="chart-legend-item"> 
                                <div class="chart-legend-color" style="background-color: var(--chart-pci-rate);"></div> 
                                <span>PCI Rate</span> 
                            </div> 
                            <div class="chart-legend-item"> 
                                <div class="chart-legend-color" style="background-color: var(--chart-spo2-rate);"></div> 
                                <span>SPO2 Rate</span> 
                            </div> 
                        </div> 
                        <div class="chart-filter"> 
                            <label for="trend-shift-filter">Filter Shift:</label> 
                            <select id="trend-shift-filter" onchange="updateTrendChart()"> 
                                <option value="all">All Shifts</option> 
                                <option value="A">Shift A</option> 
                                <option value="B">Shift B</option> 
                                <option value="C">Shift C</option> 
                            </select> 
                        </div> 
                    </div> 
                    <canvas id="trend-chart"></canvas> 
                </div> 
            </div> 
             
            <!-- Hearth Status View --> 
            <div id="hearth_status-view" class="view"> 
                <h2><i class="material-icons">thermostat</i> Hearth Status</h2> 
                <div class="hearth-calculator"> 
                    <div class="calculator-grid"> 
                        <div class="hearth-section"> 
                            <div class="hearth-section-title"> 
                                <i class="material-icons">settings</i> Input Parameters 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="production">Furnace Production (t/day)</label> 
                                <input type="number" id="production" value="6600" oninput="calculateHearth()"> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="slagRate">Slag Rate (kg/THM)</label> 
                                <input type="number" id="slagRate" value="250" oninput="calculateHearth()"> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="hmDensity">Hot Metal Density (t/mÂ³)</label> 
                                <input type="number" id="hmDensity" value="7.2" step="0.1" oninput="calculateHearth()"> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="slagDensity">Slag Density (t/mÂ³)</label> 
                                <input type="number" id="slagDensity" value="2.4" step="0.1" oninput="calculateHearth()"> 
                            </div> 
                        </div> 
                                         
                        <div class="hearth-section"> 
                            <div class="hearth-section-title"> 
                                <i class="material-icons">straighten</i> Hearth Parameters 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="hearthVoidage">Hearth Voidage (%)</label> 
                                <input type="number" id="hearthVoidage" value="20" step="0.1" oninput="calculateHearth()"> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="hearthDiameter">Hearth Diameter (m)</label> 
                                <input type="number" id="hearthDiameter" value="10.8" step="0.1" oninput="calculateHearth()"> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="tuyereHeight">Taphole to Tuyere Height (m)</label> 
                                <input type="number" id="tuyereHeight" value="3.9" step="0.1" oninput="calculateHearth()"> 
                            </div> 
                        </div> 
                                         
                        <div class="hearth-section"> 
                            <div class="hearth-section-title"> 
                                <i class="material-icons">calculate</i> Intermediate Calculations 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="productionRate">Production Rate (t/min)</label> 
                                <input type="text" id="productionRate" disabled> 
                                <div class="formula-hint">Production Ã· (24 Ã— 60)</div> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="ironVolume">Iron Volume (mÂ³/min)</label> 
                                <input type="text" id="ironVolume" disabled> 
                                <div class="formula-hint">Production Rate Ã· Hot Metal Density</div> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="slagVolume">Slag Volume (mÂ³/min)</label> 
                                <input type="text" id="slagVolume" disabled> 
                                <div class="formula-hint">(Slag Rate Ã· 1000 Ã— Production Rate) Ã· Slag Density</div> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="totalLiquidVolume">Total Liquid (mÂ³/min)</label> 
                                <input type="text" id="totalLiquidVolume" disabled> 
                                <div class="formula-hint">Iron Volume + Slag Volume</div> 
                            </div> 
                        </div> 
                                         
                        <div class="hearth-section"> 
                            <div class="hearth-section-title"> 
                                <i class="material-icons">pie_chart</i> Hearth Calculations 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="hearthArea">Hearth Area (mÂ²)</label> 
                                <input type="text" id="hearthArea" disabled> 
                                <div class="formula-hint">Ï€ Ã— (Hearth Diameter Ã· 2)Â²</div> 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="storageCapacity">Storage Capacity (mÂ³)</label> 
                                <input type="text" id="storageCapacity" disabled> 
                                <div class="formula-hint">Hearth Voidage Ã— Area Ã— Height</div> 
                            </div> 
                            <div class="hearth-section-title" style="margin-top: 20px;"> 
                                <i class="material-icons">warning</i> Final Result 
                            </div> 
                            <div class="hearth-input-group"> 
                                <label for="timeToTuyeres">Time Until Liquid Reaches Tuyeres</label> 
                                <input type="text" id="timeToTuyeres" disabled class="result-highlight"> 
                                <div class="formula-hint">Storage Capacity Ã· Total Liquid Accumulation</div> 
                            </div> 
                        </div> 
                    </div> 
                </div> 
            </div> 
        </div> 
         
        <div class="md-snackbar" id="mdSnackbar"> 
            <div class="md-snackbar-text" id="snackbarText">Ready - All calculations are dynamic and automatic</div> 
            <div class="md-snackbar-action" onclick="hideSnackbar()">Dismiss</div> 
        </div> 
         
        <div class="status-bar"> 
            <div class="status-message" id="status-message"> 
                <i class="material-icons">sync</i> Ready - All calculations are dynamic and automatic 
                <span class="calculation-indicator"></span> 
                <span class="auto-save-indicator" id="auto-save-indicator"></span> 
            </div> 
        </div> 
    </div> 
    
    <script> 
        // Global variables
        let trendChart = null;
        let autoSaveTimer = null;
        let currentTheme = 'light';
        
        // Default data
        const initialDefaultData = {
            materials: {
                "COKE": {"C": "86", "Moisture": "4.5", "FE": "0.0", "SiO2": "5.5", "CAO": "0.0", "MGO": "0.0", "AL203": "3.3", "Density": "550"},
                "SINTER": {"C": "0", "Moisture": "0.6", "FE": "53.9", "SiO2": "6.9", "CAO": "10.5", "MGO": "2.3", "AL203": "3.7", "Density": "1800"},
                "ORE": {"C": "0", "Moisture": "4.5", "FE": "62.5", "SiO2": "2.5", "CAO": "0.0", "MGO": "0.0", "AL203": "3.6", "Density": "2200"},
                "PELLETS": {"C": "0", "Moisture": "2.8", "FE": "63.5", "SiO2": "4.0", "CAO": "0.5", "MGO": "0.3", "AL203": "1.4", "Density": "2000"},
                "SCRAP": {"C": "0", "Moisture": "0.5", "FE": "65.0", "SiO2": "0.0", "CAO": "0.0", "MGO": "0.0", "AL203": "0.0", "Density": "1200"},
                "PCI": {"C": "88", "Moisture": "0.0", "FE": "0.0", "SiO2": "4.4", "CAO": "0.0", "MGO": "0.0", "AL203": "2.6", "Density": "550"},
                "NCOKE": {"C": "89", "Moisture": "5.7", "FE": "0.0", "SiO2": "0.0", "CAO": "0.0", "MGO": "0.0", "AL203": "0.0", "Density": "550"}
            },
            inputs: {
                "COKE": {"Weight": "8100"},
                "SINTER": {"Weight": "21100"},
                "ORE": {"Weight": "3200"},
                "PELLETS": {"Weight": "3500"},
                "SCRAP": {"Weight": "600"},
                "PCI": {"Weight": "0"},
                "NCOKE": {"Weight": "0"}
            },
            blastParams: {
                "Blast Volume": "150000",
                "O2 Enrichment": "10500",
                "Blast Temperature": "1150",
                "Top Pressure": "1.87",
                "Blast Pressure": "3.15",
                "DP": "1.28",
                "Humidity": "10.5",
                "Tuyere Velocity": "220",
                "Raceway Flame Temp": "2150",
                "Hot Metal": "1000",
                "Basicity": "1.15",
                "Alâ‚‚Oâ‚ƒ": "4",
                "Nos Of Tuyeres": "20",
                "Gas Generation": "264000",
                "Hearth Area": "55.4",
                "Furnace Resistance": "350",
                "Furnace Permeability": "370",
                "O2 %": "25.0",
                "Silicon%": "1.0",
                "HMT": "1500"
            },
            hearthData: {
                "production": "6600",
                "slagRate": "250",
                "hmDensity": "7.2",
                "slagDensity": "2.4",
                "hearthVoidage": "20",
                "hearthDiameter": "10.8",
                "tuyereHeight": "3.9"
            }
        };
        
        let defaultData = JSON.parse(JSON.stringify(initialDefaultData));
        
        const appData = { 
            materials: JSON.parse(JSON.stringify(initialDefaultData.materials)), 
            inputs: JSON.parse(JSON.stringify(initialDefaultData.inputs)), 
            blastParams: JSON.parse(JSON.stringify(initialDefaultData.blastParams)), 
            shiftMaterialProperties: { 
                "coke": {"moisture": 0, "fe": 0}, 
                "sinter": {"moisture": 0, "fe": 0}, 
                "ironOre": {"moisture": 0, "fe": 0}, 
                "pellets": {"moisture": 0, "fe": 0}, 
                "scraps": {"moisture": 0, "fe": 0}, 
                "nutCoke": {"moisture": 0, "fe": 0}, 
                "pci": {"moisture": 0, "fe": 0} 
            }, 
            shiftData: {}, 
            hearthData: JSON.parse(JSON.stringify(initialDefaultData.hearthData)) 
        }; 
        
        const derivedBlastParams = [ 
            "DP", "Tuyere Velocity", "Raceway Flame Temp", "Hot Metal", "O2 %", "Silicon%",  
            "Furnace Resistance", "Furnace Permeability" 
        ]; 
        
        // Enhanced Theme Management
        function initializeTheme() {
            // Try to get saved theme preference
            const savedTheme = localStorage.getItem('blastFurnaceTheme');
            
            if (savedTheme) {
                currentTheme = savedTheme;
                applyTheme(currentTheme);
            } else {
                // Default to system theme if no saved preference
                currentTheme = 'system';
                applySystemTheme();
            }
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                if (currentTheme === 'system') {
                    applySystemTheme();
                }
            });
            
            // Update theme dropdown active state
            updateThemeDropdownState();
        }
        
        function applyTheme(theme) {
            currentTheme = theme;
            
            if (theme === 'system') {
                applySystemTheme();
            } else {
                document.documentElement.setAttribute('data-theme', theme);
                updateThemeIcon(theme);
                updateThemeIndicator(theme);
            }
            
            // Save theme preference
            localStorage.setItem('blastFurnaceTheme', theme);
            
            // Update user theme preference if logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                currentUser.theme = theme;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || [];
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].theme = theme;
                    localStorage.setItem('blastFurnaceUsers', JSON.stringify(users));
                }
            }
            
            // Update chart if visible
            if (document.getElementById('coke_rate_trend-view').classList.contains('active')) {
                setTimeout(updateTrendChart, 100);
            }
            
            // Show theme change notification
            showThemeChangeNotification(theme);
        }
        
        function applySystemTheme() {
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = systemPrefersDark ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
            updateThemeIndicator('system');
        }
        
        function updateThemeIcon(theme) {
            const themeIcon = document.getElementById('theme-icon');
            if (theme === 'dark') {
                themeIcon.textContent = 'dark_mode';
            } else {
                themeIcon.textContent = 'light_mode';
            }
        }
        
        function updateThemeIndicator(theme) {
            const indicator = document.getElementById('theme-indicator');
            if (indicator) {
                if (theme === 'dark') {
                    indicator.textContent = 'D';
                } else if (theme === 'light') {
                    indicator.textContent = 'L';
                } else {
                    indicator.textContent = 'A'; // A for Auto/System
                }
            }
        }
        
        function updateThemeDropdownState() {
            // Remove active class from all options
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to current theme
            if (currentTheme === 'system') {
                document.getElementById('theme-system').classList.add('active');
            } else {
                document.getElementById(`theme-${currentTheme}`).classList.add('active');
            }
        }
        
        function showThemeChangeNotification(theme) {
            let themeName = theme.charAt(0).toUpperCase() + theme.slice(1);
            if (theme === 'system') {
                themeName = 'System (Auto)';
            }
            showSnackbar(`Switched to ${themeName} theme`);
        }
        
        function toggleThemeDropdown() {
            const dropdown = document.getElementById('theme-dropdown');
            dropdown.classList.toggle('show');
            updateThemeDropdownState();
            
            // Close dropdown when touching outside
            setTimeout(() => {
                document.addEventListener('touchstart', closeThemeDropdownOnTouch, { once: true });
            }, 100);
        }
        
        function closeThemeDropdownOnTouch(event) {
            const themeSelector = document.querySelector('.theme-selector');
            if (!themeSelector.contains(event.target)) {
                document.getElementById('theme-dropdown').classList.remove('show');
            }
        }
        
        function setTheme(theme) {
            applyTheme(theme);
            // Add haptic feedback if available
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
            toggleThemeDropdown(); // Close dropdown after selection
        }
        
        // Close theme dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const themeSelector = document.querySelector('.theme-selector');
            const dropdown = document.getElementById('theme-dropdown');
            
            if (!themeSelector.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        // Navigation
        document.getElementById('menuToggle').addEventListener('click', function() {
            const nav = document.getElementById('mdNav');
            nav.classList.toggle('open');
        });
        
        document.addEventListener('click', function(event) {
            const nav = document.getElementById('mdNav');
            const menuToggle = document.getElementById('menuToggle');
            
            if (!nav.contains(event.target) && !menuToggle.contains(event.target)) {
                nav.classList.remove('open');
            }
        });
        
        // Authentication
        function checkAuth() { 
            const currentUser = JSON.parse(localStorage.getItem('currentUser')); 
            if (currentUser) { 
                document.getElementById('authContainer').style.display = 'none'; 
                document.getElementById('dashboard').classList.add('active'); 
                
                // Apply user's theme preference if available
                if (currentUser.theme) {
                    applyTheme(currentUser.theme);
                }
                
                loadDefaultData();
                initializeApp(); 
            } else { 
                document.getElementById('authContainer').style.display = 'flex'; 
                document.getElementById('dashboard').classList.remove('active'); 
            } 
        }
        
        function logout() { 
            localStorage.removeItem('currentUser'); 
            document.getElementById('authContainer').style.display = 'flex'; 
            document.getElementById('dashboard').classList.remove('active'); 
            document.getElementById('loginForm').reset(); 
            document.getElementById('registerForm').reset(); 
            document.getElementById('forgotPasswordForm').reset(); 
            hideAlerts(); 
            showAuthCard('loginCard'); 
        }
        
        function showAlert(alertId, message, type) { 
            const alertElement = document.getElementById(alertId); 
            alertElement.textContent = message; 
            alertElement.className = `alert alert-${type}`; 
            alertElement.style.display = 'block'; 
            setTimeout(() => { 
                alertElement.style.display = 'none'; 
            }, 3000); 
        }
        
        function hideAlerts() { 
            document.getElementById('loginAlert').style.display = 'none'; 
            document.getElementById('registerAlert').style.display = 'none'; 
            document.getElementById('forgotPasswordAlert').style.display = 'none'; 
        }
        
        function showAuthCard(cardId) { 
            document.getElementById('loginCard').classList.add('hidden'); 
            document.getElementById('registerCard').classList.add('hidden'); 
            document.getElementById('forgotPasswordCard').classList.add('hidden'); 
            document.getElementById(cardId).classList.remove('hidden'); 
            hideAlerts(); 
        }
        
        // Auth event listeners
        document.getElementById('showRegister').addEventListener('click', (e) => { e.preventDefault(); showAuthCard('registerCard'); });
        document.getElementById('showLoginFromRegister').addEventListener('click', (e) => { e.preventDefault(); showAuthCard('loginCard'); });
        document.getElementById('showForgotPassword').addEventListener('click', (e) => { e.preventDefault(); showAuthCard('forgotPasswordCard'); });
        document.getElementById('showLoginFromForgot').addEventListener('click', (e) => { e.preventDefault(); showAuthCard('loginCard'); });
        
        document.getElementById('loginForm').addEventListener('submit', function(e) { 
            e.preventDefault(); 
            const email = document.getElementById('loginEmail').value; 
            const password = document.getElementById('loginPassword').value; 
             
            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || []; 
            const user = users.find(u => u.email === email && u.password === password); 
             
            if (user) { 
                const currentUser = { 
                    id: user.id, 
                    name: user.name, 
                    email: user.email, 
                    theme: user.theme || currentTheme // Use current theme if not set
                }; 
                localStorage.setItem('currentUser', JSON.stringify(currentUser)); 
                 
                // Apply user's theme preference
                if (currentUser.theme) {
                    applyTheme(currentUser.theme);
                }
                
                loadDefaultData();
                showAlert('loginAlert', 'Login successful! Redirecting...', 'success'); 
                setTimeout(() => checkAuth(), 1000); 
            } else { 
                showAlert('loginAlert', 'Invalid email or password', 'danger'); 
            } 
        });
        
        document.getElementById('registerForm').addEventListener('submit', function(e) { 
            e.preventDefault(); 
            const name = document.getElementById('registerName').value; 
            const email = document.getElementById('registerEmail').value; 
            const password = document.getElementById('registerPassword').value; 
            const confirmPassword = document.getElementById('confirmPassword').value; 
             
            if (password !== confirmPassword) { 
                showAlert('registerAlert', 'Passwords do not match', 'danger'); 
                return; 
            } 
             
            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || []; 
             
            if (users.find(u => u.email === email)) { 
                showAlert('registerAlert', 'User with this email already exists', 'danger'); 
                return; 
            } 
             
            const newUser = { 
                id: Date.now(), 
                name, 
                email, 
                password, 
                theme: currentTheme, // Save current theme preference
                createdAt: new Date().toISOString() 
            }; 
             
            users.push(newUser); 
            localStorage.setItem('blastFurnaceUsers', JSON.stringify(users)); 
            showAlert('registerAlert', 'Registration successful! Please login.', 'success'); 
            document.getElementById('registerForm').reset(); 
            setTimeout(() => showAuthCard('loginCard'), 2000); 
        });
        
        document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) { 
            e.preventDefault(); 
            const email = document.getElementById('forgotEmail').value; 
            const newPassword = document.getElementById('newPassword').value; 
            const confirmNewPassword = document.getElementById('confirmNewPassword').value; 
             
            if (newPassword !== confirmNewPassword) { 
                showAlert('forgotPasswordAlert', 'Passwords do not match', 'danger'); 
                return; 
            } 
             
            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || []; 
            const userIndex = users.findIndex(u => u.email === email); 
             
            if (userIndex === -1) { 
                showAlert('forgotPasswordAlert', 'No account found with this email address', 'danger'); 
                return; 
            } 
             
            users[userIndex].password = newPassword; 
            users[userIndex].theme = currentTheme; // Update theme preference
            localStorage.setItem('blastFurnaceUsers', JSON.stringify(users)); 
            showAlert('forgotPasswordAlert', 'Password reset successful! Please login with your new password.', 'success'); 
            document.getElementById('forgotPasswordForm').reset(); 
            setTimeout(() => showAuthCard('loginCard'), 2000); 
        });
        
        // Data management
        function saveAppData() { 
            try { 
                localStorage.setItem('blastFurnaceAppData', JSON.stringify(appData)); 
                updateAutoSaveIndicator('saved'); 
            } catch (e) { 
                console.error('Error saving data:', e); 
                updateAutoSaveIndicator('error'); 
            } 
        }
        
        function loadAppData() { 
            try { 
                const savedData = localStorage.getItem('blastFurnaceAppData'); 
                if (savedData) { 
                    const parsedData = JSON.parse(savedData); 
                    Object.assign(appData.materials, parsedData.materials || {}); 
                    Object.assign(appData.inputs, parsedData.inputs || {}); 
                    Object.assign(appData.blastParams, parsedData.blastParams || {}); 
                    Object.assign(appData.shiftMaterialProperties, parsedData.shiftMaterialProperties || {}); 
                    Object.assign(appData.shiftData, parsedData.shiftData || {}); 
                    Object.assign(appData.hearthData, parsedData.hearthData || {}); 
                } 
            } catch (e) { 
                console.error('Error loading data:', e); 
            } 
        }
        
        function loadDefaultData() {
            const savedDefault = localStorage.getItem('blastFurnaceDefaultData');
            if (savedDefault) {
                defaultData = JSON.parse(savedDefault);
            } else {
                defaultData = JSON.parse(JSON.stringify(initialDefaultData));
            }
        }
        
        function saveDefaultData() {
            const newDefaults = {
                materials: JSON.parse(JSON.stringify(appData.materials)),
                inputs: JSON.parse(JSON.stringify(appData.inputs)),
                blastParams: JSON.parse(JSON.stringify(appData.blastParams)),
                hearthData: JSON.parse(JSON.stringify(appData.hearthData))
            };
            
            defaultData = newDefaults;
            localStorage.setItem('blastFurnaceDefaultData', JSON.stringify(newDefaults));
            updateStatus("New default values saved successfully");
        }
        
        function scheduleAutoSave() { 
            if (autoSaveTimer) clearTimeout(autoSaveTimer); 
            autoSaveTimer = setTimeout(() => saveAppData(), 2000); 
        }
        
        function updateAutoSaveIndicator(status) { 
            const indicator = document.getElementById('auto-save-indicator'); 
            if (indicator) { 
                indicator.className = 'auto-save-indicator'; 
                if (status === 'saving') indicator.classList.add('saving'); 
            } 
        }
        
        // UI Functions
        function showSnackbar(message) {
            const snackbar = document.getElementById('mdSnackbar');
            const snackbarText = document.getElementById('snackbarText');
            
            snackbarText.textContent = message;
            snackbar.classList.add('show');
            
            setTimeout(() => hideSnackbar(), 3000);
        }
        
        function hideSnackbar() {
            document.getElementById('mdSnackbar').classList.remove('show');
        }
        
        function showView(viewName) { 
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active')); 
            document.getElementById(`${viewName}-view`).classList.add('active'); 
             
            document.querySelectorAll('.md-nav-item').forEach(item => item.classList.remove('active')); 
            document.querySelectorAll('.md-bottom-nav-item').forEach(item => item.classList.remove('active'));
            
            const viewMap = {
                'materials': 0, 'inputs': 1, 'results': 2, 'blast_params': 3,
                'shift_production': 4, 'coke_rate_trend': 5, 'hearth_status': 6
            };
            
            const index = viewMap[viewName];
            if (index !== undefined) {
                document.querySelectorAll('.md-nav-item')[index]?.classList.add('active');
                document.querySelectorAll('.md-bottom-nav-item')[index]?.classList.add('active');
            }
             
            document.getElementById('mdNav').classList.remove('open');
            updateStatus(`Switched to ${viewName.replace('_', ' ')} view`); 
             
            if (viewName === 'coke_rate_trend') setTimeout(updateTrendChart, 100); 
        }
        
        function updateStatus(message) { 
            const statusMessage = document.getElementById('status-message'); 
            if (statusMessage) {
                statusMessage.innerHTML = `<i class="material-icons">sync</i> ${message}<span class="calculation-indicator"></span><span class="auto-save-indicator" id="auto-save-indicator"></span>`; 
            }
        }
        
        function resetToDefault() { 
            appData.materials = JSON.parse(JSON.stringify(defaultData.materials)); 
            appData.inputs = JSON.parse(JSON.stringify(defaultData.inputs)); 
            appData.blastParams = JSON.parse(JSON.stringify(defaultData.blastParams)); 
            appData.hearthData = JSON.parse(JSON.stringify(defaultData.hearthData)); 
             
            initializeMaterialsView(); 
            initializeInputsView(); 
            initializeBlastParamsView(); 
            initializeHearthStatusView(); 
             
            calculateInputs(); 
            calculateAll(); 
            calculateBlastParameters(); 
            calculateHearth(); 
             
            if (document.getElementById('coke_rate_trend-view').classList.contains('active')) updateTrendChart(); 
             
            saveAppData(); 
            updateStatus("All values have been reset to default"); 
            showSnackbar("All values have been reset to default");
        }
        
        function setCurrentAsDefault() { 
            saveDefaultData();
            saveAppData(); 
            updateStatus("Current values have been set as new default"); 
            showSnackbar("Current values have been set as new default");
        }
        
        // Initialize views
        function initializeApp() { 
            loadAppData(); 
            updateDateTime(); 
            setInterval(updateDateTime, 1000); 
             
            initializeMaterialsView(); 
            initializeInputsView(); 
            initializeResultsView(); 
            initializeBlastParamsView(); 
            initializeShiftProductionView(); 
            initializeCokeRateTrendView(); 
            initializeHearthStatusView(); 
             
            syncShiftMaterialProperties(); 
            calculateInputs(); 
            calculateAll(); 
            calculateHearth(); 
        }
        
        function updateDateTime() { 
            const now = new Date(); 
            const dateTimeString = now.toLocaleString(); 
            const statusMessage = document.getElementById('status-message');
            if (statusMessage) {
                statusMessage.innerHTML = `<i class="material-icons">schedule</i> ${dateTimeString}<span class="calculation-indicator"></span><span class="auto-save-indicator" id="auto-save-indicator"></span>`; 
            }
        }
        
        // Materials View
        function initializeMaterialsView() { 
            const tbody = document.getElementById('materials-tbody'); 
            tbody.innerHTML = ''; 
             
            const materialsList = Object.keys(appData.materials); 
            const properties = ["C", "Moisture", "FE", "SiO2", "CAO", "MGO", "AL203", "Density"]; 
             
            materialsList.forEach(material => { 
                const row = document.createElement('tr'); 
                 
                const nameCell = document.createElement('td'); 
                nameCell.textContent = material; 
                nameCell.style.fontWeight = '500'; 
                row.appendChild(nameCell); 
                 
                properties.forEach(prop => { 
                    const cell = document.createElement('td'); 
                    const input = document.createElement('input'); 
                    input.type = 'text'; 
                    input.value = appData.materials[material][prop]; 
                    input.addEventListener('input', function() { 
                        updateMaterialProperty(material, prop, this.value); 
                        scheduleAutoSave(); 
                    }); 
                    cell.appendChild(input); 
                    row.appendChild(cell); 
                }); 
                 
                tbody.appendChild(row); 
            }); 
        }
        
        function updateMaterialProperty(material, property, value) { 
            appData.materials[material][property] = value; 
            calculateInputs(); 
            calculateAll(); 
            if (property === "Moisture" || property === "FE") syncShiftMaterialProperties(); 
            updateStatus(`Updated ${material} ${property}. All calculations updated automatically.`); 
        }
        
        // Inputs View
        function initializeInputsView() { 
            const tbody = document.getElementById('inputs-tbody'); 
            tbody.innerHTML = ''; 
             
            const inputsList = Object.keys(appData.inputs); 
             
            inputsList.forEach(material => { 
                const row = document.createElement('tr'); 
                 
                const nameCell = document.createElement('td'); 
                nameCell.textContent = material; 
                nameCell.style.fontWeight = '500'; 
                row.appendChild(nameCell); 
                 
                const weightCell = document.createElement('td'); 
                const weightInput = document.createElement('input'); 
                weightInput.type = 'text'; 
                weightInput.value = appData.inputs[material].Weight; 
                weightInput.addEventListener('input', function() { 
                    updateInputWeight(material, this.value); 
                    scheduleAutoSave(); 
                }); 
                weightCell.appendChild(weightInput); 
                row.appendChild(weightCell); 
                 
                for (let i = 0; i < 8; i++) { 
                    const cell = document.createElement('td'); 
                    cell.className = 'calculated'; 
                    cell.id = `input-${material}-${i}`; 
                    row.appendChild(cell); 
                } 
                 
                tbody.appendChild(row); 
            }); 
        }
        
        function updateInputWeight(material, value) { 
            appData.inputs[material].Weight = value; 
            calculateInputs(); 
            calculateAll(); 
            updateStatus(`Updated ${material} Weight. All calculations updated automatically.`); 
        }
        
        // Results View - Modified for 4-column layout
        function initializeResultsView() { 
            const consumptionRates = [ 
                "Hot Metal", "Coke Rate", "Slag Rate", "PCI Rate", "Ncoke Rate", "Fuel Rate",  
                "Sinter %", "Ore %", "Pellets %", "Scrap %", "Coke %", "Ore/Coke" 
            ]; 
             
            const consumptionContainer = document.getElementById('consumption-rates'); 
            consumptionContainer.innerHTML = ''; 
             
            consumptionRates.forEach(rate => { 
                const item = document.createElement('div'); 
                item.className = 'results-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'results-label'; 
                label.textContent = `${rate}:`; 
                 
                const value = document.createElement('div'); 
                value.className = 'results-value'; 
                value.id = `result-${rate.replace(/\s+/g, '-')}`; 
                 
                item.appendChild(label); 
                item.appendChild(value); 
                consumptionContainer.appendChild(item); 
            }); 
             
            const inputTotals = [ 
                "Total Weight", "Total Dry Weight", "Total Fe Input", "Total SiO2", "Total CaO",  
                "Total MgO", "Total Al2O3", "Slag Weight", "Slag Basicity", "Alumina Ratio",  
                "CaO/SiO2", "MgO/SiO2" 
            ]; 
             
            const totalsContainer = document.getElementById('input-totals'); 
            totalsContainer.innerHTML = ''; 
             
            inputTotals.forEach(total => { 
                const item = document.createElement('div'); 
                item.className = 'results-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'results-label'; 
                label.textContent = `${total}:`; 
                 
                const value = document.createElement('div'); 
                value.className = 'results-value'; 
                value.id = `result-${total.replace(/\s+/g, '-')}`; 
                 
                item.appendChild(label); 
                item.appendChild(value); 
                totalsContainer.appendChild(item); 
            }); 
             
            const volumeCalculations = [ 
                "Coke Volume", "Ncoke Volume", "Total Iron Bearing Vol", "Sinter Volume",  
                "Ore Volume", "Pellets Volume", "Scrap Volume", "Total Volume", "Fe/C Ratio" 
            ]; 
             
            const volumeContainer = document.getElementById('volume-calculations'); 
            volumeContainer.innerHTML = ''; 
             
            volumeCalculations.forEach(vol => { 
                const item = document.createElement('div'); 
                item.className = 'results-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'results-label'; 
                label.textContent = `${vol}:`; 
                 
                const value = document.createElement('div'); 
                value.className = 'results-value'; 
                value.id = `result-${vol.replace(/\s+/g, '-')}`; 
                 
                item.appendChild(label); 
                item.appendChild(value); 
                volumeContainer.appendChild(item); 
            }); 
             
            const productionMetrics = [ 
                "Total Iron Bearing Wt", "Sinter Weight", "Ore Weight", "Pellets Weight",  
                "Scrap Weight", "Productivity", "Specific Consumption", "Yield", "Total C Input",  
                "C in Hot Metal", "C in Gas", "C Efficiency" 
            ]; 
             
            const metricsContainer = document.getElementById('production-metrics'); 
            metricsContainer.innerHTML = ''; 
             
            productionMetrics.forEach(metric => { 
                const item = document.createElement('div'); 
                item.className = 'results-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'results-label'; 
                label.textContent = `${metric}:`; 
                 
                const value = document.createElement('div'); 
                value.className = 'results-value'; 
                value.id = `result-${metric.replace(/\s+/g, '-')}`; 
                 
                item.appendChild(label); 
                item.appendChild(value); 
                metricsContainer.appendChild(item); 
            }); 
        }
        
        // Blast Parameters View - Modified for 2-column layout
        function initializeBlastParamsView() { 
            const blastParams = [ 
                "Blast Volume", "O2 Enrichment", "Blast Temperature", "Top Pressure", "Blast Pressure",  
                "Humidity", "Basicity", "Alâ‚‚Oâ‚ƒ", "Nos Of Tuyeres", "Gas Generation", "Hearth Area", "HMT" 
            ]; 
             
            const blastContainer = document.getElementById('blast-params'); 
            blastContainer.innerHTML = ''; 
             
            blastParams.forEach(param => { 
                const item = document.createElement('div'); 
                item.className = 'params-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'params-label'; 
                 
                let icon = 'tune'; 
                if (param.includes('Volume')) icon = 'open_in_full'; 
                else if (param.includes('Temperature')) icon = 'thermostat'; 
                else if (param.includes('Pressure')) icon = 'speed'; 
                else if (param.includes('Humidity')) icon = 'water_drop'; 
                else if (param.includes('Tuyeres')) icon = 'radio_button_checked'; 
                else if (param.includes('Gas')) icon = 'air'; 
                else if (param.includes('Area')) icon = 'crop_square'; 
                 
                label.innerHTML = `<i class="material-icons">${icon}</i> ${param}:`; 
                 
                const input = document.createElement('input'); 
                input.className = 'params-input'; 
                input.type = 'text'; 
                input.value = appData.blastParams[param]; 
                input.addEventListener('input', function() { 
                    updateBlastParam(param, this.value); 
                    scheduleAutoSave(); 
                }); 
                 
                item.appendChild(label); 
                item.appendChild(input); 
                blastContainer.appendChild(item); 
            }); 
             
            const derivedParams = [ 
                "DP", "Tuyere Velocity", "Raceway Flame Temp", "Hot Metal", "O2 %", "Silicon%",  
                "Furnace Resistance", "Furnace Permeability" 
            ]; 
             
            const derivedContainer = document.getElementById('derived-params'); 
            derivedContainer.innerHTML = ''; 
             
            derivedParams.forEach(param => { 
                const item = document.createElement('div'); 
                item.className = 'params-item'; 
                 
                const label = document.createElement('div'); 
                label.className = 'params-label'; 
                 
                let icon = 'analytics'; 
                if (param.includes('Velocity')) icon = 'speed'; 
                else if (param.includes('Temp')) icon = 'thermostat'; 
                else if (param.includes('Hot Metal')) icon = 'local_fire_department'; 
                else if (param.includes('%')) icon = 'percent'; 
                else if (param.includes('Resistance')) icon = 'compress'; 
                else if (param.includes('Permeability')) icon = 'filter_alt'; 
                 
                label.innerHTML = `<i class="material-icons">${icon}</i> ${param}:`; 
                 
                const value = document.createElement('div'); 
                value.className = 'params-value'; 
                value.id = `blast-${param.replace(/\s+/g, '-')}`; 
                value.textContent = appData.blastParams[param]; 
                 
                item.appendChild(label); 
                item.appendChild(value); 
                derivedContainer.appendChild(item); 
            }); 
        }
        
        function updateBlastParam(param, value) { 
            appData.blastParams[param] = value; 
            calculateBlastParameters(); 
            updateStatus(`Updated ${param}. Blast parameters recalculated automatically.`); 
        }
        
        // Shift Production View
        function initializeShiftProductionView() { 
            const shifts = [ 
                {id: "A", name: "A", hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]}, 
                {id: "B", name: "B", hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]}, 
                {id: "C", name: "C", hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]} 
            ]; 
             
            shifts.forEach(shift => { 
                shift.hours.forEach(hour => { 
                    const key = `${shift.id}-${hour}`; 
                    if (!appData.shiftData[key]) { 
                        appData.shiftData[key] = [hour, shift.name, "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]; 
                    } 
                }); 
            }); 
             
            populateShiftTable('all'); 
            calculateShiftReport(); 
        }
        
        function initializeCokeRateTrendView() { 
            // Chart will be initialized when view is shown
        }
        
        function initializeHearthStatusView() { 
            Object.keys(appData.hearthData).forEach(param => { 
                const element = document.getElementById(param); 
                if (element) element.value = appData.hearthData[param]; 
            }); 
            calculateHearth(); 
        }
        
        function populateShiftTable(shiftFilter) { 
            const tbody = document.getElementById('shift-tbody'); 
            tbody.innerHTML = ''; 
             
            const shifts = [ 
                {id: "A", name: "A", hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]}, 
                {id: "B", name: "B", hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]}, 
                {id: "C", name: "C", hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]} 
            ]; 
             
            let shiftsToShow = shifts; 
            if (shiftFilter !== 'all') shiftsToShow = shifts.filter(shift => shift.id === shiftFilter); 
             
            shiftsToShow.forEach(shift => { 
                shift.hours.forEach(hour => { 
                    const key = `${shift.id}-${hour}`; 
                    const values = appData.shiftData[key]; 
                     
                    const row = document.createElement('tr'); 
                    row.classList.add(`shift-${shift.id.toLowerCase()}-row`); 
                     
                    values.forEach((value, col) => { 
                        const cell = document.createElement('td'); 
                        if (col < 2) { 
                            cell.textContent = value; 
                        } else if (col <= 10) { 
                            const input = document.createElement('input'); 
                            input.type = 'text'; 
                            input.value = value; 
                            input.addEventListener('input', function() { 
                                updateShiftEntry(key, col, this.value); 
                                scheduleAutoSave(); 
                            }); 
                            cell.appendChild(input); 
                        } else { 
                            cell.className = 'calculated'; 
                            cell.id = `shift-${key}-${col}`; 
                            cell.textContent = value; 
                        } 
                        row.appendChild(cell); 
                    }); 
                     
                    tbody.appendChild(row); 
                }); 
            }); 
             
            recalculateAllShiftRows(); 
        }
        
        function filterShiftColumns() { 
            const shiftFilter = document.getElementById('shift-filter').value; 
            populateShiftTable(shiftFilter); 
            calculateShiftReport(); 
            updateStatus(`Showing data for ${shiftFilter === 'all' ? 'All Shifts' : 'Shift ' + shiftFilter}`); 
        }
        
        function updateShiftEntry(key, column, value) { 
            appData.shiftData[key][column] = value; 
            calculateShiftRow(key); 
            calculateShiftReport(); 
            if (document.getElementById('coke_rate_trend-view').classList.contains('active')) updateTrendChart(); 
            updateStatus("Updated shift data. Calculations updated automatically."); 
        }
        
        // Calculations
        function calculateInputs() { 
            Object.keys(appData.inputs).forEach(material => { 
                const weight = safeParseFloat(appData.inputs[material].Weight); 
                const moisture = safeParseFloat(appData.materials[material].Moisture); 
                const moistureAdj = 1 - (moisture / 100); 
                const dryWeight = weight * moistureAdj; 
                 
                const row = document.querySelector(`#inputs-tbody tr:nth-child(${Object.keys(appData.inputs).indexOf(material) + 1})`); 
                if (row) { 
                    row.cells[2].textContent = moistureAdj.toFixed(2); 
                    row.cells[3].textContent = dryWeight.toFixed(1); 
                     
                    const fe = safeParseFloat(appData.materials[material].FE); 
                    const c = safeParseFloat(appData.materials[material].C); 
                    const sio2 = safeParseFloat(appData.materials[material].SiO2); 
                    const cao = safeParseFloat(appData.materials[material].CAO); 
                    const mgo = safeParseFloat(appData.materials[material].MGO); 
                    const al2o3 = safeParseFloat(appData.materials[material].AL203); 
                     
                    row.cells[4].textContent = (dryWeight * fe / 100).toFixed(1); 
                    row.cells[5].textContent = (dryWeight * c / 100).toFixed(1); 
                    row.cells[6].textContent = (dryWeight * sio2 / 100).toFixed(1); 
                    row.cells[7].textContent = (dryWeight * cao / 100).toFixed(1); 
                    row.cells[8].textContent = (dryWeight * mgo / 100).toFixed(1); 
                    row.cells[9].textContent = (dryWeight * al2o3 / 100).toFixed(1); 
                } 
            }); 
        }
        
        function calculateBlastParameters() { 
            const blastPressure = safeParseFloat(appData.blastParams["Blast Pressure"]); 
            const topPressure = safeParseFloat(appData.blastParams["Top Pressure"]); 
            const dp = blastPressure - topPressure; 
            appData.blastParams["DP"] = dp.toFixed(2); 
             
            const blastTemp = safeParseFloat(appData.blastParams["Blast Temperature"]); 
            const o2Enrich = safeParseFloat(appData.blastParams["O2 Enrichment"]); 
            const humidity = safeParseFloat(appData.blastParams["Humidity"]); 
            const flameTemp = blastTemp + (o2Enrich * 10) - (humidity * 2); 
            appData.blastParams["Raceway Flame Temp"] = flameTemp.toFixed(1); 
             
            const blastVolume = safeParseFloat(appData.blastParams["Blast Volume"]); 
            const tuyereArea = 0.1; 
            const velocity = (blastVolume / 60) / tuyereArea; 
            appData.blastParams["Tuyere Velocity"] = velocity.toFixed(1); 
             
            const hotmetalPerd = ((blastVolume * 0.020) + (o2Enrich * 0.015)); 
            appData.blastParams["Hot Metal"] = hotmetalPerd.toFixed(1); 
             
            const o2EnrichmentValue = safeParseFloat(appData.blastParams["O2 Enrichment"]); 
            const blastVolumeValue = safeParseFloat(appData.blastParams["Blast Volume"]); 
            if (blastVolumeValue > 0) { 
                const normalAirO2 = blastVolumeValue * 0.21; 
                const totalO2 = normalAirO2 + o2EnrichmentValue; 
                const o2Percentage = (totalO2 / blastVolumeValue) * 100; 
                appData.blastParams["O2 %"] = o2Percentage.toFixed(1); 
            } else { 
                appData.blastParams["O2 %"] = "0"; 
            } 
             
            const hmt = safeParseFloat(appData.blastParams["HMT"]); 
            const basicity = safeParseFloat(appData.blastParams["Basicity"]); 
            const al2o3 = safeParseFloat(appData.blastParams["Alâ‚‚Oâ‚ƒ"]); 
            const siliconPercent = ( -2.15 + (0.0018 * hmt) + (0.15 * basicity) + (0.025 * al2o3) - (0.008 * humidity) ); 
            appData.blastParams["Silicon%"] = siliconPercent.toFixed(2); 
             
            const hotBlastPr = safeParseFloat(appData.blastParams["Blast Pressure"]); 
            const hbvol = safeParseFloat(appData.blastParams["Blast Volume"]); 
            const hbt = safeParseFloat(appData.blastParams["Blast Temperature"]); 
            const nosTuyeres = safeParseFloat(appData.blastParams["Nos Of Tuyeres"]); 
            const topPr = safeParseFloat(appData.blastParams["Top Pressure"]); 
            const topgasVol = safeParseFloat(appData.blastParams["Gas Generation"]); 
            const hearthArea = safeParseFloat(appData.blastParams["Hearth Area"]); 
             
            const topgasVolPerMin = topgasVol / 60; 
            const shaftgasVol = topgasVolPerMin / hearthArea; 
             
            const pdsTuyere = (10**-8) * 6.5 * (hbt + 273.16) / (hotBlastPr + 1.003) * ((hbvol / 60 / nosTuyeres) ** 2); 
             
            const term1 = (hotBlastPr - pdsTuyere + 1.003) ** 2; 
            const term2 = (topPr + 1.003) ** 2; 
            const term3 = (term1 - term2) ** 0.588235294; 
            const fceResistance = (term3 * 10000) / shaftgasVol; 
             
            const term4 = (hotBlastPr - pdsTuyere + 1.003) ** 2; 
            const term5 = (topPr + 1.003) ** 2; 
            const permeability = (shaftgasVol ** 1.7) / (term4 - term5); 
             
            appData.blastParams["Furnace Resistance"] = fceResistance.toFixed(1); 
            appData.blastParams["Furnace Permeability"] = permeability.toFixed(1); 
             
            derivedBlastParams.forEach(param => { 
                const element = document.getElementById(`blast-${param.replace(/\s+/g, '-')}`); 
                if (element) element.textContent = appData.blastParams[param]; 
            }); 
        }
        
        function calculateAll() { 
            const totals = { 
                weight: 0, dryWeight: 0, fe: 0, c: 0, sio2: 0, cao: 0, mgo: 0, al2o3: 0, 
                cokeDryWeight: 0, pciDryWeight: 0, ncokeDryWeight: 0 
            }; 
             
            Object.keys(appData.inputs).forEach(material => { 
                const weight = safeParseFloat(appData.inputs[material].Weight); 
                const moisture = safeParseFloat(appData.materials[material].Moisture); 
                const moistureAdj = 1 - (moisture / 100); 
                const dryWeight = weight * moistureAdj; 
                 
                totals.weight += weight; 
                totals.dryWeight += dryWeight; 
                 
                const fe = safeParseFloat(appData.materials[material].FE); 
                const c = safeParseFloat(appData.materials[material].C); 
                const sio2 = safeParseFloat(appData.materials[material].SiO2); 
                const cao = safeParseFloat(appData.materials[material].CAO); 
                const mgo = safeParseFloat(appData.materials[material].MGO); 
                const al2o3 = safeParseFloat(appData.materials[material].AL203); 
                 
                totals.fe += dryWeight * fe / 100; 
                totals.c += dryWeight * c / 100; 
                totals.sio2 += dryWeight * sio2 / 100; 
                totals.cao += dryWeight * cao / 100; 
                totals.mgo += dryWeight * mgo / 100; 
                totals.al2o3 += dryWeight * al2o3 / 100; 
                 
                if (material === "COKE") totals.cokeDryWeight = dryWeight; 
                else if (material === "PCI") totals.pciDryWeight = dryWeight; 
                else if (material === "NCOKE") totals.ncokeDryWeight = dryWeight; 
            }); 
             
            const volumes = { 
                coke: totals.cokeDryWeight / safeParseFloat(appData.materials["COKE"].Density), 
                ncoke: totals.ncokeDryWeight / safeParseFloat(appData.materials["NCOKE"].Density), 
                sinter: safeParseFloat(appData.inputs["SINTER"].Weight) / safeParseFloat(appData.materials["SINTER"].Density), 
                ore: safeParseFloat(appData.inputs["ORE"].Weight) / safeParseFloat(appData.materials["ORE"].Density), 
                pellets: safeParseFloat(appData.inputs["PELLETS"].Weight) / safeParseFloat(appData.materials["PELLETS"].Density), 
                scrap: safeParseFloat(appData.inputs["SCRAP"].Weight) / safeParseFloat(appData.materials["SCRAP"].Density) 
            }; 
             
            const ironBearingMaterials = ["SINTER", "ORE", "PELLETS", "SCRAP"]; 
            const totalIronBearingWeight = ironBearingMaterials.reduce((sum, mat) => sum + safeParseFloat(appData.inputs[mat].Weight), 0); 
            const totalIronBearingVol = ["sinter", "ore", "pellets", "scrap"].reduce((sum, mat) => sum + volumes[mat], 0); 
            const totalVol = volumes.coke + volumes.ncoke + totalIronBearingVol; 
            const ocRatio = totalIronBearingWeight / Math.max(safeParseFloat(appData.inputs["COKE"].Weight), 1); 
             
            const hmProduction = totals.fe / 0.945; 
            const cokeRate = (totals.cokeDryWeight * 1000) / Math.max(hmProduction, 1); 
            const ncokeRate = (totals.ncokeDryWeight * 1000) / Math.max(hmProduction, 1); 
            const pciRate = (totals.pciDryWeight * 1000) / Math.max(hmProduction, 1); 
            const fuelRate = cokeRate + ncokeRate + pciRate; 
            const cInHm = hmProduction * 0.045; 
            const cInGas = totals.c - cInHm; 
            const cEfficiency = (cInHm / Math.max(totals.c, 1)) * 100; 
            const slagWeight = totals.sio2 + totals.cao + totals.mgo + totals.al2o3; 
             
            const feCRatio = totals.fe / Math.max(totals.c, 1); 
            const slagBasicity = (totals.cao + totals.mgo) / Math.max(totals.sio2, 1); 
            const aluminaRatio = totals.al2o3 / Math.max((totals.cao + totals.mgo), 1); 
            const caoSio2 = totals.cao / Math.max(totals.sio2, 1); 
            const mgoSio2 = totals.mgo / Math.max(totals.sio2, 1); 
             
            const sinterPct = (safeParseFloat(appData.inputs["SINTER"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100; 
            const orePct = (safeParseFloat(appData.inputs["ORE"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100; 
            const pelletsPct = (safeParseFloat(appData.inputs["PELLETS"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100; 
            const scrapPct = (safeParseFloat(appData.inputs["SCRAP"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100; 
            const cokePct = (safeParseFloat(appData.inputs["COKE"].Weight) / Math.max(totals.weight, 1)) * 100; 
             
            const productivity = hmProduction / 1493; 
            const specificConsumption = totals.weight / Math.max(hmProduction / 1000, 1); 
            const yieldPct = (hmProduction / Math.max(totals.fe, 1)) * 100; 
             
            updateResult("Hot Metal", hmProduction.toFixed(1)); 
            updateResult("Coke Rate", cokeRate.toFixed(1)); 
            updateResult("Slag Rate", (slagWeight * 1000 / Math.max(hmProduction, 1)).toFixed(1)); 
            updateResult("PCI Rate", pciRate.toFixed(1)); 
            updateResult("Ncoke Rate", ncokeRate.toFixed(1)); 
            updateResult("Fuel Rate", fuelRate.toFixed(2)); 
            updateResult("Sinter %", sinterPct.toFixed(1)); 
            updateResult("Ore %", orePct.toFixed(1)); 
            updateResult("Pellets %", pelletsPct.toFixed(1)); 
            updateResult("Scrap %", scrapPct.toFixed(1)); 
            updateResult("Coke %", cokePct.toFixed(1)); 
            updateResult("Ore/Coke", ocRatio.toFixed(2)); 
             
            updateResult("Total Weight", totals.weight.toFixed(1)); 
            updateResult("Total Dry Weight", totals.dryWeight.toFixed(1)); 
            updateResult("Total Fe Input", totals.fe.toFixed(1)); 
            updateResult("Total SiO2", totals.sio2.toFixed(1)); 
            updateResult("Total CaO", totals.cao.toFixed(1)); 
            updateResult("Total MgO", totals.mgo.toFixed(1)); 
            updateResult("Total Al2O3", totals.al2o3.toFixed(1)); 
            updateResult("Slag Weight", slagWeight.toFixed(1)); 
            updateResult("Slag Basicity", slagBasicity.toFixed(2)); 
            updateResult("Alumina Ratio", aluminaRatio.toFixed(2)); 
            updateResult("CaO/SiO2", caoSio2.toFixed(2)); 
            updateResult("MgO/SiO2", mgoSio2.toFixed(2)); 
             
            updateResult("Coke Volume", volumes.coke.toFixed(2)); 
            updateResult("Ncoke Volume", volumes.ncoke.toFixed(2)); 
            updateResult("Total Iron Bearing Vol", totalIronBearingVol.toFixed(2)); 
            updateResult("Sinter Volume", volumes.sinter.toFixed(2)); 
            updateResult("Ore Volume", volumes.ore.toFixed(2)); 
            updateResult("Pellets Volume", volumes.pellets.toFixed(2)); 
            updateResult("Scrap Volume", volumes.scrap.toFixed(2)); 
            updateResult("Total Volume", totalVol.toFixed(2)); 
            updateResult("Fe/C Ratio", feCRatio.toFixed(2)); 
             
            updateResult("Total Iron Bearing Wt", totalIronBearingWeight.toFixed(1)); 
            updateResult("Sinter Weight", safeParseFloat(appData.inputs["SINTER"].Weight).toFixed(1)); 
            updateResult("Ore Weight", safeParseFloat(appData.inputs["ORE"].Weight).toFixed(1)); 
            updateResult("Pellets Weight", safeParseFloat(appData.inputs["PELLETS"].Weight).toFixed(1)); 
            updateResult("Scrap Weight", safeParseFloat(appData.inputs["SCRAP"].Weight).toFixed(1)); 
            updateResult("Productivity", productivity.toFixed(2)); 
            updateResult("Specific Consumption", specificConsumption.toFixed(1)); 
            updateResult("Total C Input", totals.c.toFixed(1)); 
            updateResult("Yield", yieldPct.toFixed(1)); 
            updateResult("C in Hot Metal", cInHm.toFixed(1)); 
            updateResult("C in Gas", cInGas.toFixed(1)); 
            updateResult("C Efficiency", cEfficiency.toFixed(1)); 
        }
        
        function updateResult(field, value) { 
            const element = document.getElementById(`result-${field.replace(/\s+/g, '-')}`); 
            if (element) element.textContent = value; 
        }
        
        function syncShiftMaterialProperties() { 
            const materialMapping = { 
                'COKE': 'coke', 'SINTER': 'sinter', 'ORE': 'ironOre', 'PELLETS': 'pellets', 
                'SCRAP': 'scraps', 'PCI': 'pci', 'NCOKE': 'nutCoke' 
            }; 
             
            Object.keys(materialMapping).forEach(materialName => { 
                const shiftKey = materialMapping[materialName]; 
                if (appData.materials[materialName] && appData.shiftMaterialProperties[shiftKey]) { 
                    appData.shiftMaterialProperties[shiftKey].moisture = safeParseFloat(appData.materials[materialName].Moisture); 
                    appData.shiftMaterialProperties[shiftKey].fe = safeParseFloat(appData.materials[materialName].FE); 
                    if ('c' in appData.shiftMaterialProperties[shiftKey]) { 
                        appData.shiftMaterialProperties[shiftKey].c = safeParseFloat(appData.materials[materialName].C); 
                    } 
                } 
            }); 
             
            recalculateAllShiftRows(); 
            updateStatus("Shift material properties synchronized with main materials"); 
        }
        
        function calculateShiftRow(key) { 
            const values = appData.shiftData[key]; 
             
            const coke = safeParseFloat(values[2]); 
            const sinter = safeParseFloat(values[3]); 
            const ironOre = safeParseFloat(values[4]); 
            const pellets = safeParseFloat(values[5]); 
            const scraps = safeParseFloat(values[6]); 
            const nutCoke = safeParseFloat(values[7]); 
            const pci = safeParseFloat(values[8]); 
            const cbVolume = safeParseFloat(values[9]); 
            const o2Volume = safeParseFloat(values[10]); 
             
            const inputs = { 
                "coke": coke, "sinter": sinter, "ironOre": ironOre, "pellets": pellets, 
                "scraps": scraps, "nutCoke": nutCoke, "pci": pci 
            }; 
            const hotMetal = calculateHotMetal(inputs); 
             
            const cokeRate = calculateRates("coke", coke, hotMetal); 
            const nutCokeRate = calculateRates("nutCoke", nutCoke, hotMetal); 
            const pciRate = calculateRates("pci", pci, hotMetal); 
            const fuelRate = cokeRate + nutCokeRate + pciRate; 
             
            const oxygenRate = calculateOxygenRate(cbVolume, o2Volume, hotMetal); 
             
            values[11] = hotMetal.toFixed(1); 
            values[12] = cokeRate.toFixed(0); 
            values[13] = nutCokeRate.toFixed(0); 
            values[14] = pciRate.toFixed(0); 
            values[15] = fuelRate.toFixed(0); 
            values[16] = oxygenRate.toFixed(0); 
             
            appData.shiftData[key] = values; 
             
            for (let col = 11; col <= 16; col++) { 
                const cell = document.getElementById(`shift-${key}-${col}`); 
                if (cell) cell.textContent = values[col]; 
            } 
        }
        
        function recalculateAllShiftRows() { 
            Object.keys(appData.shiftData).forEach(key => calculateShiftRow(key)); 
            calculateShiftReport(); 
            if (document.getElementById('coke_rate_trend-view').classList.contains('active')) updateTrendChart(); 
        }
        
        function calculateHotMetal(inputs) { 
            let totalFe = 0; 
            Object.keys(inputs).forEach(material => { 
                if (appData.shiftMaterialProperties[material]) { 
                    const props = appData.shiftMaterialProperties[material]; 
                    const dryWeight = inputs[material] * (1 - props.moisture / 100); 
                    totalFe += dryWeight * (props.fe / 100); 
                } 
            }); 
            return totalFe / 0.945; 
        }
        
        function calculateRates(material, inputVal, hotMetal) { 
            inputVal = safeParseFloat(inputVal); 
            hotMetal = safeParseFloat(hotMetal); 
            if (hotMetal === 0) return 0; 
             
            if (appData.shiftMaterialProperties[material]) { 
                const props = appData.shiftMaterialProperties[material]; 
                const dryWeight = inputVal * (1 - props.moisture / 100); 
                return (dryWeight / hotMetal) * 1000; 
            } 
            return 0; 
        }
        
        function calculateOxygenRate(cbVolume, o2EnrichmentVolume, hotMetal) { 
            cbVolume = safeParseFloat(cbVolume); 
            o2EnrichmentVolume = safeParseFloat(o2EnrichmentVolume); 
            hotMetal = safeParseFloat(hotMetal); 
            if (hotMetal === 0) return 0; 
            const totalOxygen = (cbVolume * 0.21) + o2EnrichmentVolume; 
            return totalOxygen / hotMetal; 
        }
        
        function calculateHearth() { 
            const production = parseFloat(document.getElementById('production').value) || 0; 
            const slagRate = parseFloat(document.getElementById('slagRate').value) || 0; 
            const hmDensity = parseFloat(document.getElementById('hmDensity').value) || 0; 
            const slagDensity = parseFloat(document.getElementById('slagDensity').value) || 0; 
            const hearthVoidage = (parseFloat(document.getElementById('hearthVoidage').value) || 0) / 100; 
            const hearthDiameter = parseFloat(document.getElementById('hearthDiameter').value) || 0; 
            const tuyereHeight = parseFloat(document.getElementById('tuyereHeight').value) || 0; 
             
            appData.hearthData.production = production; 
            appData.hearthData.slagRate = slagRate; 
            appData.hearthData.hmDensity = hmDensity; 
            appData.hearthData.slagDensity = slagDensity; 
            appData.hearthData.hearthVoidage = hearthVoidage * 100; 
            appData.hearthData.hearthDiameter = hearthDiameter; 
            appData.hearthData.tuyereHeight = tuyereHeight; 
             
            const productionRate = production / (24 * 60); 
            document.getElementById('productionRate').value = productionRate.toFixed(4) + " t/min"; 
             
            const ironVolume = productionRate / hmDensity; 
            document.getElementById('ironVolume').value = ironVolume.toFixed(4) + " mÂ³/min"; 
             
            const slagVolume = ((slagRate / 1000) * productionRate) / slagDensity; 
            document.getElementById('slagVolume').value = slagVolume.toFixed(4) + " mÂ³/min"; 
             
            const totalLiquidVolume = ironVolume + slagVolume; 
            document.getElementById('totalLiquidVolume').value = totalLiquidVolume.toFixed(4) + " mÂ³/min"; 
             
            const hearthArea = Math.PI * Math.pow(hearthDiameter / 2, 2); 
            document.getElementById('hearthArea').value = hearthArea.toFixed(2) + " mÂ²"; 
             
            const storageCapacity = hearthVoidage * hearthArea * tuyereHeight; 
            document.getElementById('storageCapacity').value = storageCapacity.toFixed(2) + " mÂ³"; 
             
            const timeToTuyeres = storageCapacity / totalLiquidVolume; 
            document.getElementById('timeToTuyeres').value = timeToTuyeres.toFixed(0) + " minutes"; 
             
            scheduleAutoSave(); 
        }
        
        function calculateShiftReport() { 
            const shiftSummary = { 
                A: { hotMetal: 0, cokeRate: 0, ncRate: 0, pciRate: 0, fuelRate: 0, spo2Rate: 0, count: 0 }, 
                B: { hotMetal: 0, cokeRate: 0, ncRate: 0, pciRate: 0, fuelRate: 0, spo2Rate: 0, count: 0 }, 
                C: { hotMetal: 0, cokeRate: 0, ncRate: 0, pciRate: 0, fuelRate: 0, spo2Rate: 0, count: 0 } 
            }; 
             
            const shiftTableRows = document.querySelectorAll('#shift-tbody tr'); 
            shiftTableRows.forEach(row => { 
                const cells = row.querySelectorAll('td'); 
                if (cells.length >= 17) { 
                    const shift = cells[1].textContent; 
                    if (shiftSummary[shift]) { 
                        shiftSummary[shift].hotMetal += safeParseFloat(cells[11].textContent); 
                        shiftSummary[shift].cokeRate += safeParseFloat(cells[12].textContent); 
                        shiftSummary[shift].ncRate += safeParseFloat(cells[13].textContent); 
                        shiftSummary[shift].pciRate += safeParseFloat(cells[14].textContent); 
                        shiftSummary[shift].fuelRate += safeParseFloat(cells[15].textContent); 
                        shiftSummary[shift].spo2Rate += safeParseFloat(cells[16].textContent); 
                        shiftSummary[shift].count += 1; 
                    } 
                } 
            }); 
             
            const tbody = document.getElementById('shift-report-tbody'); 
            tbody.innerHTML = ''; 
             
            Object.keys(shiftSummary).forEach(shift => { 
                const data = shiftSummary[shift]; 
                if (data.count > 0) { 
                    const avgCokeRate = data.cokeRate / data.count; 
                    const avgNcRate = data.ncRate / data.count; 
                    const avgPciRate = data.pciRate / data.count; 
                    const avgFuelRate = data.fuelRate / data.count; 
                    const avgSpo2Rate = data.spo2Rate / data.count; 
                     
                    const row = document.createElement('tr'); 
                     
                    const shiftCell = document.createElement('td'); 
                    shiftCell.innerHTML = ` 
                        <div style="display: flex; align-items: center;"> 
                            <div class="legend-color" style="background-color: var(--shift-${shift.toLowerCase()}-color); margin-right: 6px;"></div> 
                            Shift ${shift} 
                        </div> 
                    `; 
                    row.appendChild(shiftCell); 
                     
                    addCell(row, data.hotMetal.toFixed(1)); 
                    addCell(row, avgCokeRate.toFixed(0)); 
                    addCell(row, avgNcRate.toFixed(0)); 
                    addCell(row, avgPciRate.toFixed(0)); 
                    addCell(row, avgFuelRate.toFixed(0)); 
                    addCell(row, avgSpo2Rate.toFixed(0)); 
                     
                    const perfCell = document.createElement('td'); 
                    let perfClass = 'performance-average'; 
                    let perfText = 'Average'; 
                     
                    if (avgFuelRate < 450) { 
                        perfClass = 'performance-good'; 
                        perfText = 'Good'; 
                    } else if (avgFuelRate > 500) { 
                        perfClass = 'performance-poor'; 
                        perfText = 'Poor'; 
                    } 
                     
                    perfCell.innerHTML = ` 
                        <div style="display: flex; align-items: center;"> 
                            ${perfText} 
                            <span class="performance-indicator ${perfClass}"></span> 
                        </div> 
                    `; 
                    row.appendChild(perfCell); 
                     
                    tbody.appendChild(row); 
                } 
            }); 
        }
        
        function addCell(row, content) { 
            const cell = document.createElement('td'); 
            cell.textContent = content; 
            row.appendChild(cell); 
        }
        
        function updateTrendChart() { 
            const canvas = document.getElementById('trend-chart'); 
            if (!canvas) return; 
             
            const ctx = canvas.getContext('2d'); 
            const shiftFilter = document.getElementById('trend-shift-filter').value; 
            const chartData = prepareChartData(shiftFilter); 
             
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark'; 
            const textColor = isDarkMode ? '#E0E0E0' : '#212121'; 
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'; 
             
            if (trendChart) trendChart.destroy(); 
             
            trendChart = new Chart(ctx, { 
                type: 'line', 
                data: chartData, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    interaction: { 
                        mode: 'index', 
                        intersect: false, 
                    }, 
                    plugins: { 
                        title: { 
                            display: true, 
                            text: 'Coke Rate Trend Analysis', 
                            color: textColor, 
                            font: { size: 16, weight: '500', family: "'Roboto', sans-serif" } 
                        }, 
                        legend: { 
                            display: window.innerWidth > 768, // Only show legend on larger screens 
                            position: 'top', 
                            labels: { 
                                boxWidth: 15, 
                                padding: 15, 
                                usePointStyle: true, 
                                pointStyle: 'circle', 
                                color: textColor, 
                                font: { family: "'Roboto', sans-serif" } 
                            } 
                        }, 
                        tooltip: { 
                            mode: 'index', 
                            intersect: false, 
                            backgroundColor: isDarkMode ? 'rgba(30, 30, 30, 0.9)' : 'rgba(255, 255, 255, 0.9)', 
                            titleColor: textColor, 
                            bodyColor: textColor, 
                            borderColor: isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)', 
                            borderWidth: 1, 
                            titleFont: { family: "'Roboto', sans-serif" },
                            bodyFont: { family: "'Roboto', sans-serif" },
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                title: function(tooltipItems) {
                                    return 'Time: ' + tooltipItems[0].label;
                                }
                            }
                        } 
                    }, 
                    scales: { 
                        x: { 
                            title: { display: true, text: 'Time (Hours)', color: textColor, font: { family: "'Roboto', sans-serif" } }, 
                            ticks: { 
                                color: textColor, 
                                maxRotation: window.innerWidth <= 480 ? 45 : 0, 
                                minRotation: window.innerWidth <= 480 ? 45 : 0, 
                                font: { family: "'Roboto', sans-serif" } 
                            }, 
                            grid: { color: gridColor, drawBorder: false } 
                        }, 
                        y: { 
                            title: { display: true, text: 'Value', color: textColor, font: { family: "'Roboto', sans-serif" } }, 
                            ticks: { color: textColor, font: { family: "'Roboto', sans-serif" } }, 
                            grid: { color: gridColor, drawBorder: false } 
                        } 
                    }, 
                    elements: { 
                        point: { 
                            radius: window.innerWidth <= 480 ? 3 : 4, 
                            hoverRadius: window.innerWidth <= 480 ? 5 : 6, 
                            hitRadius: 10 // Larger hit area for touch 
                        }, 
                        line: { 
                            tension: 0.3, 
                            borderWidth: 2 
                        } 
                    }, 
                    // Touch-specific settings 
                    onHover: (event, activeElements) => { 
                        event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default'; 
                    } 
                } 
            }); 
             
            updateStatus("Trend chart updated successfully"); 
        }
        
        function prepareChartData(shiftFilter) { 
            const shifts = [ 
                {id: "A", name: "A", hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]}, 
                {id: "B", name: "B", hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]}, 
                {id: "C", name: "C", hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]} 
            ]; 
             
            let shiftsToInclude = shifts; 
            if (shiftFilter !== 'all') shiftsToInclude = shifts.filter(shift => shift.id === shiftFilter); 
             
            const labels = []; 
            const hotMetalData = []; 
            const cokeRateData = []; 
            const ncRateData = []; 
            const pciRateData = []; 
            const spo2RateData = []; 
             
            shiftsToInclude.forEach(shift => { 
                shift.hours.forEach(hour => { 
                    const key = `${shift.id}-${hour}`; 
                    const values = appData.shiftData[key]; 
                     
                    if (values) { 
                        labels.push(`${shift.name}-${hour}`); 
                        hotMetalData.push(safeParseFloat(values[11])); 
                        cokeRateData.push(safeParseFloat(values[12])); 
                        ncRateData.push(safeParseFloat(values[13])); 
                        pciRateData.push(safeParseFloat(values[14])); 
                        spo2RateData.push(safeParseFloat(values[16])); 
                    } 
                }); 
            }); 
             
            const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark'; 
            const colors = { 
                hotMetal: isDarkMode ? '#EF5350' : '#F44336', 
                cokeRate: isDarkMode ? '#42A5F5' : '#2196F3', 
                ncRate: isDarkMode ? '#66BB6A' : '#4CAF50', 
                pciRate: isDarkMode ? '#FFB74D' : '#FF9800', 
                spo2Rate: isDarkMode ? '#AB47BC' : '#9C27B0' 
            }; 
             
            return { 
                labels: labels, 
                datasets: [ 
                    { label: 'Hot Metal', data: hotMetalData, borderColor: colors.hotMetal, backgroundColor: isDarkMode ? 'rgba(239, 83, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)', borderWidth: 2, tension: 0.3, fill: false }, 
                    { label: 'Coke Rate', data: cokeRateData, borderColor: colors.cokeRate, backgroundColor: isDarkMode ? 'rgba(66, 165, 245, 0.1)' : 'rgba(33, 150, 243, 0.1)', borderWidth: 2, tension: 0.3, fill: false }, 
                    { label: 'NC Rate', data: ncRateData, borderColor: colors.ncRate, backgroundColor: isDarkMode ? 'rgba(102, 187, 106, 0.1)' : 'rgba(76, 175, 80, 0.1)', borderWidth: 2, tension: 0.3, fill: false }, 
                    { label: 'PCI Rate', data: pciRateData, borderColor: colors.pciRate, backgroundColor: isDarkMode ? 'rgba(255, 183, 77, 0.1)' : 'rgba(255, 152, 0, 0.1)', borderWidth: 2, tension: 0.3, fill: false }, 
                    { label: 'SPO2 Rate', data: spo2RateData, borderColor: colors.spo2Rate, backgroundColor: isDarkMode ? 'rgba(171, 71, 188, 0.1)' : 'rgba(156, 39, 176, 0.1)', borderWidth: 2, tension: 0.3, fill: false } 
                ] 
            }; 
        }
        
        function safeParseFloat(value) { 
            const parsed = parseFloat(value); 
            return isNaN(parsed) ? 0 : parsed; 
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() { 
            initializeTheme(); 
            loadDefaultData();
            checkAuth(); 
            
            // Add touch-friendly interactions
            if ('ontouchstart' in window) {
                // Add ripple effect to buttons
                document.querySelectorAll('.md-button, .auth-button').forEach(button => {
                    button.addEventListener('touchstart', createRipple);
                });
                
                // Optimize table scrolling
                const tableContainers = document.querySelectorAll('.table-container');
                tableContainers.forEach(container => {
                    enhanceTableScrolling(container);
                });
                
                // Optimize form inputs
                document.querySelectorAll('input, select').forEach(input => {
                    input.addEventListener('touchstart', function() {
                        // Add visual feedback
                        this.style.transform = 'scale(1.02)';
                    });
                    
                    input.addEventListener('touchend', function() {
                        this.style.transform = 'scale(1)';
                    });
                });
            }
            
            // Optimize chart for mobile
            function optimizeChartForMobile() {
                if (window.innerWidth <= 767 && trendChart) {
                    trendChart.options.plugins.legend.display = false;
                    trendChart.options.scales.x.ticks.maxRotation = 45;
                    trendChart.options.scales.x.ticks.minRotation = 45;
                    trendChart.update();
                } else if (trendChart) {
                    trendChart.options.plugins.legend.display = true;
                    trendChart.options.scales.x.ticks.maxRotation = 0;
                    trendChart.options.scales.x.ticks.minRotation = 0;
                    trendChart.update();
                }
            }
            
            // Call when chart is initialized or window is resized
            window.addEventListener('resize', optimizeChartForMobile);
            
            // Prevent double-tap to zoom on form elements
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }); 
        
        // Create ripple effect for touch interactions
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.touches[0].clientX - button.offsetLeft - radius}px`;
            circle.style.top = `${event.touches[0].clientY - button.offsetTop - radius}px`;
            circle.classList.add("ripple");
            
            const ripple = button.getElementsByClassName("ripple")[0];
            if (ripple) {
                ripple.remove();
            }
            
            button.appendChild(circle);
        }
        
        // Enhance table scrolling for touch devices
        function enhanceTableScrolling(container) {
            let isDown = false;
            let startX;
            let scrollLeft;
            
            container.addEventListener('touchstart', (e) => {
                isDown = true;
                startX = e.touches[0].pageX - container.offsetLeft;
                scrollLeft = container.scrollLeft;
                container.classList.add('scrolling');
            });
            
            container.addEventListener('touchmove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.touches[0].pageX - container.offsetLeft;
                const walk = (x - startX) * 2; // Adjust scrolling speed
                container.scrollLeft = scrollLeft - walk;
                
                // Update scroll indicators
                updateScrollIndicators(container);
            });
            
            container.addEventListener('touchend', () => {
                isDown = false;
                container.classList.remove('scrolling');
                updateScrollIndicators(container);
            });
            
            // Initialize scroll indicators
            updateScrollIndicators(container);
            
            // Update scroll indicators on scroll
            container.addEventListener('scroll', () => {
                updateScrollIndicators(container);
            });
        }
        
        // Update scroll indicators for tables
        function updateScrollIndicators(container) {
            if (container.scrollLeft <= 0) {
                container.classList.remove('scroll-left');
            } else {
                container.classList.add('scroll-left');
            }
            
            if (container.scrollLeft >= container.scrollWidth - container.clientWidth) {
                container.classList.remove('scroll-right');
            } else {
                container.classList.add('scroll-right');
            }
        }
    </script> 
</body> 
</html>