<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BLAST FURNACE</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¥</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* CSS Variables for Theme Support */
        :root {
            /* Light Theme (Default) */
            --primary: #0078d4;
            --primary-dark: #106ebe;
            --primary-light: #60cdff;
            --secondary: #107c10;
            --accent: #ff8c00;
            --danger: #e81123;
            --warning: #ffb900;
            --info: #00b7c3;
            --dark: #323130;
            --light: #f3f2f1;
            --white: #ffffff;
            --gray: #605e5c;
            --gray-light: #edebe9;
            --gray-lighter: #faf9f8;
            --mica-bg: rgba(255, 255, 255, 0.7);
            --mica-border: rgba(255, 255, 255, 0.18);
            --bg-color: #f3f2f1;
            --text-color: #323130;
            --card-bg: #ffffff;
            --border-color: #e1e1e1;
            --input-bg: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.1);

            /* Additional Vibrant Colors */
            --purple: #8e44ad;
            --pink: #e91e63;
            --teal: #009688;
            --indigo: #3f51b5;
            --lime: #8bc34a;
            --amber: #ffc107;
            --cyan: #00bcd4;
            --deep-orange: #ff5722;
            --blue-gray: #607d8b;

            /* Multi-Color Gradients */
            --gradient-ocean: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-sunset: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-forest: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-fire: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-night: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            --gradient-aurora: linear-gradient(135deg, #00c9ff 0%, #92fe9d 100%);
            --gradient-cosmic: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            --gradient-candy: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
            --gradient-midnight: linear-gradient(135deg, #2b1055 0%, #7597de 100%);
            --gradient-dawn: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);

            /* Typography */
            --font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-size-xs: 1rem;
            --font-size-sm: 1.2rem;
            --font-size-base: 1.4rem;
            --font-size-lg: 1.6rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;

            /* Spacing - Reduced sizes */
            --spacing-xs: 0.125rem;
            --spacing-sm: 0.25rem;
            --spacing-md: 0.5rem;
            --spacing-lg: 0.75rem;
            --spacing-xl: 1rem;
            --spacing-2xl: 1.25rem;

            /* Border Radius - Windows 11 rounded corners */
            --radius-sm: 0.45rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.25rem;

            /* Shadows - Windows 11 subtle shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05), 0 1px 1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-xl: 0 8px 10px rgba(0, 0, 0, 0.05), 0 4px 6px rgba(0, 0, 0, 0.06);

            /* Transitions */
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary: #4ca0ff;
            --primary-dark: #3a8ee6;
            --primary-light: #6bb6ff;
            --secondary: #4caf50;
            --accent: #ff9800;
            --danger: #f44336;
            --warning: #ffeb3b;
            --info: #03a9f4;
            --dark: #f0f0f0;
            --light: #2d2d2d;
            --white: #1e1e1e;
            --gray: #b0b0b0;
            --gray-light: #3a3a3a;
            --gray-lighter: #2d2d2d;
            --mica-bg: rgba(30, 30, 30, 0.7);
            --mica-border: rgba(255, 255, 255, 0.1);
            --bg-color: #1e1e1e;
            --text-color: #f0f0f0;
            --card-bg: #2d2d2d;
            --border-color: #3a3a3a;
            --input-bg: #252525;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* System Auto Theme (Media Query) */
        @media (prefers-color-scheme: dark) {
            [data-theme="auto"] {
                --primary: #4ca0ff;
                --primary-dark: #3a8ee6;
                --primary-light: #6bb6ff;
                --secondary: #4caf50;
                --accent: #ff9800;
                --danger: #f44336;
                --warning: #ffeb3b;
                --info: #03a9f4;
                --dark: #f0f0f0;
                --light: #2d2d2d;
                --white: #1e1e1e;
                --gray: #b0b0b0;
                --gray-light: #3a3a3a;
                --gray-lighter: #2d2d2d;
                --mica-bg: rgba(30, 30, 30, 0.7);
                --mica-border: rgba(255, 255, 255, 0.1);
                --bg-color: #1e1e1e;
                --text-color: #f0f0f0;
                --card-bg: #2d2d2d;
                --border-color: #3a3a3a;
                --input-bg: #252525;
                --shadow-color: rgba(0, 0, 0, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* Windows 11 Background with Mica Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(240, 147, 251, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(79, 172, 254, 0.1) 0%, transparent 50%);
            z-index: -2;
            transition: var(--transition);
        }

        [data-theme="dark"] body::before,
        [data-theme="auto"]:where([data-theme="auto"]) body::before {
            background:
                radial-gradient(circle at 20% 80%, rgba(76, 160, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(244, 67, 54, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(3, 169, 244, 0.1) 0%, transparent 50%);
        }

        /* Animated Background Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--gradient-ocean);
            border-radius: 50%;
            opacity: 0.2;
            animation: float 25s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.2;
            }

            90% {
                opacity: 0.2;
            }

            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Authentication Container */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.2) 0%, rgba(0, 183, 195, 0.2) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 9999;
            padding: var(--spacing-lg);
        }

        .auth-container.hidden {
            display: none;
        }

        .auth-card {
            background: var(--mica-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 420px;
            padding: var(--spacing-2xl);
            border: 1px solid var(--mica-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 50%, var(--purple) 100%);
        }

        .auth-card.hidden {
            display: none;
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .logo-img {
            width: 60px;
            height: 60px;
            margin-right: var(--spacing-md);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .logo-text {
            flex: 1;
        }

        .auth-title {
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-2xl);
            font-weight: 700;
        }

        .auth-subtitle {
            color: var(--gray);
            margin-bottom: 0;
            font-size: var(--font-size-base);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--dark);
        }

        .form-group .input-icon {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: var(--font-size-lg);
        }

        .form-group input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) calc(var(--spacing-md) * 2.5);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--white);
            color: var(--dark);
            transition: var(--transition);
            position: relative;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .auth-button {
            width: 100%;
            padding: var(--spacing-md);
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
        }

        .auth-button:hover {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--info) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
        }

        .auth-button i {
            font-size: var(--font-size-lg);
        }

        .auth-links {
            text-align: center;
            margin-top: var(--spacing-lg);
            font-size: var(--font-size-sm);
        }

        .auth-links a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            display: inline-block;
            margin: var(--spacing-xs) var(--spacing-md);
            transition: var(--transition);
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .auth-links a i {
            font-size: var(--font-size-sm);
            margin-right: var(--spacing-xs);
        }

        .alert {
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            font-size: var(--font-size-sm);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-danger {
            background: rgba(232, 17, 35, 0.1);
            color: var(--danger);
            border: 1px solid rgba(232, 17, 35, 0.2);
        }

        .alert-success {
            background: rgba(16, 124, 16, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(16, 124, 16, 0.2);
        }

        /* Main App Container */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-container.hidden {
            display: none;
        }

        /* Top Bar Styles */
        .top-bar {
            background: var(--mica-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-xl);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--mica-border);
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            min-width: 250px;
        }

        .top-bar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
            color: var(--white);
        }

        .top-bar-title-container {
            display: flex;
            flex-direction: column;
        }

        .top-bar-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--dark);
            line-height: 1.2;
        }

        .top-bar-subtitle {
            font-size: var(--font-size-xs);
            color: var(--gray);
            line-height: 1.2;
        }

        .top-bar-center {
            flex: 1;
            display: flex;
            justify-content: center;
            padding: 0 var(--spacing-xl);
        }

        .view-switcher {
            display: flex;
            background: var(--gray-lighter);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xs);
            gap: var(--spacing-xs);
        }

        .view-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-lg);
            background: transparent;
            color: var(--gray);
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .view-btn:hover {
            color: var(--dark);
        }

        .view-btn.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .view-btn i {
            font-size: var(--font-size-base);
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            min-width: 250px;
            justify-content: flex-end;
        }

        /* Settings Button */
        .settings-button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: var(--font-size-lg);
            color: var(--gray);
        }

        .settings-button:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--primary);
        }

        /* User Dropdown Menu */
        .user-dropdown {
            position: relative;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            border-radius: var(--radius-xl);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-menu:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: var(--font-size-sm);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: var(--font-size-sm);
        }

        .user-role {
            font-size: var(--font-size-xs);
            color: var(--gray);
        }

        .dropdown-arrow {
            font-size: var(--font-size-xs);
            color: var(--gray);
            transition: var(--transition);
        }

        .user-menu:hover .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + var(--spacing-sm));
            right: 0;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1000;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            font-size: var(--font-size-sm);
        }

        .dropdown-item:hover {
            background: var(--gray-lighter);
        }

        .dropdown-item i {
            width: 16px;
            text-align: center;
            color: var(--gray);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--gray-light);
            margin: var(--spacing-xs) 0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .settings-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .settings-container {
            background: var(--card-bg);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .settings-modal.show .settings-container {
            transform: scale(1);
        }

        .settings-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .settings-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: var(--font-size-lg);
            color: var(--gray);
        }

        .settings-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--danger);
        }

        .settings-body {
            padding: var(--spacing-xl);
            overflow-y: auto;
            flex: 1;
        }

        .settings-section {
            margin-bottom: var(--spacing-2xl);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .settings-section-title i {
            color: var(--primary);
        }

        /* Settings Form Elements */
        .settings-form-group {
            margin-bottom: var(--spacing-lg);
        }

        .settings-form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-color);
        }

        .settings-form-control {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--input-bg);
            color: var(--text-color);
            transition: var(--transition);
        }

        .settings-form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .settings-form-check {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .settings-form-check-input {
            width: 20px;
            height: 20px;
            margin-right: var(--spacing-md);
            cursor: pointer;
        }

        .settings-form-check-label {
            cursor: pointer;
            user-select: none;
        }

        .settings-button-group {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
        }

        .settings-button {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .settings-button-primary {
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
            color: var(--white);
        }

        .settings-button-primary:hover {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--info) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
        }

        .settings-button-secondary {
            background: var(--gray-lighter);
            color: var(--text-color);
        }

        .settings-button-secondary:hover {
            background: var(--gray-light);
        }

        /* Comprehensive Card - Consistent sizing */
        .comprehensive-card {
            background: var(--mica-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--mica-border);
            margin-bottom: var(--spacing-lg);
            position: relative;
            height: auto;
            min-height: 300px;
        }

        .comprehensive-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 50%, var(--purple) 100%);
        }

        .comprehensive-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }

        .card-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--mica-border);
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.05) 0%, rgba(0, 183, 195, 0.05) 100%);
        }

        .card-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .card-title i {
            color: var(--primary);
            font-size: var(--font-size-xl);
        }

        .card-subtitle {
            font-size: var(--font-size-base);
            color: var(--gray);
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        /* Section Styles */
        .section {
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--gray-light);
        }

        .section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .section-title i {
            font-size: var(--font-size-lg);
        }

        /* Grid Layouts - Reduced gaps */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--spacing-md);
        }

        /* Parameter Cards - Consistent sizing */
        .param-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--gray-light);
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .param-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .param-card:nth-child(1)::before {
            background: var(--primary);
        }

        .param-card:nth-child(2)::before {
            background: var(--secondary);
        }

        .param-card:nth-child(3)::before {
            background: var(--warning);
        }

        .param-card:nth-child(4)::before {
            background: var(--info);
        }

        .param-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .param-label {
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--gray);
            margin-bottom: var(--spacing-xs);
        }

        .param-value {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--spacing-xs);
        }

        .param-unit {
            font-size: var(--font-size-sm);
            color: var(--gray);
            margin-left: var(--spacing-xs);
        }

        .param-input {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            transition: var(--transition);
        }

        .param-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .param-input:disabled {
            background: var(--gray-lighter);
            color: var(--gray);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-sm);
            background: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table th {
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
            color: var(--white);
            font-weight: 600;
            text-align: left;
            padding: var(--spacing-sm);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table tr:hover {
            background: var(--gray-lighter);
        }

        .data-table input {
            width: 100%;
            padding: var(--spacing-xs);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        .data-table input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .data-table .calculated {
            background: var(--gray-lighter);
            padding: var(--spacing-xs);
            border-radius: var(--radius-md);
            text-align: center;
            font-weight: 500;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: var(--spacing-xs);
        }

        .status-good {
            background: var(--secondary);
        }

        .status-warning {
            background: var(--warning);
        }

        .status-danger {
            background: var(--danger);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary) 0%, var(--info) 100%);
            color: var(--white);
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--info) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 120, 212, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(90deg, var(--secondary) 0%, var(--lime) 100%);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: linear-gradient(90deg, #0a6b0a 0%, var(--lime) 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 124, 16, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--gray-light);
            color: var(--dark);
        }

        .btn-outline:hover {
            background: var(--gray-lighter);
        }

        /* Shift Production Specific Styles */
        .shift-controls {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .shift-controls label {
            font-weight: 500;
            display: flex;
            align-items: center;
            color: var(--dark);
        }

        .shift-controls label i {
            margin-right: var(--spacing-sm);
            color: var(--primary);
        }

        .shift-controls select {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            background: var(--white);
            color: var(--dark);
            min-width: 120px;
        }

        .shift-controls select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        .shift-legend {
            display: flex;
            margin-top: var(--spacing-sm);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: var(--font-size-sm);
            color: var(--dark);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: var(--spacing-sm);
            border-radius: var(--radius-xs);
        }

        .shift-a-row {
            background: linear-gradient(90deg, rgba(0, 120, 212, 0.1) 0%, transparent 100%) !important;
        }

        .shift-b-row {
            background: linear-gradient(90deg, rgba(16, 124, 16, 0.1) 0%, transparent 100%) !important;
        }

        .shift-c-row {
            background: linear-gradient(90deg, rgba(216, 59, 1, 0.1) 0%, transparent 100%) !important;
        }

        /* Chart Container Styles */
        .chart-container {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: var(--shadow-sm);
            height: 300px;
            position: relative;
            margin-bottom: var(--spacing-md);
        }

        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .chart-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--dark);
            text-align: center;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .chart-grid-full {
            grid-column: span 2;
        }

        /* Silicon Calculation Specific Styles */
        .silicon-result {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.1) 0%, rgba(0, 183, 195, 0.1) 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            text-align: center;
            border: 1px solid var(--mica-border);
        }

        .silicon-result-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--spacing-xs);
        }

        .silicon-result-label {
            font-size: var(--font-size-base);
            color: var(--gray);
        }

        .formula-box {
            background: var(--gray-lighter);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            font-family: 'Courier New', monospace;
            font-size: var(--font-size-sm);
            border-left: 4px solid var(--primary);
        }

        /* Windows 11 specific animations */
        .win11-animation {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Stock Level Calculator Styles */
        .stock-level-calculator {
            /* All styles from the second file will be prefixed with this class */
        }

        .stock-level-calculator .win11-card {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            transition: all 0.15s ease;
            overflow: hidden;
            margin-bottom: var(--spacing-md);
            height: auto;
            min-height: 200px;
        }

        .stock-level-calculator .win11-card-header {
            background: var(--light);
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .stock-level-calculator .win11-card-title {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .stock-level-calculator .win11-card-title i {
            font-size: var(--font-size-lg);
            background: var(--gradient-ocean);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .win11-card-body {
            padding: var(--spacing-lg);
        }

        .stock-level-calculator .form-label-win11 {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .stock-level-calculator .form-control-win11 {
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            color: var(--text-color);
            transition: all 0.15s ease;
        }

        .stock-level-calculator .form-control-win11:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        .stock-level-calculator .input-group-win11 {
            display: flex;
            margin-bottom: var(--spacing-md);
        }

        .stock-level-calculator .input-group-text-win11 {
            background: var(--light);
            border: 1px solid var(--border-color);
            border-left: none;
            border-radius: 0 var(--radius-md) var(--radius-md) 0;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--gray);
            display: flex;
            align-items: center;
        }

        .stock-level-calculator .form-control-win11.input-group-field {
            border-radius: var(--radius-md) 0 0 var(--radius-md);
            flex: 1;
        }

        .stock-level-calculator .btn-win11 {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .stock-level-calculator .btn-win11-primary {
            background: var(--primary);
            color: white;
        }

        .stock-level-calculator .btn-win11-primary:hover {
            background: var(--primary-light);
        }

        .stock-level-calculator .btn-win11-gradient {
            background: var(--gradient-ocean);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stock-level-calculator .btn-win11-gradient:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .stock-level-calculator .btn-win11-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
        }

        .stock-level-calculator .btn-win11-gradient:hover::before {
            left: 100%;
        }

        .stock-level-calculator .metric-card-win11 {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            transition: all 0.15s ease;
            position: relative;
            overflow: hidden;
            height: 100%;
            min-height: 100px;
        }

        .stock-level-calculator .metric-card-win11::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            opacity: 0.1;
            border-radius: 50%;
            transform: translate(15px, -15px);
        }

        .stock-level-calculator .metric-card-win11:nth-child(1)::before {
            background: var(--gradient-ocean);
        }

        .stock-level-calculator .metric-card-win11:nth-child(2)::before {
            background: var(--gradient-sunset);
        }

        .stock-level-calculator .metric-card-win11:nth-child(3)::before {
            background: var(--gradient-forest);
        }

        .stock-level-calculator .metric-card-win11:nth-child(4)::before {
            background: var(--gradient-fire);
        }

        .stock-level-calculator .metric-card-win11:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .stock-level-calculator .metric-label-win11 {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--spacing-xs);
        }

        .stock-level-calculator .metric-value-win11 {
            font-size: var(--font-size-xl);
            font-weight: 700;
            line-height: 1;
            margin-bottom: var(--spacing-xs);
        }

        .stock-level-calculator .metric-value-win11:nth-child(2) {
            background: var(--gradient-ocean);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .metric-value-win11:nth-child(4) {
            background: var(--gradient-sunset);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .metric-value-win11:nth-child(6) {
            background: var(--gradient-forest);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .metric-value-win11:nth-child(8) {
            background: var(--gradient-fire);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .metric-unit-win11 {
            font-size: var(--font-size-sm);
            color: var(--gray);
            font-weight: 500;
            margin-left: var(--spacing-xs);
        }

        .stock-level-calculator .progress-win11 {
            height: 3px;
            background: var(--border-color);
            border-radius: var(--radius-xs);
            overflow: hidden;
            margin: var(--spacing-sm) 0;
        }

        .stock-level-calculator .progress-bar-win11 {
            height: 100%;
            background: var(--gradient-ocean);
            border-radius: var(--radius-xs);
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .stock-level-calculator .progress-bar-win11::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .stock-level-calculator .alert-win11 {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid;
            margin-top: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .stock-level-calculator .alert-win11-info {
            background: rgba(0, 120, 212, 0.1);
            border-color: rgba(0, 120, 212, 0.3);
            color: #005a9e;
        }

        .stock-level-calculator .alert-win11-warning {
            background: rgba(255, 185, 0, 0.1);
            border-color: rgba(255, 185, 0, 0.3);
            color: #b8860b;
        }

        .stock-level-calculator .alert-win11-danger {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #dc2626;
        }

        .stock-level-calculator .scenario-card-win11 {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: all 0.15s ease;
            height: 100%;
            min-height: 300px;
            position: relative;
        }

        .stock-level-calculator .scenario-card-win11::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
        }

        .stock-level-calculator .scenario-card-win11:nth-child(1)::before {
            background: var(--gradient-ocean);
        }

        .stock-level-calculator .scenario-card-win11:nth-child(2)::before {
            background: var(--gradient-sunset);
        }

        .stock-level-calculator .scenario-card-win11:nth-child(3)::before {
            background: var(--gradient-forest);
        }

        .stock-level-calculator .scenario-card-win11:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-3px);
        }

        .stock-level-calculator .scenario-header-win11 {
            background: var(--light);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .stock-level-calculator .scenario-title-win11 {
            background: transparent;
            border: none;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--text-color);
            width: 100%;
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: all 0.15s ease;
        }

        .stock-level-calculator .scenario-title-win11:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .stock-level-calculator .scenario-title-win11:focus {
            background: var(--card-bg);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
            outline: none;
        }

        .stock-level-calculator .scenario-body-win11 {
            padding: var(--spacing-md);
        }

        .stock-level-calculator .scenario-metric-win11 {
            background: var(--light);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            transition: all 0.15s ease;
        }

        .stock-level-calculator .scenario-metric-win11:hover {
            background: var(--card-bg);
            box-shadow: var(--shadow-md);
            transform: translateX(3px);
        }

        .stock-level-calculator .scenario-metric-label-win11 {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: var(--gray);
            margin-bottom: var(--spacing-xs);
        }

        .stock-level-calculator .scenario-metric-value-win11 {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--text-color);
        }

        .stock-level-calculator .badge-win11 {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-xs);
            font-size: var(--font-size-xs);
            font-weight: 600;
            display: inline-block;
        }

        .stock-level-calculator .badge-win11-gradient {
            background: var(--gradient-fire);
            color: white;
        }

        .stock-level-calculator .badge-win11-success {
            background: var(--secondary);
            color: white;
        }

        .stock-level-calculator .badge-win11-warning {
            background: var(--accent);
            color: white;
        }

        .stock-level-calculator .badge-win11-danger {
            background: var(--danger);
            color: white;
        }

        .stock-level-calculator .form-range-win11 {
            height: 3px;
            background: var(--border-color);
            border-radius: var(--radius-xs);
            outline: none;
            margin: var(--spacing-sm) 0;
            -webkit-appearance: none;
        }

        .stock-level-calculator .form-range-win11::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: var(--shadow-md);
        }

        .stock-level-calculator .form-range-win11::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: var(--shadow-md);
        }

        .stock-level-calculator .toggle-win11 {
            display: flex;
            background: var(--light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
        }

        .stock-level-calculator .toggle-option-win11 {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            border: none;
            border-radius: var(--radius-xs);
            font-size: var(--font-size-sm);
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
        }

        .stock-level-calculator .toggle-option-win11.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .stock-level-calculator .chart-container-win11 {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            margin-top: var(--spacing-md);
            height: auto;
            min-height: 400px;
        }

        .stock-level-calculator .chart-header-win11 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .stock-level-calculator .chart-title-win11 {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-color);
        }

        .stock-level-calculator .chart-options-win11 {
            display: flex;
            gap: var(--spacing-xs);
        }

        .stock-level-calculator .chart-option-btn-win11 {
            padding: var(--spacing-xs) var(--spacing-sm);
            background: var(--light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .stock-level-calculator .chart-option-btn-win11:hover {
            background: rgba(0, 0, 0, 0.04);
        }

        .stock-level-calculator .chart-option-btn-win11.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .stock-level-calculator .info-box-win11 {
            background: linear-gradient(135deg, rgba(0, 120, 212, 0.05), rgba(0, 120, 212, 0.1));
            border-left: 2px solid var(--primary);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .stock-level-calculator .info-box-win11 h6 {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-xs);
        }

        .stock-level-calculator .info-box-win11 p {
            color: var(--text-color);
            margin: 0;
            font-size: var(--font-size-xs);
            line-height: 1.3;
        }

        .stock-level-calculator .parameter-description-win11 {
            font-size: var(--font-size-xs);
            color: var(--gray);
            margin-top: var(--spacing-xs);
            line-height: 1.3;
        }

        .stock-level-calculator .is-invalid-win11 {
            border-color: var(--danger) !important;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2) !important;
        }

        .stock-level-calculator .validation-message-win11 {
            font-size: var(--font-size-xs);
            color: var(--danger);
            margin-top: var(--spacing-xs);
            display: none;
        }

        .stock-level-calculator .validation-message-win11.show {
            display: block;
        }

        .stock-level-calculator .stats-grid-win11 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .stock-level-calculator .editable-range-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .stock-level-calculator .editable-range-input {
            flex: 1;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-sm);
            color: var(--text-color);
            transition: all 0.15s ease;
        }

        .stock-level-calculator .editable-range-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        .stock-level-calculator .editable-range-slider {
            flex: 2;
        }

        .stock-level-calculator .editable-range-value {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
        }

        .stock-level-calculator .section-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0 var(--spacing-lg) 0;
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-color);
        }

        .stock-level-calculator .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .stock-level-calculator .section-title i {
            font-size: var(--font-size-xl);
            background: var(--gradient-ocean);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stock-level-calculator .animate-number {
            display: inline-block;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 120, 212, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(0, 120, 212, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 120, 212, 0);
            }
        }

        .stock-level-calculator .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .top-bar-center {
                padding: 0 var(--spacing-md);
            }

            .view-btn span {
                display: none;
            }

            .view-btn {
                padding: var(--spacing-sm);
            }

            .view-btn i {
                font-size: var(--font-size-lg);
            }
        }

        @media (max-width: 768px) {

            .grid-2,
            .grid-3,
            .grid-4 {
                grid-template-columns: 1fr;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .chart-grid-full {
                grid-column: span 1;
            }

            .main-content {
                padding: var(--spacing-md);
            }

            .top-bar {
                padding: 0 var(--spacing-lg);
            }

            .top-bar-left {
                min-width: auto;
            }

            .top-bar-subtitle {
                display: none;
            }

            .top-bar-center {
                padding: 0 var(--spacing-sm);
            }

            .top-bar-right {
                min-width: auto;
            }

            .user-info {
                display: none;
            }

            .dropdown-menu {
                right: -50px;
            }

            .card-body {
                padding: var(--spacing-md);
            }

            .section {
                margin-bottom: var(--spacing-lg);
                padding-bottom: var(--spacing-md);
            }

            .settings-container {
                width: 95%;
                max-height: 95vh;
            }
        }

        @media (max-width: 480px) {
            .param-value {
                font-size: var(--font-size-base);
            }

            .user-info {
                display: none;
            }

            .dropdown-menu {
                right: -50px;
            }
        }
    </style>
</head>

<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Authentication Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-card" id="loginCard">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/en/thumb/8/87/SAIL_logo.svg/1200px-SAIL_logo.svg.png" alt="SAIL" class="logo-img">
                <div class="logo-text">
                    <h1 class="auth-title">BLAST FURNACE</h1>
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div>
                </div>
            </div>
            <div id="loginAlert" class="alert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" id="loginEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="loginPassword" name="password" required>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            <div class="auth-links">
                <a href="#" id="showRegister"><i class="fas fa-user-plus"></i> Create Account</a>
                <a href="#" id="showForgotPassword"><i class="fas fa-key"></i> Forgot Password?</a>
            </div>
        </div>

        <div class="auth-card hidden" id="registerCard">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/en/thumb/8/87/SAIL_logo.svg/1200px-SAIL_logo.svg.png" alt="SAIL" class="logo-img">
                <div class="logo-text">
                    <h1 class="auth-title">CREATE ACCOUNT</h1>
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div>
                </div>
            </div>
            <div id="registerAlert" class="alert"></div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="registerName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" id="registerEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="registerPassword" name="password" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </form>
            <div class="auth-links">
                <a href="#" id="showLoginFromRegister"><i class="fas fa-arrow-left"></i> Back to Login</a>
            </div>
        </div>

        <div class="auth-card hidden" id="forgotPasswordCard">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/en/thumb/8/87/SAIL_logo.svg/1200px-SAIL_logo.svg.png" alt="SAIL" class="logo-img">
                <div class="logo-text">
                    <h1 class="auth-title">RESET PASSWORD</h1>
                    <div class="auth-subtitle">ROURKELA STEEL PLANT</div>
                </div>
            </div>
            <div id="forgotPasswordAlert" class="alert"></div>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotEmail">Email</label>
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" id="forgotEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="newPassword" name="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="confirmNewPassword" name="confirmNewPassword" required>
                </div>
                <button type="submit" class="auth-button">
                    <i class="fas fa-key"></i> Reset Password
                </button>
            </form>
            <div class="auth-links">
                <a href="#" id="showLoginFromForgot"><i class="fas fa-arrow-left"></i> Back to Login</a>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container hidden" id="appContainer">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-left">
                <div class="top-bar-logo">
                    <i class="fas fa-industry"></i>
                </div>
                <div class="top-bar-title-container">
                    <div class="top-bar-title">BLAST FURNACE</div>
                    <div class="top-bar-subtitle">ROURKELA STEEL PLANT</div>
                </div>
            </div>

            <div class="top-bar-center">
                <div class="view-switcher">
                    <button class="view-btn active" data-view="comprehensive">
                        <i class="fas fa-chart-line"></i>
                        <span>Burden Calculation</span>
                    </button>
                    <button class="view-btn" data-view="shift">
                        <i class="fas fa-clock"></i>
                        <span>Shift Production</span>
                    </button>
                    <button class="view-btn" data-view="stock">
                        <i class="fas fa-calculator"></i>
                        <span>Stock Level</span>
                    </button>
                </div>
            </div>

            <div class="top-bar-right">
                <div class="settings-button" id="settingsButton" title="Settings">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="user-dropdown">
                    <div class="user-menu" id="userMenu">
                        <div class="user-avatar" id="userAvatar">JS</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">John Smith</div>
                            <div class="user-role" id="userRole">Operator</div>
                        </div>
                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                    </div>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="#" class="dropdown-item" id="profileLink">
                            <i class="fas fa-user-circle"></i> My Profile
                        </a>
                        <a href="#" class="dropdown-item" id="settingsLink">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" id="logoutLink">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->

        <!-- Material Properties Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-flask"></i>
                Material Properties & Composition
            </h3>
            <div class="table-container" style="overflow-x: auto; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                <table class="data-table" id="comp-materials-table">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>C (%)</th>
                            <th>Moisture (%)</th>
                            <th>FE (%)</th>
                            <th>SiO2 (%)</th>
                            <th>CAO (%)</th>
                            <th>MGO (%)</th>
                            <th>AL203 (%)</th>
                            <th>Density</th>
                        </tr>
                    </thead>
                    <tbody id="comp-materials-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Input Quantities Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-weight-hanging"></i>
                Input Quantities & Calculated Values
            </h3>
            <div class="table-container" style="overflow-x: auto; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);">
                <table class="data-table" id="comp-inputs-table">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Weight (Kg)</th>
                            <th>Moisture Adj.</th>
                            <th>Dry Weight</th>
                            <th>Fe Input</th>
                            <th>C Input</th>
                            <th>SiO2 Input</th>
                            <th>CaO Input</th>
                            <th>MgO Input</th>
                            <th>Al2O3 Input</th>
                        </tr>
                    </thead>
                    <tbody id="comp-inputs-tbody"></tbody>
                </table>
            </div>
        </div>

        <!-- Consumption Rates Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-chart-pie"></i>
                Consumption Rates & Efficiency Metrics
            </h3>
            <div class="grid-4">
                <div class="param-card">
                    <div class="param-label">Hot Metal</div>
                    <div class="param-value" id="comp-Hot-Metal-2">0<span class="param-unit">tons</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Coke Rate</div>
                    <div class="param-value" id="comp-Coke-Rate-2">0<span class="param-unit">kg/THM</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">NC Rate</div>
                    <div class="param-value" id="comp-Ncoke-Rate">0<span class="param-unit">kg/THM</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">PCI Rate</div>
                    <div class="param-value" id="comp-PCI-Rate">0<span class="param-unit">kg/THM</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Rate</div>
                    <div class="param-value" id="comp-Slag-Rate">0<span class="param-unit">kg/THM</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Fuel Rate</div>
                    <div class="param-value" id="comp-Fuel-Rate-2">0<span class="param-unit">kg/THM</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">C Efficiency</div>
                    <div class="param-value" id="comp-C-Efficiency">0<span class="param-unit">%</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Yield</div>
                    <div class="param-value" id="comp-Yield">0<span class="param-unit">%</span></div>
                </div>
            </div>
        </div>
        <!-- Percentage Calculations Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-cube"></i>
                Percentage,Volume & Ratio Calculation
            </h3>
            <div class="grid-4">
                <div class="param-card">
                    <div class="param-label">Coke </div>
                    <div class="param-value" id="comp-Coke-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Coke-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Ncoke </div>
                    <div class="param-value" id="comp-Ncoke-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Ncoke-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Sinter </div>
                    <div class="param-value" id="comp-Sinter-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Sinter-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>

                <div class="param-card">
                    <div class="param-label">Ore </div>
                    <div class="param-value" id="comp-Ore-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Ore-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Pellets </div>
                    <div class="param-value" id="comp-Pellets-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Pellets-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Scrap </div>
                    <div class="param-value" id="comp-Scrap-Percent">0<span class="param-unit">%</span></div>
                    <div class="param-value" id="comp-Scrap-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Total Volume</div>
                    <div class="param-value" id="comp-Total-Volume">0<span class="param-unit">mÂ³</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Ore/Coke Ratio</div>
                    <div class="param-value" id="comp-Ore-Coke-Ratio">0</div>
                    <div class="param-label">Fe/C Ratio</div>
                    <div class="param-value" id="comp-Fe-C-Ratio">0</div>
                </div>
            </div>
        </div>



        <!-- Input Totals Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-calculator"></i>
                Input Totals & Slag Analysis
            </h3>
            <div class="grid-4">
                <div class="param-card">
                    <div class="param-label">Total Weight</div>
                    <div class="param-value" id="comp-Total-Weight">0<span class="param-unit">Kg</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Total Fe Input</div>
                    <div class="param-value" id="comp-Total-Fe-Input">0<span class="param-unit">Kg</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Total C Input</div>
                    <div class="param-value" id="comp-Total-C-Input">0<span class="param-unit">Kg</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Weight</div>
                    <div class="param-value" id="comp-Slag-Weight">0<span class="param-unit">Kg</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Basicity</div>
                    <div class="param-value" id="comp-Slag-Basicity">0</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Alumina Ratio</div>
                    <div class="param-value" id="comp-Alumina-Ratio">0</div>
                </div>
                <div class="param-card">
                    <div class="param-label">CaO/SiO2</div>
                    <div class="param-value" id="comp-CaO-SiO2">0</div>
                </div>
                <div class="param-card">
                    <div class="param-label">MgO/SiO2</div>
                    <div class="param-value" id="comp-MgO-SiO2">0</div>
                </div>
            </div>
        </div>
        <!-- Silicon Calculation Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-calculator"></i>
                Expected Silicon % in Hot Metal
            </h3>
            <div class="grid-3">
                <div class="param-card">
                    <div class="param-label">Slag SiO2 (%)</div>
                    <input type="number" class="param-input" id="slag-sio2" value="32.5" step="0.1" onchange="calculateSilicon()">
                    <div class="param-unit">%</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag CaO (%)</div>
                    <input type="number" class="param-input" id="slag-cao" value="38.5" step="0.1" onchange="calculateSilicon()">
                    <div class="param-unit">%</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag MgO (%)</div>
                    <input type="number" class="param-input" id="slag-mgo" value="8.5" step="0.1" onchange="calculateSilicon()">
                    <div class="param-unit">%</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Al2O3 (%)</div>
                    <input type="number" class="param-input" id="slag-al2o3" value="18.5" step="0.1" onchange="calculateSilicon()">
                    <div class="param-unit">%</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Temperature</div>
                    <input type="number" class="param-input" id="slag-temp" value="1500" step="1" onchange="calculateSilicon()">
                    <div class="param-unit">Â°C</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Hot Metal Temperature</div>
                    <input type="number" class="param-input" id="hm-temp" value="1500" step="1" onchange="calculateSilicon()">
                    <div class="param-unit">Â°C</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Basicity</div>
                    <div class="param-value" id="slag-basicity">1.18<span class="param-unit"></span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Volume</div>
                    <input type="number" class="param-input" id="slag-volume" value="250" step="1" onchange="calculateSilicon()">
                    <div class="param-unit">kg/THM</div>
                </div>
                <div class="param-card">
                    <div class="param-label">K Factor</div>
                    <input type="number" class="param-input" id="k-factor" value="0.35" step="0.01" onchange="calculateSilicon()">
                    <div class="param-unit"></div>
                </div>
            </div>

            <div class="silicon-result">
                <div class="silicon-result-value" id="silicon-result">1.05</div>
                <div class="silicon-result-label">Expected Silicon % in Hot Metal</div>
            </div>
        </div>



        <!-- Blast Parameters Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-fire"></i>
                Blast Parameters & Operating Conditions
            </h3>
            <div class="grid-3">
                <div class="param-card">
                    <div class="param-label">Blast Volume</div>
                    <input type="number" class="param-input" id="comp-blastVolume" value="150000" onchange="calculateAllComprehensive()">
                    <div class="param-unit">NmÂ³/hr</div>
                </div>
                <div class="param-card">
                    <div class="param-label">O2 Enrichment</div>
                    <input type="number" class="param-input" id="comp-o2Enrichment" value="10500" onchange="calculateAllComprehensive()">
                    <div class="param-unit">NmÂ³/hr</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Blast Temperature</div>
                    <input type="number" class="param-input" id="comp-blastTemp" value="1150" onchange="calculateAllComprehensive()">
                    <div class="param-unit">Â°C</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Top Pressure</div>
                    <input type="number" class="param-input" id="comp-topPressure" value="1.87" onchange="calculateAllComprehensive()">
                    <div class="param-unit">kg/cmÂ²</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Blast Pressure</div>
                    <input type="number" class="param-input" id="comp-blastPressure" value="3.15" step="0.01" onchange="calculateAllComprehensive()">
                    <div class="param-unit">kg/cmÂ²</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Gas Generation</div>
                    <input type="number" class="param-input" id="comp-Gas-Generation" value="264000" onchange="calculateAllComprehensive()">
                    <div class="param-unit">NmÂ³/hr</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Pressure Drop</div>
                    <div class="param-value" id="comp-dp">1.28<span class="param-unit">kg/cmÂ²</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Tuyere Velocity</div>
                    <div class="param-value" id="comp-tuyereVelocity">220<span class="param-unit">m/s</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Raceway Flame Temp</div>
                    <div class="param-value" id="comp-flameTemp">2150<span class="param-unit">Â°C</span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">O2 Percentage</div>
                    <div class="param-value" id="comp-o2Percentage">25.0<span class="param-unit">%</span></div>
                </div>
            </div>
        </div>
        <!-- Furnace Resistance & Permeability Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-cogs"></i>
                Furnace Resistance & Permeability
            </h3>
            <div class="grid-3">
                <div class="param-card">
                    <div class="param-label">Furnace Resistance</div>
                    <div class="param-value" id="comp-Furnace-Resistance">0<span class="param-unit"></span></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Furnace Permeability</div>
                    <div class="param-value" id="comp-Furnace-Permeability">0<span class="param-unit"></span></div>
                </div>
            </div>
        </div>




        <!-- Hearth Status Section -->
        <div class="section">
            <h3 class="section-title">
                <i class="fas fa-temperature-high"></i>
                Hearth Status & Critical Parameters
            </h3>
            <div class="grid-3">
                <div class="param-card">
                    <div class="param-label">Furnace Production</div>
                    <input type="number" class="param-input" id="comp-production" value="6600" oninput="calculateAllComprehensive()">
                    <div class="param-unit">t/day</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Rate</div>
                    <input type="number" class="param-input" id="comp-slagRate" value="250" oninput="calculateAllComprehensive()">
                    <div class="param-unit">kg/THM</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Hot Metal Density</div>
                    <input type="number" class="param-input" id="comp-hmDensity" value="7.2" step="0.1" oninput="calculateAllComprehensive()">
                    <div class="param-unit">t/mÂ³</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Slag Density</div>
                    <input type="number" class="param-input" id="comp-slagDensity" value="2.4" step="0.1" oninput="calculateAllComprehensive()">
                    <div class="param-unit">t/mÂ³</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Hearth Voidage</div>
                    <input type="number" class="param-input" id="comp-hearthVoidage" value="20" step="0.1" oninput="calculateAllComprehensive()">
                    <div class="param-unit">%</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Hearth Diameter</div>
                    <input type="number" class="param-input" id="comp-hearthDiameter" value="10.8" step="0.1" oninput="calculateAllComprehensive()">
                    <div class="param-unit">m</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Tuyere Height</div>
                    <input type="number" class="param-input" id="comp-tuyereHeight" value="3.9" step="0.1" oninput="calculateAllComprehensive()">
                    <div class="param-unit">m</div>
                </div>
                <div class="param-card">
                    <div class="param-label">Time to Tuyeres</div>
                    <div class="param-value" id="comp-timeToTuyeres">0<span class="param-unit">minutes</span></div>
                    <div class="status-indicator status-warning"></div>
                </div>
                <div class="param-card">
                    <div class="param-label">Production Rate</div>
                    <div class="param-value" id="comp-productionRate">0<span class="param-unit">t/min</span></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="calculateAllComprehensive()">
                <i class="fas fa-calculator"></i> Recalculate All
            </button>
            <button class="btn btn-secondary" onclick="saveDefaultData()">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-outline" onclick="resetToDefault()">
                <i class="fas fa-undo"></i> Reset
            </button>
            <button class="btn btn-outline" onclick="exportData()">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </div>
    </div>
    </div>

    <!-- Shift Production View -->
    <div class="comprehensive-card win11-animation" id="shift-view" style="display: none;">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-clock"></i>
                24-Hour Shift Production
            </h2>
            <p class="card-subtitle">Monitor and analyze production data across all three shifts</p>
        </div>

        <div class="card-body">
            <div class="shift-controls">
                <label for="shift-filter">
                    <i class="fas fa-filter"></i> Filter by Shift:
                </label>
                <select id="shift-filter" onchange="filterShiftColumns()">
                    <option value="all">All Shifts</option>
                    <option value="A">Shift A (7:00-15:00)</option>
                    <option value="B">Shift B (15:00-23:00)</option>
                    <option value="C">Shift C (23:00-7:00)</option>
                </select>

                <button class="btn btn-primary" onclick="calculateAllShiftRows()">
                    <i class="fas fa-calculator"></i> Recalculate All
                </button>

                <button class="btn btn-outline" onclick="generateSampleData()">
                    <i class="fas fa-database"></i> Generate Sample Data
                </button>
            </div>

            <div class="shift-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(0, 120, 212, 0.3);"></div>
                    <span>Shift A</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(16, 124, 16, 0.3);"></div>
                    <span>Shift B</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(216, 59, 1, 0.3);"></div>
                    <span>Shift C</span>
                </div>
            </div>

            <div class="table-container" style="overflow-x: auto; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); margin-top: var(--spacing-md);">
                <table class="data-table" id="shift-table">
                    <thead>
                        <tr>
                            <th>Hour</th>
                            <th>Shift</th>
                            <th>Coke</th>
                            <th>Sinter</th>
                            <th>Iron Ore</th>
                            <th>Pellets</th>
                            <th>Scraps</th>
                            <th>Nut Coke</th>
                            <th>PCI</th>
                            <th>CB Vol</th>
                            <th>O2 Vol</th>
                            <th>Hot Metal</th>
                            <th>Coke Rate</th>
                            <th>NC Rate</th>
                            <th>PCI Rate</th>
                            <th>Fuel Rate</th>
                            <th>SPO2 Rate</th>
                        </tr>
                    </thead>
                    <tbody id="shift-tbody"></tbody>
                </table>
            </div>

            <!-- Charts and Trends Section -->
            <div class="section">
                <h3 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Production Trends & Analysis
                </h3>

                <div class="chart-grid">
                    <div class="chart-container">
                        <div class="chart-title">Hot Metal Production by Hour</div>
                        <canvas id="hotMetalChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Material Consumption by Shift</div>
                        <canvas id="materialConsumptionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Fuel Rate Comparison</div>
                        <canvas id="fuelRateChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Production Efficiency by Shift</div>
                        <canvas id="efficiencyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="action-buttons" style="margin-top: var(--spacing-md);">
                <button class="btn btn-primary" onclick="exportShiftData()">
                    <i class="fas fa-download"></i> Export
                </button>
                <button class="btn btn-outline" onclick="clearShiftData()">
                    <i class="fas fa-trash"></i> Clear
                </button>
                <button class="btn btn-outline" onclick="updateCharts()">
                    <i class="fas fa-sync-alt"></i> Update
                </button>
            </div>
        </div>
    </div>

    <!-- Stock Level Calculator View -->
    <div class="comprehensive-card win11-animation stock-level-calculator" id="stock-view" style="display: none;">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-calculator"></i>
                Blast Furnace Stock Level
            </h2>
            <p class="card-subtitle">Calculate and analyze stock levels for optimal furnace operation</p>
        </div>

        <div class="card-body">
            <!-- Parameters Section -->
            <div class="section-header">
                <h2 class="section-title">
                    <i class="bi bi-sliders"></i> Input Parameters
                </h2>
            </div>

            <div class="row">
                <div class="col-lg-5">
                    <!-- Basic Parameters Card -->
                    <div class="win11-card">
                        <div class="win11-card-header">
                            <h5 class="win11-card-title">
                                <i class="bi bi-gear-fill"></i> Basic Parameters
                            </h5>
                        </div>
                        <div class="win11-card-body">
                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-rulers"></i>Furnace Hearth Diameter
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="furnaceDiameter" value="10" step="0.1" min="5" max="20">
                                    <span class="input-group-text-win11">m</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Internal diameter of the furnace hearth where burden materials accumulate.
                                </div>
                                <div class="validation-message-win11" id="furnaceDiameter-error">
                                    Please enter a value between 5 and 20 meters
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-box-seam"></i>Burden Density
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="burdenDensity" value="1.6" step="0.1" min="1" max="3">
                                    <span class="input-group-text-win11">ton/mÂ³</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Average bulk density of the burden materials (coke, iron ore, fluxes).
                                </div>
                                <div class="validation-message-win11" id="burdenDensity-error">
                                    Please enter a value between 1 and 3 ton/mÂ³
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-speedometer2"></i>Production Rate
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="productionRate" value="5000" step="100" min="1000" max="15000">
                                    <span class="input-group-text-win11">ton/day</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Daily hot metal production capacity. Directly influences burden consumption rate.
                                </div>
                                <div class="validation-message-win11" id="productionRate-error">
                                    Please enter a value between 1000 and 15000 ton/day
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-droplet"></i>Specific Consumption
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="specificConsumption" value="1.65" step="0.01" min="1" max="3">
                                    <span class="input-group-text-win11">ton/ton</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Ratio of burden materials consumed per ton of hot metal produced.
                                </div>
                                <div class="validation-message-win11" id="specificConsumption-error">
                                    Please enter a value between 1 and 3 ton/ton
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-arrow-up-circle"></i>Charging Rate
                                    <span class="badge-win11 badge-win11-warning ms-2">Editable</span>
                                </label>
                                <div class="editable-range-group">
                                    <input type="number" class="editable-range-input" id="chargingRateInput" value="250" min="50" max="500" step="10">
                                    <input type="range" class="form-range-win11 editable-range-slider" id="chargingRate" value="250" min="50" max="500" step="10">
                                    <div class="editable-range-value" id="chargingRateValue">250 mÂ³/hr</div>
                                </div>
                                <div class="parameter-description-win11">
                                    Volumetric rate at which burden materials are charged into the furnace. Adjustable from 50-500 mÂ³/hr.
                                </div>
                                <div class="validation-message-win11" id="chargingRate-error">
                                    Please enter a value between 50 and 500 mÂ³/hr
                                </div>
                            </div>

                            <!-- Bidirectional Target Stock Rise / Time to Achieve -->
                            <div class="mb-3">
                                <div class="toggle-win11">
                                    <button class="toggle-option-win11 active" id="Mode" onclick="setCalculationMode('')">
                                        <i class="bi bi-arrows-expand"></i> Stock Rise
                                    </button>
                                    <button class="toggle-option-win11" id="timeMode" onclick="setCalculationMode('time')">
                                        <i class="bi bi-clock"></i> Time to Achieve
                                    </button>
                                </div>

                                <div id="InputContainer">
                                    <label class="form-label-win11">
                                        <i class="bi bi-graph-up-arrow"></i>Target Stock Rise
                                    </label>
                                    <div class="input-group-win11">
                                        <input type="number" class="form-control-win11 input-group-field" id="targetStockRise" value="3" step="0.1" min="0.5" max="10">
                                        <span class="input-group-text-win11">m</span>
                                    </div>
                                    <div class="parameter-description-win11">
                                        Desired increase in stock level height. Typical range: 0.5-30 meters.
                                    </div>
                                    <div class="validation-message-win11" id="targetStockRise-error">
                                        Please enter a value between 0.5 and 30 meters
                                    </div>
                                </div>

                                <div id="timeInputContainer" style="display: none;">
                                    <label class="form-label-win11">
                                        <i class="bi bi-clock"></i>Target Time to Achieve
                                    </label>
                                    <div class="input-group-win11">
                                        <input type="number" class="form-control-win11 input-group-field" id="targetTime" value="6.7" step="0.1" min="1" max="24">
                                        <span class="input-group-text-win11">hrs</span>
                                    </div>
                                    <div class="parameter-description-win11">
                                        Available time window for stock level adjustment.
                                    </div>
                                    <div class="validation-message-win11" id="targetTime-error">
                                        Please enter a value between 1 and 24 hours
                                    </div>
                                </div>
                            </div>

                            <button class="btn-win11 btn-win11-gradient w-100 pulse" onclick="calculateAllStockLevel()">
                                <i class="bi bi-lightning-fill"></i> Calculate Analysis
                            </button>
                        </div>
                    </div>

                    <!-- Advanced Parameters Card -->
                    <div class="win11-card">
                        <div class="win11-card-header">
                            <h5 class="win11-card-title">
                                <i class="bi bi-cpu"></i> Advanced Operating Parameters
                            </h5>
                        </div>
                        <div class="win11-card-body">
                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-wind"></i>Blast Volume
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="blastVolume" value="155000" step="1000" min="50000" max="300000">
                                    <span class="input-group-text-win11">NmÂ³/hr</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Volume of hot blast air at standard conditions (0Â°C, 1 atm).
                                </div>
                                <div class="validation-message-win11" id="blastVolume-error">
                                    Please enter a value between 50000 and 300000 NmÂ³/hr
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label-win11">
                                    <i class="bi bi-oxygen-tank"></i>Oxygen Enrichment
                                </label>
                                <div class="input-group-win11">
                                    <input type="number" class="form-control-win11 input-group-field" id="oxygenVolume" value="10700" step="100" min="0" max="50000">
                                    <span class="input-group-text-win11">NmÂ³/hr</span>
                                </div>
                                <div class="parameter-description-win11">
                                    Pure oxygen injection to increase blast oxygen content above 21%.
                                </div>
                                <div class="validation-message-win11" id="oxygenVolume-error">
                                    Please enter a value between 0 and 50000 NmÂ³/hr
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-7">
                    <!-- Baseline Calculations Card -->
                    <div class="win11-card">
                        <div class="win11-card-header">
                            <h5 class="win11-card-title">
                                <i class="bi bi-diagram-3-fill"></i> Real-time Baseline Analysis
                            </h5>
                        </div>
                        <div class="win11-card-body">
                            <!-- Step 1 -->
                            <div class="mb-3">
                                <h6 class="mb-2">
                                    <span class="badge bg-primary me-2">1</span>
                                    Establish Baseline Parameters
                                </h6>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Furnace Diameter</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="paramDiameter">10.0</span>
                                                <span class="metric-unit-win11">m</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Cross-sectional Area</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="paramArea">78.54</span>
                                                <span class="metric-unit-win11">mÂ²</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Burden Density</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="paramDensity">1.60</span>
                                                <span class="metric-unit-win11">ton/mÂ³</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Production Rate</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="paramProduction">208.3</span>
                                                <span class="metric-unit-win11">ton/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-box-win11 mt-2">
                                    <h6>Baseline Configuration</h6>
                                    <p>Current furnace operating parameters establish the foundation for all stock level calculations.</p>
                                </div>
                            </div>

                            <!-- Step 2 -->
                            <div class="mb-3">
                                <h6 class="mb-2">
                                    <span class="badge bg-primary me-2">2</span>
                                    Calculate Consumption Rate
                                </h6>
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Burden Consumption</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="burdenConsumption">343.7</span>
                                                <span class="metric-unit-win11">ton/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Volumetric Rate</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="volumetricConsumption">214.8</span>
                                                <span class="metric-unit-win11">mÂ³/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Linear Rate</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="linearConsumption">2.73</span>
                                                <span class="metric-unit-win11">m/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert-win11 alert-win11-info">
                                    <i class="bi bi-info-circle-fill me-2"></i>
                                    <strong>Stock Depletion:</strong> Current consumption rate of 2.73 m/hr indicates stock level is falling at this velocity.
                                </div>
                            </div>

                            <!-- Step 3 -->
                            <div class="mb-3">
                                <h6 class="mb-2">
                                    <span class="badge bg-primary me-2">3</span>
                                    Net Fill Analysis
                                </h6>
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Charging Rate</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="chargingRateDisplay">250</span>
                                                <span class="metric-unit-win11">mÂ³/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="metric-card-win11">
                                            <div class="metric-label-win11">Net Fill Rate</div>
                                            <div class="metric-value-win11">
                                                <span class="animate-number" id="netFillRate">0.45</span>
                                                <span class="metric-unit-win11">m/hr</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert-win11 alert-win11-warning">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <span id="calculationResultText">Time to achieve <span class="badge-win11 badge-win11-gradient">3.0m</span> rise: <strong id="timeToFill">6.7</strong> hours</span>
                                </div>

                                <!-- Progress Bar -->
                                <div class="mt-2">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="text-muted">Stock Progress</span>
                                        <span class="text-muted" id="progressPercent">0%</span>
                                    </div>
                                    <div class="progress-win11">
                                        <div class="progress-bar-win11" id="Progress" style="width: 0%"></div>
                                    </div>
                                </div>

                                <div class="info-box-win11 mt-2">
                                    <h6>Operational Implications</h6>
                                    <p>With a net fill rate of 0.45 m/hr, the current configuration will achieve the target stock rise in 6.7 hours.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scenarios Section -->
            <div class="section-header">
                <h2 class="section-title">
                    <i class="bi bi-graph-up"></i> Scenarios & Analysis
                </h2>
            </div>

            <!-- Summary Dashboard -->
            <div class="win11-card">
                <div class="win11-card-header">
                    <h5 class="win11-card-title">
                        <i class="bi bi-speedometer2"></i> Scenario Performance Dashboard
                    </h5>
                </div>
                <div class="win11-card-body">
                    <div class="stats-grid-win11">
                        <div class="metric-card-win11">
                            <div class="metric-label-win11">Optimal Scenario</div>
                            <div class="metric-value-win11" style="font-size: 16px;" id="optimalScenarioName">Scenario 3</div>
                        </div>
                        <div class="metric-card-win11">
                            <div class="metric-label-win11">Best Time</div>
                            <div class="metric-value-win11">
                                <span class="animate-number" id="optimalTime">4.4</span>
                                <span class="metric-unit-win11">hrs</span>
                            </div>
                        </div>
                        <div class="metric-card-win11">
                            <div class="metric-label-win11">Fill Rate</div>
                            <div class="metric-value-win11">
                                <span class="animate-number" id="optimalRate">0.68</span>
                                <span class="metric-unit-win11">m/hr</span>
                            </div>
                        </div>
                        <div class="metric-card-win11">
                            <div class="metric-label-win11">Production Impact</div>
                            <div class="metric-value-win11" style="font-size: 16px;" id="optimalImpact">-25%</div>
                        </div>
                    </div>
                    <div class="info-box-win11 mt-2">
                        <h6>Performance Summary</h6>
                        <p>Scenario 3 achieves the fastest stock rise with a manageable 25% production reduction.</p>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="chart-container-win11">
                <div class="chart-header-win11">
                    <h3 class="chart-title-win11">Scenario Comparison Analysis</h3>
                    <div class="chart-options-win11">
                        <button class="chart-option-btn-win11 active" onclick="updateChartType('bar')">
                            <i class="bi bi-bar-chart"></i> Bar
                        </button>
                        <button class="chart-option-btn-win11" onclick="updateChartType('line')">
                            <i class="bi bi-graph-up"></i> Line
                        </button>
                        <button class="chart-option-btn-win11" onclick="updateChartType('radar')">
                            <i class="bi bi-pentagon"></i> Radar
                        </button>
                    </div>
                </div>
                <div style="height: 350px; position: relative;">
                    <canvas id="resultsChart"></canvas>
                </div>
                <div class="info-box-win11 mt-2">
                    <h6>Chart Analysis</h6>
                    <p>Visual comparison of all scenarios shows the time required to achieve target stock levels.</p>
                </div>
            </div>

            <!-- Scenario Cards -->
            <div class="row mt-3">
                <div class="col-md-4">
                    <div class="scenario-card-win11">
                        <div class="scenario-header-win11">
                            <input type="text" class="scenario-title-win11" id="scenario1Title" value="Scenario 1: Pressure Reduction">
                        </div>
                        <div class="scenario-body-win11">
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Description</div>
                                <div id="scenario1Description" style="font-size: 11px;">
                                    Reduce blast volume by 15%
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">
                                    Production Reduction
                                    <span class="badge-win11 badge-win11-warning ms-2" id="scenario1Badge">15%</span>
                                </div>
                                <input type="range" class="form-range-win11" id="scenario1Reduction" value="15" min="0" max="100" step="1">
                                <div class="d-flex justify-content-between mt-1">
                                    <small>0%</small>
                                    <small id="scenario1ReductionValue">15%</small>
                                    <small>100%</small>
                                </div>
                                <div class="parameter-description-win11">
                                    Adjust production reduction from 0% (no change) to 100% (complete shutdown).
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">New Production Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario1Production">177.1</span>
                                    <span class="metric-unit-win11">ton/hr</span>
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Net Fill Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario1NetFill">0.40</span>
                                    <span class="metric-unit-win11">m/hr</span>
                                </div>
                            </div>
                            <div class="alert-win11 alert-win11-info">
                                <i class="bi bi-clock-fill me-2"></i>
                                Time to fill: <strong id="scenario1Time">7.5</strong> hours
                            </div>
                            <div class="info-box-win11 mt-1">
                                <h6>Operational Impact</h6>
                                <p>Conservative approach minimizes production disruption while gradually building stock levels.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="scenario-card-win11">
                        <div class="scenario-header-win11">
                            <input type="text" class="scenario-title-win11" id="scenario2Title" value="Scenario 2: Oxygen Reduction">
                        </div>
                        <div class="scenario-body-win11">
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Description</div>
                                <div id="scenario2Description" style="font-size: 11px;">
                                    Reduce oxygen by 20%
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">
                                    Production Reduction
                                    <span class="badge-win11 badge-win11-warning ms-2" id="scenario2Badge">20%</span>
                                </div>
                                <input type="range" class="form-range-win11" id="scenario2Reduction" value="20" min="0" max="100" step="1">
                                <div class="d-flex justify-content-between mt-1">
                                    <small>0%</small>
                                    <small id="scenario2ReductionValue">20%</small>
                                    <small>100%</small>
                                </div>
                                <div class="parameter-description-win11">
                                    Adjust production reduction from 0% (no change) to 100% (complete shutdown).
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">New Production Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario2Production">166.6</span>
                                    <span class="metric-unit-win11">ton/hr</span>
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Net Fill Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario2NetFill">0.54</span>
                                    <span class="metric-unit-win11">m/hr</span>
                                </div>
                            </div>
                            <div class="alert-win11 alert-win11-info">
                                <i class="bi bi-clock-fill me-2"></i>
                                Time to fill: <strong id="scenario2Time">5.6</strong> hours
                            </div>
                            <div class="info-box-win11 mt-1">
                                <h6>Operational Impact</h6>
                                <p>Oxygen reduction provides efficient production control with good stock building performance.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="scenario-card-win11">
                        <div class="scenario-header-win11">
                            <input type="text" class="scenario-title-win11" id="scenario3Title" value="Scenario 3: Combined Approach">
                        </div>
                        <div class="scenario-body-win11">
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Description</div>
                                <div id="scenario3Description" style="font-size: 11px;">
                                    Combined 25% reduction
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">
                                    Production Reduction
                                    <span class="badge-win11 badge-win11-danger ms-2" id="scenario3Badge">25%</span>
                                </div>
                                <input type="range" class="form-range-win11" id="scenario3Reduction" value="25" min="0" max="100" step="1">
                                <div class="d-flex justify-content-between mt-1">
                                    <small>0%</small>
                                    <small id="scenario3ReductionValue">25%</small>
                                    <small>100%</small>
                                </div>
                                <div class="parameter-description-win11">
                                    Adjust production reduction from 0% (no change) to 100% (complete shutdown).
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">New Production Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario3Production">156.2</span>
                                    <span class="metric-unit-win11">ton/hr</span>
                                </div>
                            </div>
                            <div class="scenario-metric-win11">
                                <div class="scenario-metric-label-win11">Net Fill Rate</div>
                                <div class="scenario-metric-value-win11">
                                    <span class="animate-number" id="scenario3NetFill">0.68</span>
                                    <span class="metric-unit-win11">m/hr</span>
                                </div>
                            </div>
                            <div class="alert-win11 alert-win11-warning">
                                <i class="bi bi-trophy-fill me-2"></i>
                                Best option: <strong id="scenario3Time">4.4</strong> hours
                            </div>
                            <div class="info-box-win11 mt-1">
                                <h6>Operational Impact</h6>
                                <p>Aggressive approach achieves fastest stock recovery but requires significant production coordination.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-container">
            <div class="settings-header">
                <h2 class="settings-title">
                    <i class="fas fa-cog"></i>
                    Settings
                </h2>
                <div class="settings-close" id="settingsClose">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="settings-body">
                <!-- Application Settings Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-sliders-h"></i>
                        Application Settings
                    </h3>
                    <div class="settings-form-group">
                        <div class="settings-form-check">
                            <input type="checkbox" class="settings-form-check-input" id="autoSaveData" checked>
                            <label class="settings-form-check-label" for="autoSaveData">
                                Auto-save data every 5 minutes
                            </label>
                        </div>
                        <div class="settings-form-check">
                            <input type="checkbox" class="settings-form-check-input" id="enableAnimations" checked>
                            <label class="settings-form-check-label" for="enableAnimations">
                                Enable UI animations
                            </label>
                        </div>
                        <div class="settings-form-check">
                            <input type="checkbox" class="settings-form-check-input" id="showNotifications" checked>
                            <label class="settings-form-check-label" for="showNotifications">
                                Show notifications for alerts
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Data Management Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-database"></i>
                        Data Management
                    </h3>
                    <div class="settings-form-group">
                        <label class="settings-form-label" for="dataRetention">Data Retention Period</label>
                        <select class="settings-form-control" id="dataRetention">
                            <option value="7">7 days</option>
                            <option value="30" selected>30 days</option>
                            <option value="90">90 days</option>
                            <option value="365">1 year</option>
                            <option value="0">Never delete</option>
                        </select>
                    </div>
                    <div class="settings-button-group">
                        <button class="settings-button settings-button-primary" onclick="exportAllData()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="settings-button settings-button-secondary" onclick="clearAllData()">
                            <i class="fas fa-trash-alt"></i> Clear
                        </button>
                    </div>
                </div>

                <!-- About Section -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-info-circle"></i>
                        About
                    </h3>
                    <div class="settings-form-group">
                        <p style="margin-bottom: var(--spacing-md);">
                            <strong>Blast Furnace Analysis System</strong><br>
                            Version 1.0.0<br>
                            Â© 2023 Rourkela Steel Plant
                        </p>
                        <div class="settings-button-group">
                            <button class="settings-button settings-button-secondary" onclick="showHelp()">
                                <i class="fas fa-question-circle"></i> Help & Documentation
                            </button>
                        </div>
                    </div>
                </div>

                <div class="settings-button-group">
                    <button class="settings-button settings-button-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                    <button class="settings-button settings-button-secondary" onclick="closeSettings()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentView = 'comprehensive';
        let hotMetalChart, materialConsumptionChart, fuelRateChart, efficiencyChart;
        let resultsChart = null;
        let currentChartType = 'bar';
        let calculationData = {};
        let calculationMode = ''; // '' or 'time'

        // Default data
        const initialDefaultData = {
            materials: {
                "COKE": {
                    "C": "86",
                    "Moisture": "4.5",
                    "FE": "0.0",
                    "SiO2": "5.5",
                    "CAO": "0.0",
                    "MGO": "0.0",
                    "AL203": "3.3",
                    "Density": "550"
                },
                "SINTER": {
                    "C": "0",
                    "Moisture": "0.6",
                    "FE": "53.9",
                    "SiO2": "6.9",
                    "CAO": "10.5",
                    "MGO": "2.3",
                    "AL203": "3.7",
                    "Density": "1800"
                },
                "ORE": {
                    "C": "0",
                    "Moisture": "4.5",
                    "FE": "62.5",
                    "SiO2": "2.5",
                    "CAO": "0.0",
                    "MGO": "0.0",
                    "AL203": "3.6",
                    "Density": "2200"
                },
                "PELLETS": {
                    "C": "0",
                    "Moisture": "2.8",
                    "FE": "63.5",
                    "SiO2": "4.0",
                    "CAO": "0.5",
                    "MGO": "0.3",
                    "AL203": "1.4",
                    "Density": "2000"
                },
                "SCRAP": {
                    "C": "0",
                    "Moisture": "0.5",
                    "FE": "65.0",
                    "SiO2": "0.0",
                    "CAO": "0.0",
                    "MGO": "0.0",
                    "AL203": "0.0",
                    "Density": "1200"
                },
                "PCI": {
                    "C": "88",
                    "Moisture": "0.0",
                    "FE": "0.0",
                    "SiO2": "4.4",
                    "CAO": "0.0",
                    "MGO": "0.0",
                    "AL203": "2.6",
                    "Density": "550"
                },
                "NCOKE": {
                    "C": "89",
                    "Moisture": "5.7",
                    "FE": "0.0",
                    "SiO2": "0.0",
                    "CAO": "0.0",
                    "MGO": "0.0",
                    "AL203": "0.0",
                    "Density": "550"
                }
            },
            inputs: {
                "COKE": {
                    "Weight": "8100"
                },
                "SINTER": {
                    "Weight": "21100"
                },
                "ORE": {
                    "Weight": "3200"
                },
                "PELLETS": {
                    "Weight": "3500"
                },
                "SCRAP": {
                    "Weight": "600"
                },
                "PCI": {
                    "Weight": "0"
                },
                "NCOKE": {
                    "Weight": "0"
                }
            },
            blastParams: {
                "Blast Volume": "150000",
                "O2 Enrichment": "10500",
                "Blast Temperature": "1150",
                "Top Pressure": "1.87",
                "Blast Pressure": "3.15",
                "DP": "1.28",
                "Humidity": "10.5",
                "Tuyere Velocity": "220",
                "Raceway Flame Temp": "2150",
                "Hot Metal": "1000",
                "Basicity": "1.15",
                "Alâ‚‚Oâ‚ƒ": "4",
                "Nos Of Tuyeres": "20",
                "Gas Generation": "264000",
                "Hearth Area": "55.4",
                "Furnace Resistance": "350",
                "Furnace Permeability": "370",
                "O2 %": "25.0",
                "Silicon%": "1.0",
                "HMT": "1500"
            },
            hearthData: {
                "production": "6600",
                "slagRate": "250",
                "hmDensity": "7.2",
                "slagDensity": "2.4",
                "hearthVoidage": "20",
                "hearthDiameter": "10.8",
                "tuyereHeight": "3.9"
            },
            siliconData: {
                "slagSiO2": "32.5",
                "slagCaO": "38.5",
                "slagMgO": "8.5",
                "slagAl2O3": "18.5",
                "slagTemp": "1500",
                "hmTemp": "1500",
                "slagVolume": "250",
                "kFactor": "0.35"
            }
        };

        let defaultData = JSON.parse(JSON.stringify(initialDefaultData));

        const appData = {
            materials: JSON.parse(JSON.stringify(initialDefaultData.materials)),
            inputs: JSON.parse(JSON.stringify(initialDefaultData.inputs)),
            blastParams: JSON.parse(JSON.stringify(initialDefaultData.blastParams)),
            shiftMaterialProperties: {
                "coke": {
                    "moisture": 0,
                    "fe": 0
                },
                "sinter": {
                    "moisture": 0,
                    "fe": 0
                },
                "ironOre": {
                    "moisture": 0,
                    "fe": 0
                },
                "pellets": {
                    "moisture": 0,
                    "fe": 0
                },
                "scraps": {
                    "moisture": 0,
                    "fe": 0
                },
                "nutCoke": {
                    "moisture": 0,
                    "fe": 0
                },
                "pci": {
                    "moisture": 0,
                    "fe": 0
                }
            },
            shiftData: {},
            hearthData: JSON.parse(JSON.stringify(initialDefaultData.hearthData)),
            siliconData: JSON.parse(JSON.stringify(initialDefaultData.siliconData))
        };

        // Settings management
        const appSettings = {
            theme: 'light',
            autoSaveData: true,
            enableAnimations: true,
            showNotifications: true,
            dataRetention: 30
        };

        // NEW FUNCTION: Load saved data from localStorage
        function loadSavedData() {
            const savedData = localStorage.getItem('blastFurnaceSavedData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                
                // Load comprehensive materials data
                if (parsedData.materials) {
                    Object.keys(parsedData.materials).forEach(material => {
                        if (appData.materials[material]) {
                            Object.keys(parsedData.materials[material]).forEach(property => {
                                appData.materials[material][property] = parsedData.materials[material][property];
                            });
                        }
                    });
                }
                
                // Load comprehensive inputs data
                if (parsedData.inputs) {
                    Object.keys(parsedData.inputs).forEach(material => {
                        if (appData.inputs[material]) {
                            appData.inputs[material].Weight = parsedData.inputs[material].Weight;
                        }
                    });
                }
                
                // Load blast parameters
                if (parsedData.blastParams) {
                    Object.keys(parsedData.blastParams).forEach(param => {
                        appData.blastParams[param] = parsedData.blastParams[param];
                    });
                }
                
                // Load hearth data
                if (parsedData.hearthData) {
                    Object.keys(parsedData.hearthData).forEach(param => {
                        appData.hearthData[param] = parsedData.hearthData[param];
                    });
                }
                
                // Load silicon data
                if (parsedData.siliconData) {
                    Object.keys(parsedData.siliconData).forEach(param => {
                        appData.siliconData[param] = parsedData.siliconData[param];
                    });
                }
                
                // Load shift data
                if (parsedData.shiftData) {
                    appData.shiftData = parsedData.shiftData;
                }
                
                // Load stock level calculator data
                if (parsedData.stockLevelData) {
                    Object.keys(parsedData.stockLevelData).forEach(param => {
                        const element = document.getElementById(param);
                        if (element) {
                            element.value = parsedData.stockLevelData[param];
                        }
                    });
                }
            }
        }

        // NEW FUNCTION: Save all current data to localStorage
        function saveAllData() {
            const dataToSave = {
                materials: JSON.parse(JSON.stringify(appData.materials)),
                inputs: JSON.parse(JSON.stringify(appData.inputs)),
                blastParams: JSON.parse(JSON.stringify(appData.blastParams)),
                hearthData: JSON.parse(JSON.stringify(appData.hearthData)),
                siliconData: JSON.parse(JSON.stringify(appData.siliconData)),
                shiftData: JSON.parse(JSON.stringify(appData.shiftData)),
                stockLevelData: {}
            };
            
            // Save stock level calculator inputs
            const stockLevelInputs = document.querySelectorAll('.stock-level-calculator input[type="number"], .stock-level-calculator input[type="range"]');
            stockLevelInputs.forEach(input => {
                dataToSave.stockLevelData[input.id] = input.value;
            });
            
            localStorage.setItem('blastFurnaceSavedData', JSON.stringify(dataToSave));
            
            if (appSettings.showNotifications) {
                showNotification('All data saved successfully!', 'success');
            }
        }

        // NEW FUNCTION: Initialize auto-save functionality
        function initializeAutoSave() {
            // Save on input changes
            document.addEventListener('input', function(e) {
                if (appSettings.autoSaveData && e.target.type !== 'password' && e.target.type !== 'email') {
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(saveAllData, 1000); // Save after 1 second of inactivity
                }
            });
            
            // Save on form submissions
            document.addEventListener('submit', function(e) {
                if (appSettings.autoSaveData) {
                    saveAllData();
                }
            });
        }

        // Load settings from localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('blastFurnaceSettings');
            if (savedSettings) {
                Object.assign(appSettings, JSON.parse(savedSettings));
            }

            // Apply theme
            setTheme(appSettings.theme);

            // Apply other settings
            document.getElementById('autoSaveData').checked = appSettings.autoSaveData;
            document.getElementById('enableAnimations').checked = appSettings.enableAnimations;
            document.getElementById('showNotifications').checked = appSettings.showNotifications;
            document.getElementById('dataRetention').value = appSettings.dataRetention;

            // Update theme options in settings modal
            document.querySelectorAll('.theme-option-card').forEach(card => {
                card.classList.remove('active');
                if (card.getAttribute('data-theme') === appSettings.theme) {
                    card.classList.add('active');
                }
            });
        }

        // Save settings to localStorage
        function saveSettings() {
            // Get current theme
            const activeThemeCard = document.querySelector('.theme-option-card.active');
            if (activeThemeCard) {
                appSettings.theme = activeThemeCard.getAttribute('data-theme');
            }

            // Get other settings
            appSettings.autoSaveData = document.getElementById('autoSaveData').checked;
            appSettings.enableAnimations = document.getElementById('enableAnimations').checked;
            appSettings.showNotifications = document.getElementById('showNotifications').checked;
            appSettings.dataRetention = document.getElementById('dataRetention').value;

            // Save to localStorage
            localStorage.setItem('blastFurnaceSettings', JSON.stringify(appSettings));

            // Apply theme
            setTheme(appSettings.theme);

            // Show confirmation
            if (appSettings.showNotifications) {
                showNotification('Settings saved successfully!', 'success');
            }

            // Close settings modal
            closeSettings();
        }

        // Theme management
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            appSettings.theme = theme;
            localStorage.setItem('blastFurnaceTheme', theme);
        }

        // Show notification
        function showNotification(message, type = 'info') {
            if (!appSettings.showNotifications) return;

            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10001';
            notification.style.minWidth = '300px';
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }

        // Settings modal functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
            loadSettings();
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        // Export all data
        function exportAllData() {
            const data = {
                appData: appData,
                defaultData: defaultData,
                settings: appSettings,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {
                type: 'application/json'
            });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `blast_furnace_complete_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('All data exported successfully!', 'success');
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                localStorage.removeItem('blastFurnaceDefaultData');
                localStorage.removeItem('blastFurnaceShiftData');
                localStorage.removeItem('blastFurnaceSavedData'); // Clear saved data too

                // Reset to initial defaults
                defaultData = JSON.parse(JSON.stringify(initialDefaultData));
                appData.materials = JSON.parse(JSON.stringify(initialDefaultData.materials));
                appData.inputs = JSON.parse(JSON.stringify(initialDefaultData.inputs));
                appData.blastParams = JSON.parse(JSON.stringify(initialDefaultData.blastParams));
                appData.hearthData = JSON.parse(JSON.stringify(initialDefaultData.hearthData));
                appData.siliconData = JSON.parse(JSON.stringify(initialDefaultData.siliconData));
                appData.shiftData = {};

                // Reinitialize views
                initializeComprehensiveMaterials();
                initializeComprehensiveInputs();
                initializeSiliconCalculation();
                calculateAllComprehensive();
                createEmptyShiftData();
                populateShiftTable('all');
                updateCharts();

                showNotification('All data cleared successfully!', 'success');
                closeSettings();
            }
        }

        // Show help
        function showHelp() {
            alert('Help documentation would open here. This would typically link to a user guide or documentation page.');
        }

        // Authentication functions
        function checkAuth() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');

                // Update user info in header
                updateUserHeader(currentUser);

                loadDefaultData();
                loadSavedData(); // Load saved user data
                initializeComprehensiveView();
                initializeShiftProductionView();
                initializeCharts();
                initializeSiliconCalculation();
                initializeStockLevelCalculator();
                initializeUserDropdown();
                initializeSettings();
                initializeAutoSave(); // Initialize auto-save
            } else {
                document.getElementById('authContainer').classList.remove('hidden');
                document.getElementById('appContainer').classList.add('hidden');
            }
        }

        function updateUserHeader(user) {
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');

            if (userAvatar) {
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                userAvatar.textContent = initials;
            }

            if (userName) userName.textContent = user.name;
            if (userRole) userRole.textContent = user.role || 'Operator';
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                saveAllData(); // Save data before logging out
                localStorage.removeItem('currentUser');
                document.getElementById('authContainer').classList.remove('hidden');
                document.getElementById('appContainer').classList.add('hidden');
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                document.getElementById('forgotPasswordForm').reset();
                hideAlerts();
                showAuthCard('loginCard');
            }
        }

        function showAlert(alertId, message, type) {
            const alertElement = document.getElementById(alertId);
            alertElement.textContent = message;
            alertElement.className = `alert alert-${type}`;
            alertElement.style.display = 'flex';
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 3000);
        }

        function hideAlerts() {
            document.getElementById('loginAlert').style.display = 'none';
            document.getElementById('registerAlert').style.display = 'none';
            document.getElementById('forgotPasswordAlert').style.display = 'none';
        }

        function showAuthCard(cardId) {
            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('registerCard').classList.add('hidden');
            document.getElementById('forgotPasswordCard').classList.add('hidden');
            document.getElementById(cardId).classList.remove('hidden');
            hideAlerts();
        }

        // Auth event listeners
        document.getElementById('showRegister').addEventListener('click', (e) => {
            e.preventDefault();
            showAuthCard('registerCard');
        });

        document.getElementById('showLoginFromRegister').addEventListener('click', (e) => {
            e.preventDefault();
            showAuthCard('loginCard');
        });

        document.getElementById('showForgotPassword').addEventListener('click', (e) => {
            e.preventDefault();
            showAuthCard('forgotPasswordCard');
        });

        document.getElementById('showLoginFromForgot').addEventListener('click', (e) => {
            e.preventDefault();
            showAuthCard('loginCard');
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || [];
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                const currentUser = {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role || 'Operator'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                loadDefaultData();
                showAlert('loginAlert', 'Login successful! Redirecting...', 'success');
                setTimeout(() => checkAuth(), 1000);
            } else {
                showAlert('loginAlert', 'Invalid email or password', 'danger');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                showAlert('registerAlert', 'Passwords do not match', 'danger');
                return;
            }

            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || [];

            if (users.find(u => u.email === email)) {
                showAlert('registerAlert', 'User with this email already exists', 'danger');
                return;
            }

            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                role: 'Operator',
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('blastFurnaceUsers', JSON.stringify(users));
            showAlert('registerAlert', 'Registration successful! Please login.', 'success');
            document.getElementById('registerForm').reset();
            setTimeout(() => showAuthCard('loginCard'), 2000);
        });

        document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (newPassword !== confirmNewPassword) {
                showAlert('forgotPasswordAlert', 'Passwords do not match', 'danger');
                return;
            }

            const users = JSON.parse(localStorage.getItem('blastFurnaceUsers')) || [];
            const userIndex = users.findIndex(u => u.email === email);

            if (userIndex === -1) {
                showAlert('forgotPasswordAlert', 'No account found with this email address', 'danger');
                return;
            }

            users[userIndex].password = newPassword;
            localStorage.setItem('blastFurnaceUsers', JSON.stringify(users));
            showAlert('forgotPasswordAlert', 'Password reset successful! Please login with your new password.', 'success');
            document.getElementById('forgotPasswordForm').reset();
            setTimeout(() => showAuthCard('loginCard'), 2000);
        });

        // Initialize user dropdown
        function initializeUserDropdown() {
            const userMenu = document.getElementById('userMenu');
            const dropdownMenu = document.getElementById('userDropdown');
            const logoutLink = document.getElementById('logoutLink');
            const profileLink = document.getElementById('profileLink');
            const settingsLink = document.getElementById('settingsLink');

            // Toggle dropdown
            userMenu.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                dropdownMenu.classList.remove('show');
            });

            // Prevent dropdown from closing when clicking inside
            dropdownMenu.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Handle logout link
            logoutLink.addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });

            // Handle profile link
            profileLink.addEventListener('click', function(e) {
                e.preventDefault();
                alert('Profile page would open here');
                dropdownMenu.classList.remove('show');
            });

            // Handle settings link
            settingsLink.addEventListener('click', function(e) {
                e.preventDefault();
                openSettings();
                dropdownMenu.classList.remove('show');
            });
        }

        // Initialize settings
        function initializeSettings() {
            const settingsButton = document.getElementById('settingsButton');
            const settingsClose = document.getElementById('settingsClose');
            const settingsModal = document.getElementById('settingsModal');

            // Open settings modal
            settingsButton.addEventListener('click', openSettings);

            // Close settings modal
            settingsClose.addEventListener('click', closeSettings);

            // Close when clicking outside modal
            settingsModal.addEventListener('click', function(e) {
                if (e.target === settingsModal) {
                    closeSettings();
                }
            });

            // Load settings
            loadSettings();
        }

        // Initialize view switcher
        function initViewSwitcher() {
            const viewButtons = document.querySelectorAll('.view-btn');

            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    viewButtons.forEach(btn => btn.classList.remove('active'));

                    // Add active class to clicked button
                    this.classList.add('active');

                    // Get the view to show
                    const viewToShow = this.getAttribute('data-view');

                    // Hide all views
                    document.querySelectorAll('.comprehensive-card').forEach(card => {
                        card.style.display = 'none';
                    });

                    // Show the selected view
                    if (viewToShow === 'comprehensive') {
                        document.getElementById('comprehensive-view').style.display = 'block';
                    } else if (viewToShow === 'shift') {
                        document.getElementById('shift-view').style.display = 'block';
                    } else if (viewToShow === 'stock') {
                        document.getElementById('stock-view').style.display = 'block';
                    }

                    // Update current view
                    currentView = viewToShow;

                    // Trigger resize to update charts if needed
                    window.dispatchEvent(new Event('resize'));
                });
            });
        }

        // Initialize comprehensive view
        function initializeComprehensiveView() {
            initializeComprehensiveMaterials();
            initializeComprehensiveInputs();
            calculateAllComprehensive();
        }

        // Initialize comprehensive materials table
        function initializeComprehensiveMaterials() {
            const tbody = document.getElementById('comp-materials-tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            const materialsList = Object.keys(appData.materials);
            const properties = ["C", "Moisture", "FE", "SiO2", "CAO", "MGO", "AL203", "Density"];

            materialsList.forEach(material => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = material;
                nameCell.style.fontWeight = '600';
                row.appendChild(nameCell);

                properties.forEach(prop => {
                    const cell = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = appData.materials[material][prop];
                    input.addEventListener('input', function() {
                        updateComprehensiveMaterialProperty(material, prop, this.value);
                    });
                    cell.appendChild(input);
                    row.appendChild(cell);
                });

                tbody.appendChild(row);
            });
        }

        // Update comprehensive material property
        function updateComprehensiveMaterialProperty(material, property, value) {
            appData.materials[material][property] = value;
            calculateAllComprehensive();
        }

        // Initialize comprehensive inputs table
        function initializeComprehensiveInputs() {
            const tbody = document.getElementById('comp-inputs-tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            const inputsList = Object.keys(appData.inputs);

            inputsList.forEach(material => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = material;
                nameCell.style.fontWeight = '600';
                row.appendChild(nameCell);

                const weightCell = document.createElement('td');
                const weightInput = document.createElement('input');
                weightInput.type = 'text';
                weightInput.value = appData.inputs[material].Weight;
                weightInput.addEventListener('input', function() {
                    updateComprehensiveInputWeight(material, this.value);
                });
                weightCell.appendChild(weightInput);
                row.appendChild(weightCell);

                for (let i = 0; i < 8; i++) {
                    const cell = document.createElement('td');
                    cell.className = 'calculated';
                    cell.id = `comp-input-${material}-${i}`;
                    row.appendChild(cell);
                }

                tbody.appendChild(row);
            });
        }

        // Update comprehensive input weight
        function updateComprehensiveInputWeight(material, value) {
            appData.inputs[material].Weight = value;
            calculateAllComprehensive();
        }

        // Calculate all comprehensive data
        function calculateAllComprehensive() {
            calculateComprehensiveInputs();
            calculateComprehensiveResults();
            calculateComprehensiveBlastParameters();
            calculateComprehensiveHearth();
        }

        // Calculate comprehensive inputs
        function calculateComprehensiveInputs() {
            Object.keys(appData.inputs).forEach(material => {
                const weight = safeParseFloat(appData.inputs[material].Weight);
                const moisture = safeParseFloat(appData.materials[material].Moisture);
                const moistureAdj = 1 - (moisture / 100);
                const dryWeight = weight * moistureAdj;

                const rows = document.querySelectorAll('#comp-inputs-tbody tr');
                const rowIndex = Object.keys(appData.inputs).indexOf(material);
                if (rowIndex >= 0 && rowIndex < rows.length) {
                    const row = rows[rowIndex];
                    if (row) {
                        row.cells[2].textContent = moistureAdj.toFixed(2);
                        row.cells[3].textContent = dryWeight.toFixed(1);

                        const fe = safeParseFloat(appData.materials[material].FE);
                        const c = safeParseFloat(appData.materials[material].C);
                        const sio2 = safeParseFloat(appData.materials[material].SiO2);
                        const cao = safeParseFloat(appData.materials[material].CAO);
                        const mgo = safeParseFloat(appData.materials[material].MGO);
                        const al2o3 = safeParseFloat(appData.materials[material].AL203);

                        row.cells[4].textContent = (dryWeight * fe / 100).toFixed(1);
                        row.cells[5].textContent = (dryWeight * c / 100).toFixed(1);
                        row.cells[6].textContent = (dryWeight * sio2 / 100).toFixed(1);
                        row.cells[7].textContent = (dryWeight * cao / 100).toFixed(1);
                        row.cells[8].textContent = (dryWeight * mgo / 100).toFixed(1);
                        row.cells[9].textContent = (dryWeight * al2o3 / 100).toFixed(1);
                    }
                }
            });
        }

        // Calculate comprehensive results
        function calculateComprehensiveResults() {
            const totals = {
                weight: 0,
                dryWeight: 0,
                fe: 0,
                c: 0,
                sio2: 0,
                cao: 0,
                mgo: 0,
                al2o3: 0,
                cokeDryWeight: 0,
                pciDryWeight: 0,
                ncokeDryWeight: 0
            };

            Object.keys(appData.inputs).forEach(material => {
                const weight = safeParseFloat(appData.inputs[material].Weight);
                const moisture = safeParseFloat(appData.materials[material].Moisture);
                const moistureAdj = 1 - (moisture / 100);
                const dryWeight = weight * moistureAdj;

                totals.weight += weight;
                totals.dryWeight += dryWeight;

                const fe = safeParseFloat(appData.materials[material].FE);
                const c = safeParseFloat(appData.materials[material].C);
                const sio2 = safeParseFloat(appData.materials[material].SiO2);
                const cao = safeParseFloat(appData.materials[material].CAO);
                const mgo = safeParseFloat(appData.materials[material].MGO);
                const al2o3 = safeParseFloat(appData.materials[material].AL203);

                totals.fe += dryWeight * fe / 100;
                totals.c += dryWeight * c / 100;
                totals.sio2 += dryWeight * sio2 / 100;
                totals.cao += dryWeight * cao / 100;
                totals.mgo += dryWeight * mgo / 100;
                totals.al2o3 += dryWeight * al2o3 / 100;

                if (material === "COKE") totals.cokeDryWeight = dryWeight;
                else if (material === "PCI") totals.pciDryWeight = dryWeight;
                else if (material === "NCOKE") totals.ncokeDryWeight = dryWeight;
            });

            const volumes = {
                coke: totals.cokeDryWeight / safeParseFloat(appData.materials["COKE"].Density),
                ncoke: totals.ncokeDryWeight / safeParseFloat(appData.materials["NCOKE"].Density),
                sinter: safeParseFloat(appData.inputs["SINTER"].Weight) / safeParseFloat(appData.materials["SINTER"].Density),
                ore: safeParseFloat(appData.inputs["ORE"].Weight) / safeParseFloat(appData.materials["ORE"].Density),
                pellets: safeParseFloat(appData.inputs["PELLETS"].Weight) / safeParseFloat(appData.materials["PELLETS"].Density),
                scrap: safeParseFloat(appData.inputs["SCRAP"].Weight) / safeParseFloat(appData.materials["SCRAP"].Density)
            };

            const ironBearingMaterials = ["SINTER", "ORE", "PELLETS", "SCRAP"];
            const totalIronBearingWeight = ironBearingMaterials.reduce((sum, mat) => sum + safeParseFloat(appData.inputs[mat].Weight), 0);
            const totalIronBearingVol = ["sinter", "ore", "pellets", "scrap"].reduce((sum, mat) => sum + volumes[mat], 0);
            const totalVol = volumes.coke + volumes.ncoke + totalIronBearingVol;
            const ocRatio = totalIronBearingWeight / Math.max(safeParseFloat(appData.inputs["COKE"].Weight), 1);

            const hmProduction = totals.fe / 0.945;
            const cokeRate = (totals.cokeDryWeight * 1000) / Math.max(hmProduction, 1);
            const ncokeRate = (totals.ncokeDryWeight * 1000) / Math.max(hmProduction, 1);
            const pciRate = (totals.pciDryWeight * 1000) / Math.max(hmProduction, 1);
            const fuelRate = cokeRate + ncokeRate + pciRate;
            const cInHm = hmProduction * 0.045;
            const cInGas = totals.c - cInHm;
            const cEfficiency = (cInHm / Math.max(totals.c, 1)) * 100;
            const slagWeight = totals.sio2 + totals.cao + totals.mgo + totals.al2o3;

            const feCRatio = totals.fe / Math.max(totals.c, 1);
            const slagBasicity = (totals.cao + totals.mgo) / Math.max(totals.sio2, 1);
            const aluminaRatio = totals.al2o3 / Math.max((totals.cao + totals.mgo), 1);
            const caoSio2 = totals.cao / Math.max(totals.sio2, 1);
            const mgoSio2 = totals.mgo / Math.max(totals.sio2, 1);

            const sinterPct = (safeParseFloat(appData.inputs["SINTER"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100;
            const orePct = (safeParseFloat(appData.inputs["ORE"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100;
            const pelletsPct = (safeParseFloat(appData.inputs["PELLETS"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100;
            const scrapPct = (safeParseFloat(appData.inputs["SCRAP"].Weight) / Math.max(totalIronBearingWeight, 1)) * 100;
            const cokePct = (safeParseFloat(appData.inputs["COKE"].Weight) / Math.max(totals.weight, 1)) * 100;

            const productivity = hmProduction / 1493;
            const specificConsumption = totals.weight / Math.max(hmProduction / 1000, 1);
            const yieldPct = (hmProduction / Math.max(totals.fe, 1)) * 100;

            // Update all comprehensive results
            updateComprehensiveResult("Hot-Metal", hmProduction.toFixed(1));
            updateComprehensiveResult("Coke-Rate", cokeRate.toFixed(1));
            updateComprehensiveResult("Fuel-Rate", fuelRate.toFixed(2));
            updateComprehensiveResult("Productivity", productivity.toFixed(2));

            updateComprehensiveResult("Hot-Metal-2", hmProduction.toFixed(1));
            updateComprehensiveResult("Coke-Rate-2", cokeRate.toFixed(1));
            updateComprehensiveResult("Ncoke-Rate", ncokeRate.toFixed(1));
            updateComprehensiveResult("PCI-Rate", pciRate.toFixed(1));
            updateComprehensiveResult("Slag-Rate", (slagWeight * 1000 / Math.max(hmProduction, 1)).toFixed(1));
            updateComprehensiveResult("Fuel-Rate-2", fuelRate.toFixed(2));
            updateComprehensiveResult("C-Efficiency", cEfficiency.toFixed(1));
            updateComprehensiveResult("Yield", yieldPct.toFixed(1));

            updateComprehensiveResult("Coke-Volume", volumes.coke.toFixed(2));
            updateComprehensiveResult("Ncoke-Volume", volumes.ncoke.toFixed(2));
            updateComprehensiveResult("Sinter-Volume", volumes.sinter.toFixed(2));
            updateComprehensiveResult("Ore-Volume", volumes.ore.toFixed(2));
            updateComprehensiveResult("Pellets-Volume", volumes.pellets.toFixed(2));
            updateComprehensiveResult("Scrap-Volume", volumes.scrap.toFixed(2));
            updateComprehensiveResult("Total-Volume", totalVol.toFixed(2));
            updateComprehensiveResult("Fe-C-Ratio", feCRatio.toFixed(2));

            updateComprehensiveResult("Total-Weight", totals.weight.toFixed(1));
            updateComprehensiveResult("Total-Fe-Input", totals.fe.toFixed(1));
            updateComprehensiveResult("Total-C-Input", totals.c.toFixed(1));
            updateComprehensiveResult("Slag-Weight", slagWeight.toFixed(1));
            updateComprehensiveResult("Slag-Basicity", slagBasicity.toFixed(2));
            updateComprehensiveResult("Alumina-Ratio", aluminaRatio.toFixed(2));
            updateComprehensiveResult("CaO-SiO2", caoSio2.toFixed(2));
            updateComprehensiveResult("MgO-SiO2", mgoSio2.toFixed(2));

            updateComprehensiveResult("Sinter-Percent", sinterPct.toFixed(1));
            updateComprehensiveResult("Ore-Percent", orePct.toFixed(1));
            updateComprehensiveResult("Pellets-Percent", pelletsPct.toFixed(1));
            updateComprehensiveResult("Scrap-Percent", scrapPct.toFixed(1));
            updateComprehensiveResult("Coke-Percent", cokePct.toFixed(1));
            updateComprehensiveResult("Ore-Coke-Ratio", ocRatio.toFixed(2));
            updateComprehensiveResult("Specific-Consumption", specificConsumption.toFixed(1));
            updateComprehensiveResult("Total-Iron-Bearing-Wt", totalIronBearingWeight.toFixed(1));
        }

        // Calculate comprehensive blast parameters including furnace resistance and permeability
        function calculateComprehensiveBlastParameters() {
            const blastVolume = safeParseFloat(document.getElementById('comp-blastVolume')?.value || appData.blastParams["Blast Volume"]);
            const o2Enrich = safeParseFloat(document.getElementById('comp-o2Enrichment')?.value || appData.blastParams["O2 Enrichment"]);
            const blastTemp = safeParseFloat(document.getElementById('comp-blastTemp')?.value || appData.blastParams["Blast Temperature"]);
            const topPressure = safeParseFloat(document.getElementById('comp-topPressure')?.value || appData.blastParams["Top Pressure"]);
            const blastPressure = safeParseFloat(document.getElementById('comp-blastPressure')?.value || appData.blastParams["Blast Pressure"]);
            const gasGeneration = safeParseFloat(document.getElementById('comp-Gas-Generation')?.value || appData.blastParams["Gas Generation"]);
            const hearthArea = safeParseFloat(appData.blastParams["Hearth Area"]);
            const nosTuyeres = safeParseFloat(appData.blastParams["Nos Of Tuyeres"]);

            const dp = blastPressure - topPressure;
            const flameTemp = blastTemp + (o2Enrich * 10) - (10.5 * 2);
            const tuyereArea = 0.1;
            const velocity = (blastVolume / 60) / tuyereArea;

            const normalAirO2 = blastVolume * 0.21;
            const totalO2 = normalAirO2 + o2Enrich;
            const o2Percentage = (totalO2 / (blastVolume + o2Enrich)) * 100;

            // Calculate Furnace Resistance and Permeability
            const topgasVolPerMin = gasGeneration / 60;
            const shaftgasVol = topgasVolPerMin / hearthArea;

            const pdsTuyere = (Math.pow(10, -8)) * 6.5 * (blastTemp + 273.16) / (blastPressure + 1.003) * Math.pow((blastVolume / 60 / nosTuyeres), 2);

            const term1 = Math.pow(blastPressure - pdsTuyere + 1.003, 2);
            const term2 = Math.pow(topPressure + 1.003, 2);
            const term3 = Math.pow(term1 - term2, 0.588235294);
            const fceResistance = (term3 * 10000) / shaftgasVol;

            const term4 = Math.pow(blastPressure - pdsTuyere + 1.003, 2);
            const term5 = Math.pow(topPressure + 1.003, 2);
            const permeability = Math.pow(shaftgasVol, 1.7) / (term4 - term5);

            // Update derived parameters
            updateComprehensiveResult("dp", dp.toFixed(2));
            updateComprehensiveResult("tuyereVelocity", velocity.toFixed(1));
            updateComprehensiveResult("flameTemp", flameTemp.toFixed(1));
            updateComprehensiveResult("o2Percentage", o2Percentage.toFixed(1));
            updateComprehensiveResult("Furnace-Resistance", fceResistance.toFixed(2));
            updateComprehensiveResult("Furnace-Permeability", permeability.toFixed(2));

            // Update app data
            appData.blastParams["Blast Volume"] = blastVolume;
            appData.blastParams["O2 Enrichment"] = o2Enrich;
            appData.blastParams["Blast Temperature"] = blastTemp;
            appData.blastParams["Top Pressure"] = topPressure;
            appData.blastParams["Blast Pressure"] = blastPressure;
            appData.blastParams["DP"] = dp;
            appData.blastParams["Tuyere Velocity"] = velocity;
            appData.blastParams["Raceway Flame Temp"] = flameTemp;
            appData.blastParams["O2 %"] = o2Percentage;
            appData.blastParams["Furnace Resistance"] = fceResistance;
            appData.blastParams["Furnace Permeability"] = permeability;
        }

        // Calculate comprehensive hearth
        function calculateComprehensiveHearth() {
            const production = parseFloat(document.getElementById('comp-production').value) || 0;
            const slagRate = parseFloat(document.getElementById('comp-slagRate').value) || 0;
            const hmDensity = parseFloat(document.getElementById('comp-hmDensity').value) || 0;
            const slagDensity = parseFloat(document.getElementById('comp-slagDensity').value) || 0;
            const hearthVoidage = (parseFloat(document.getElementById('comp-hearthVoidage').value) || 0) / 100;
            const hearthDiameter = parseFloat(document.getElementById('comp-hearthDiameter').value) || 0;
            const tuyereHeight = parseFloat(document.getElementById('comp-tuyereHeight').value) || 0;

            appData.hearthData.production = production;
            appData.hearthData.slagRate = slagRate;
            appData.hearthData.hmDensity = hmDensity;
            appData.hearthData.slagDensity = slagDensity;
            appData.hearthData.hearthVoidage = hearthVoidage * 100;
            appData.hearthData.hearthDiameter = hearthDiameter;
            appData.hearthData.tuyereHeight = tuyereHeight;

            const productionRate = production / (24 * 60);
            updateComprehensiveResult("productionRate", productionRate.toFixed(4));

            const ironVolume = productionRate / hmDensity;
            updateComprehensiveResult("ironVolume", ironVolume.toFixed(4) + " mÂ³/min");

            const slagVolume = ((slagRate / 1000) * productionRate) / slagDensity;
            updateComprehensiveResult("slagVolume", slagVolume.toFixed(4) + " mÂ³/min");

            const totalLiquidVolume = ironVolume + slagVolume;
            updateComprehensiveResult("totalLiquidVolume", totalLiquidVolume.toFixed(4) + " mÂ³/min");

            const hearthArea = Math.PI * Math.pow(hearthDiameter / 2, 2);
            updateComprehensiveResult("hearthArea", hearthArea.toFixed(2) + " mÂ²");

            const storageCapacity = hearthVoidage * hearthArea * tuyereHeight;
            updateComprehensiveResult("storageCapacity", storageCapacity.toFixed(2) + " mÂ³");

            const timeToTuyeres = storageCapacity / totalLiquidVolume;
            updateComprehensiveResult("timeToTuyeres", timeToTuyeres.toFixed(0));
        }

        // Update comprehensive result
        function updateComprehensiveResult(field, value) {
            const element = document.getElementById(`comp-${field}`);
            if (element) {
                if (element.classList.contains('param-value')) {
                    // Handle param-value elements
                    const unitSpan = element.querySelector('.param-unit');
                    if (unitSpan) {
                        element.innerHTML = value + unitSpan.outerHTML;
                    } else {
                        element.textContent = value;
                    }
                } else {
                    // Handle regular input elements
                    element.value = value;
                }
            }
        }

        // Initialize Silicon Calculation
        function initializeSiliconCalculation() {
            // Set initial values from app data
            document.getElementById('slag-sio2').value = appData.siliconData.slagSiO2;
            document.getElementById('slag-cao').value = appData.siliconData.slagCaO;
            document.getElementById('slag-mgo').value = appData.siliconData.slagMgO;
            document.getElementById('slag-al2o3').value = appData.siliconData.slagAl2O3;
            document.getElementById('slag-temp').value = appData.siliconData.slagTemp;
            document.getElementById('hm-temp').value = appData.siliconData.hmTemp;
            document.getElementById('slag-volume').value = appData.siliconData.slagVolume;
            document.getElementById('k-factor').value = appData.siliconData.kFactor;

            // Calculate initial silicon percentage
            calculateSilicon();
        }

        // Calculate Silicon Percentage in Hot Metal
        function calculateSilicon() {
            // Get input values
            const slagSiO2 = parseFloat(document.getElementById('slag-sio2').value) || 0;
            const slagCaO = parseFloat(document.getElementById('slag-cao').value) || 0;
            const slagMgO = parseFloat(document.getElementById('slag-mgo').value) || 0;
            const slagAl2O3 = parseFloat(document.getElementById('slag-al2o3').value) || 0;
            const slagTemp = parseFloat(document.getElementById('slag-temp').value) || 0;
            const hmTemp = parseFloat(document.getElementById('hm-temp').value) || 0;
            const slagVolume = parseFloat(document.getElementById('slag-volume').value) || 0;
            const kFactor = parseFloat(document.getElementById('k-factor').value) || 0;

            // Update app data
            appData.siliconData.slagSiO2 = slagSiO2;
            appData.siliconData.slagCaO = slagCaO;
            appData.siliconData.slagMgO = slagMgO;
            appData.siliconData.slagAl2O3 = slagAl2O3;
            appData.siliconData.slagTemp = slagTemp;
            appData.siliconData.hmTemp = hmTemp;
            appData.siliconData.slagVolume = slagVolume;
            appData.siliconData.kFactor = kFactor;

            // Calculate basicity
            const basicity = (slagCaO + slagMgO) / Math.max(slagSiO2, 0.01);
            document.getElementById('slag-basicity').innerHTML = basicity.toFixed(2) + '<span class="param-unit"></span>';

            // Calculate temperature factor
            const tempFactor = (slagTemp - 1400) / 100;

            // Calculate silicon percentage using the formula:
            // Si% = K Ã— (SiOâ‚‚ in slag) / (Basicity) Ã— f(T)
            const siliconPercentage = kFactor * (slagSiO2 / basicity) * tempFactor;

            // Display result
            document.getElementById('silicon-result').textContent = siliconPercentage.toFixed(2);

            // Update blast params with silicon percentage
            appData.blastParams["Silicon%"] = siliconPercentage;
        }

        // Initialize Shift Production View
        function initializeShiftProductionView() {
            // Check if we have shift data, if not create empty structure
            if (Object.keys(appData.shiftData).length === 0) {
                createEmptyShiftData();
            }

            populateShiftTable('all');
        }

        // Create empty shift data structure for 24 hours
        function createEmptyShiftData() {
            const shifts = [{
                    id: "A",
                    name: "A",
                    hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]
                },
                {
                    id: "B",
                    name: "B",
                    hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]
                },
                {
                    id: "C",
                    name: "C",
                    hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]
                }
            ];

            shifts.forEach(shift => {
                shift.hours.forEach(hour => {
                    const key = `${shift.id}-${hour}`;
                    appData.shiftData[key] = [
                        hour,
                        shift.name,
                        "0", "0", "0", "0", "0", "0", "0", "0", "0", "0",
                        "0", "0", "0", "0", "0"
                    ];
                });
            });
        }

        // Populate shift table with data
        function populateShiftTable(shiftFilter) {
            const tbody = document.getElementById('shift-tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            const shifts = [{
                    id: "A",
                    name: "A",
                    hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]
                },
                {
                    id: "B",
                    name: "B",
                    hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]
                },
                {
                    id: "C",
                    name: "C",
                    hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]
                }
            ];

            let shiftsToShow = shifts;
            if (shiftFilter !== 'all') shiftsToShow = shifts.filter(shift => shift.id === shiftFilter);

            shiftsToShow.forEach(shift => {
                shift.hours.forEach(hour => {
                    const key = `${shift.id}-${hour}`;
                    const values = appData.shiftData[key] || [
                        hour,
                        shift.name,
                        "0", "0", "0", "0", "0", "0", "0", "0", "0", "0",
                        "0", "0", "0", "0", "0"
                    ];

                    const row = document.createElement('tr');
                    row.classList.add(`shift-${shift.id.toLowerCase()}-row`);

                    values.forEach((value, col) => {
                        const cell = document.createElement('td');

                        if (col === 0) {
                            cell.textContent = value;
                        } else if (col === 1) {
                            cell.textContent = value;
                        } else if (col <= 10) {
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = value;
                            input.addEventListener('input', function() {
                                updateShiftEntry(key, col, this.value);
                            });
                            cell.appendChild(input);
                        } else {
                            cell.className = 'calculated';
                            cell.id = `shift-${key}-${col}`;
                            cell.textContent = value;
                        }

                        row.appendChild(cell);
                    });

                    tbody.appendChild(row);
                });
            });

            // Calculate all rows after populating
            calculateAllShiftRows();
        }

        // Update shift entry
        function updateShiftEntry(key, column, value) {
            if (!appData.shiftData[key]) {
                appData.shiftData[key] = [
                    key.split('-')[1],
                    key.split('-')[0],
                    "0", "0", "0", "0", "0", "0", "0", "0", "0", "0",
                    "0", "0", "0", "0", "0"
                ];
            }

            appData.shiftData[key][column] = value;
            calculateShiftRow(key);
        }

        // Calculate a single shift row
        function calculateShiftRow(key) {
            if (!appData.shiftData[key]) return;

            const values = appData.shiftData[key];

            const coke = safeParseFloat(values[2]);
            const sinter = safeParseFloat(values[3]);
            const ironOre = safeParseFloat(values[4]);
            const pellets = safeParseFloat(values[5]);
            const scraps = safeParseFloat(values[6]);
            const nutCoke = safeParseFloat(values[7]);
            const pci = safeParseFloat(values[8]);
            const cbVolume = safeParseFloat(values[9]);
            const o2Volume = safeParseFloat(values[10]);

            const inputs = {
                "coke": coke,
                "sinter": sinter,
                "ironOre": ironOre,
                "pellets": pellets,
                "scraps": scraps,
                "nutCoke": nutCoke,
                "pci": pci
            };

            const hotMetal = calculateHotMetal(inputs);

            const cokeRate = calculateRates("coke", coke, hotMetal);
            const nutCokeRate = calculateRates("nutCoke", nutCoke, hotMetal);
            const pciRate = calculateRates("pci", pci, hotMetal);
            const fuelRate = cokeRate + nutCokeRate + pciRate;

            const spo2Rate = calculateOxygenRate(cbVolume, o2Volume, hotMetal);

            values[11] = hotMetal.toFixed(1);
            values[12] = cokeRate.toFixed(0);
            values[13] = nutCokeRate.toFixed(0);
            values[14] = pciRate.toFixed(0);
            values[15] = fuelRate.toFixed(0);
            values[16] = spo2Rate.toFixed(0);

            appData.shiftData[key] = values;

            // Update the table cells
            for (let col = 11; col <= 16; col++) {
                const cell = document.getElementById(`shift-${key}-${col}`);
                if (cell) cell.textContent = values[col];
            }
        }

        // Calculate all shift rows
        function calculateAllShiftRows() {
            Object.keys(appData.shiftData).forEach(key => {
                calculateShiftRow(key);
            });
        }

        // Calculate hot metal production
        function calculateHotMetal(inputs) {
            let totalFe = 0;

            // Sync material properties with comprehensive data
            syncShiftMaterialProperties();

            Object.keys(inputs).forEach(material => {
                if (appData.shiftMaterialProperties[material]) {
                    const props = appData.shiftMaterialProperties[material];
                    const dryWeight = inputs[material] * (1 - props.moisture / 100);
                    totalFe += dryWeight * (props.fe / 100);
                }
            });

            return totalFe / 0.945;
        }

        // Calculate rates (coke, nut coke, PCI)
        function calculateRates(material, inputVal, hotMetal) {
            inputVal = safeParseFloat(inputVal);
            hotMetal = safeParseFloat(hotMetal);
            if (hotMetal === 0) return 0;

            if (appData.shiftMaterialProperties[material]) {
                const props = appData.shiftMaterialProperties[material];
                const dryWeight = inputVal * (1 - props.moisture / 100);
                return (dryWeight / hotMetal) * 1000;
            }
            return 0;
        }

        // Calculate oxygen rate
        function calculateOxygenRate(cbVolume, o2EnrichmentVolume, hotMetal) {
            cbVolume = safeParseFloat(cbVolume);
            o2EnrichmentVolume = safeParseFloat(o2EnrichmentVolume);
            hotMetal = safeParseFloat(hotMetal);
            if (hotMetal === 0) return 0;

            const totalOxygen = (cbVolume * 0.21) + o2EnrichmentVolume;
            return totalOxygen / hotMetal;
        }

        // Sync shift material properties with comprehensive data
        function syncShiftMaterialProperties() {
            const materialMapping = {
                'COKE': 'coke',
                'SINTER': 'sinter',
                'ORE': 'ironOre',
                'PELLETS': 'pellets',
                'SCRAP': 'scraps',
                'PCI': 'pci',
                'NCOKE': 'nutCoke'
            };

            Object.keys(materialMapping).forEach(materialName => {
                const shiftKey = materialMapping[materialName];
                if (appData.materials[materialName] && appData.shiftMaterialProperties[shiftKey]) {
                    appData.shiftMaterialProperties[shiftKey].moisture = safeParseFloat(appData.materials[materialName].Moisture);
                    appData.shiftMaterialProperties[shiftKey].fe = safeParseFloat(appData.materials[materialName].FE);
                    if ('c' in appData.shiftMaterialProperties[shiftKey]) {
                        appData.shiftMaterialProperties[shiftKey].c = safeParseFloat(appData.materials[materialName].C);
                    }
                }
            });
        }

        // Filter shift columns by shift
        function filterShiftColumns() {
            const shiftFilter = document.getElementById('shift-filter').value;
            populateShiftTable(shiftFilter);
        }

        // Generate sample shift data
        function generateSampleData() {
            if (confirm('This will replace all existing shift data with sample values. Continue?')) {
                const shifts = [{
                        id: "A",
                        name: "A",
                        hours: ["07:00", "08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00"]
                    },
                    {
                        id: "B",
                        name: "B",
                        hours: ["15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00"]
                    },
                    {
                        id: "C",
                        name: "C",
                        hours: ["23:00", "00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00"]
                    }
                ];

                shifts.forEach(shift => {
                    shift.hours.forEach(hour => {
                        const key = `${shift.id}-${hour}`;

                        // Generate random values based on shift
                        let cokeBase, sinterBase, oreBase, pelletsBase;

                        if (shift.id === "A") {
                            cokeBase = 1000;
                            sinterBase = 2600;
                            oreBase = 400;
                            pelletsBase = 440;
                        } else if (shift.id === "B") {
                            cokeBase = 1050;
                            sinterBase = 2700;
                            oreBase = 410;
                            pelletsBase = 450;
                        } else {
                            cokeBase = 980;
                            sinterBase = 2500;
                            oreBase = 390;
                            pelletsBase = 430;
                        }

                        // Add some randomness
                        const randomFactor = 0.9 + Math.random() * 0.2; // 0.9 to 1.1

                        appData.shiftData[key] = [
                            hour,
                            shift.name,
                            (cokeBase * randomFactor).toFixed(0),
                            (sinterBase * randomFactor).toFixed(0),
                            (oreBase * randomFactor).toFixed(0),
                            (pelletsBase * randomFactor).toFixed(0),
                            (80 * randomFactor).toFixed(0),
                            (50 * randomFactor).toFixed(0),
                            (40 * randomFactor).toFixed(0),
                            (150000 * randomFactor).toFixed(0),
                            (10500 * randomFactor).toFixed(0),
                            "0", "0", "0", "0", "0", "0"
                        ];
                    });
                });

                populateShiftTable('all');
                updateCharts();
                alert('Sample data generated successfully!');
            }
        }

        // Export shift data
        function exportShiftData() {
            const data = {
                shiftData: appData.shiftData,
                materialProperties: appData.shiftMaterialProperties,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {
                type: 'application/json'
            });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `shift_production_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            alert('Shift data exported successfully!');
        }

        // Clear shift data
        function clearShiftData() {
            if (confirm('This will clear all shift data. Continue?')) {
                appData.shiftData = {};
                createEmptyShiftData();
                populateShiftTable('all');
                updateCharts();
                alert('All shift data cleared!');
            }
        }

        // Load default data
        function loadDefaultData() {
            const savedDefault = localStorage.getItem('blastFurnaceDefaultData');
            if (savedDefault) {
                defaultData = JSON.parse(savedDefault);
            } else {
                defaultData = JSON.parse(JSON.stringify(initialDefaultData));
            }
        }

        // Save default data
        function saveDefaultData() {
            const newDefaults = {
                materials: JSON.parse(JSON.stringify(appData.materials)),
                inputs: JSON.parse(JSON.stringify(appData.inputs)),
                blastParams: JSON.parse(JSON.stringify(appData.blastParams)),
                hearthData: JSON.parse(JSON.stringify(appData.hearthData)),
                siliconData: JSON.parse(JSON.stringify(appData.siliconData))
            };

            defaultData = newDefaults;
            localStorage.setItem('blastFurnaceDefaultData', JSON.stringify(newDefaults));
            alert('Default values saved successfully!');
        }

        // MODIFIED: Reset to default - now also clears saved data
        function resetToDefault() {
            if (confirm('Are you sure you want to reset all values to default? This will clear all saved data.')) {
                appData.materials = JSON.parse(JSON.stringify(defaultData.materials));
                appData.inputs = JSON.parse(JSON.stringify(defaultData.inputs));
                appData.blastParams = JSON.parse(JSON.stringify(defaultData.blastParams));
                appData.hearthData = JSON.parse(JSON.stringify(defaultData.hearthData));
                appData.siliconData = JSON.parse(JSON.stringify(defaultData.siliconData));
                
                // Clear saved data
                localStorage.removeItem('blastFurnaceSavedData');

                initializeComprehensiveMaterials();
                initializeComprehensiveInputs();
                initializeSiliconCalculation();
                calculateAllComprehensive();

                alert('All values have been reset to default!');
            }
        }

        // Export data
        function exportData() {
            const data = {
                materials: appData.materials,
                inputs: appData.inputs,
                blastParams: appData.blastParams,
                hearthData: appData.hearthData,
                shiftData: appData.shiftData,
                siliconData: appData.siliconData,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {
                type: 'application/json'
            });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `blast_furnace_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            alert('Data exported successfully!');
        }

        // Safe parse float
        function safeParseFloat(value) {
            const parsed = parseFloat(value);
            return isNaN(parsed) ? 0 : parsed;
        }

        // Initialize Charts
        function initializeCharts() {
            // Hot Metal Production by Hour (Line Chart)
            const hotMetalCtx = document.getElementById('hotMetalChart').getContext('2d');
            hotMetalChart = new Chart(hotMetalCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Hot Metal Production (tons)',
                        data: [],
                        borderColor: '#0078d4',
                        backgroundColor: 'rgba(0, 120, 212, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tons'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour'
                            }
                        }
                    }
                }
            });

            // Material Consumption by Shift (Bar Chart)
            const materialConsumptionCtx = document.getElementById('materialConsumptionChart').getContext('2d');
            materialConsumptionChart = new Chart(materialConsumptionCtx, {
                type: 'bar',
                data: {
                    labels: ['Shift A', 'Shift B', 'Shift C'],
                    datasets: [{
                            label: 'Coke',
                            data: [0, 0, 0],
                            backgroundColor: 'rgba(0, 120, 212, 0.7)'
                        },
                        {
                            label: 'Sinter',
                            data: [0, 0, 0],
                            backgroundColor: 'rgba(16, 124, 16, 0.7)'
                        },
                        {
                            label: 'Iron Ore',
                            data: [0, 0, 0],
                            backgroundColor: 'rgba(255, 140, 0, 0.7)'
                        },
                        {
                            label: 'Pellets',
                            data: [0, 0, 0],
                            backgroundColor: 'rgba(0, 183, 195, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Kg'
                            }
                        }
                    }
                }
            });

            // Fuel Rate Comparison (Line Chart)
            const fuelRateCtx = document.getElementById('fuelRateChart').getContext('2d');
            fuelRateChart = new Chart(fuelRateCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                            label: 'Coke Rate',
                            data: [],
                            borderColor: '#0078d4',
                            backgroundColor: 'rgba(0, 120, 212, 0.1)',
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: 'NC Rate',
                            data: [],
                            borderColor: '#16c60c',
                            backgroundColor: 'rgba(22, 198, 12, 0.1)',
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: 'PCI Rate',
                            data: [],
                            borderColor: '#ff8c00',
                            backgroundColor: 'rgba(255, 140, 0, 0.1)',
                            borderWidth: 2,
                            tension: 0.3
                        },
                        {
                            label: 'Fuel Rate',
                            data: [],
                            borderColor: '#e81123',
                            backgroundColor: 'rgba(232, 17, 35, 0.1)',
                            borderWidth: 3,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'kg/THM'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour'
                            }
                        }
                    }
                }
            });

            // Production Efficiency by Shift (Doughnut Chart)
            const efficiencyCtx = document.getElementById('efficiencyChart').getContext('2d');
            efficiencyChart = new Chart(efficiencyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Shift A', 'Shift B', 'Shift C'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(0, 120, 212, 0.7)',
                            'rgba(16, 124, 16, 0.7)',
                            'rgba(216, 59, 1, 0.7)'
                        ],
                        borderColor: [
                            'rgba(0, 120, 212, 1)',
                            'rgba(16, 124, 16, 1)',
                            'rgba(216, 59, 1, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + ' tons';
                                }
                            }
                        }
                    }
                }
            });

            // Update charts with initial data
            updateCharts();
        }

        // Update Charts with current data
        function updateCharts() {
            if (!hotMetalChart || !materialConsumptionChart || !fuelRateChart || !efficiencyChart) {
                return;
            }

            // Prepare data for charts
            const hours = [];
            const hotMetalData = [];
            const cokeRateData = [];
            const ncRateData = [];
            const pciRateData = [];
            const fuelRateData = [];

            const shiftTotals = {
                'A': {
                    coke: 0,
                    sinter: 0,
                    ironOre: 0,
                    pellets: 0,
                    hotMetal: 0
                },
                'B': {
                    coke: 0,
                    sinter: 0,
                    ironOre: 0,
                    pellets: 0,
                    hotMetal: 0
                },
                'C': {
                    coke: 0,
                    sinter: 0,
                    ironOre: 0,
                    pellets: 0,
                    hotMetal: 0
                }
            };

            // Process shift data
            Object.keys(appData.shiftData).forEach(key => {
                const values = appData.shiftData[key];
                const hour = values[0];
                const shift = values[1];

                hours.push(hour);
                hotMetalData.push(safeParseFloat(values[11]));
                cokeRateData.push(safeParseFloat(values[12]));
                ncRateData.push(safeParseFloat(values[13]));
                pciRateData.push(safeParseFloat(values[14]));
                fuelRateData.push(safeParseFloat(values[15]));

                // Accumulate shift totals
                if (shiftTotals[shift]) {
                    shiftTotals[shift].coke += safeParseFloat(values[2]);
                    shiftTotals[shift].sinter += safeParseFloat(values[3]);
                    shiftTotals[shift].ironOre += safeParseFloat(values[4]);
                    shiftTotals[shift].pellets += safeParseFloat(values[5]);
                    shiftTotals[shift].hotMetal += safeParseFloat(values[11]);
                }
            });

            // Update Hot Metal Production Chart
            hotMetalChart.data.labels = hours;
            hotMetalChart.data.datasets[0].data = hotMetalData;
            hotMetalChart.update();

            // Update Material Consumption Chart
            materialConsumptionChart.data.datasets[0].data = [
                shiftTotals['A'].coke,
                shiftTotals['B'].coke,
                shiftTotals['C'].coke
            ];
            materialConsumptionChart.data.datasets[1].data = [
                shiftTotals['A'].sinter,
                shiftTotals['B'].sinter,
                shiftTotals['C'].sinter
            ];
            materialConsumptionChart.data.datasets[2].data = [
                shiftTotals['A'].ironOre,
                shiftTotals['B'].ironOre,
                shiftTotals['C'].ironOre
            ];
            materialConsumptionChart.data.datasets[3].data = [
                shiftTotals['A'].pellets,
                shiftTotals['B'].pellets,
                shiftTotals['C'].pellets
            ];
            materialConsumptionChart.update();

            // Update Fuel Rate Chart
            fuelRateChart.data.labels = hours;
            fuelRateChart.data.datasets[0].data = cokeRateData;
            fuelRateChart.data.datasets[1].data = ncRateData;
            fuelRateChart.data.datasets[2].data = pciRateData;
            fuelRateChart.data.datasets[3].data = fuelRateData;
            fuelRateChart.update();

            // Update Efficiency Chart
            efficiencyChart.data.datasets[0].data = [
                shiftTotals['A'].hotMetal,
                shiftTotals['B'].hotMetal,
                shiftTotals['C'].hotMetal
            ];
            efficiencyChart.update();
        }

        // Initialize Stock Level Calculator
        function initializeStockLevelCalculator() {
            // Initialize particles
            createParticles();

            // Set up charging rate editable controls
            const chargingRateInput = document.getElementById('chargingRateInput');
            const chargingRateSlider = document.getElementById('chargingRate');
            const chargingRateValue = document.getElementById('chargingRateValue');

            // Sync input and slider
            chargingRateInput.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (!isNaN(value) && value >= 50 && value <= 500) {
                    chargingRateSlider.value = value;
                    chargingRateValue.textContent = value + ' mÂ³/hr';
                    calculateAllStockLevel();
                }
            });

            chargingRateSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                chargingRateInput.value = value;
                chargingRateValue.textContent = value + ' mÂ³/hr';
                calculateAllStockLevel();
            });

            // Add event listeners for real-time updates
            const inputs = document.querySelectorAll('.stock-level-calculator input[type="number"], .stock-level-calculator input[type="range"]');
            inputs.forEach(input => {
                input.addEventListener('input', calculateAllStockLevel);
            });

            // Add event listeners for scenario title changes
            const titleInputs = document.querySelectorAll('.stock-level-calculator .scenario-title-win11');
            titleInputs.forEach(input => {
                input.addEventListener('input', calculateAllStockLevel);
            });

            // Initial calculation
            setTimeout(() => {
                calculateAllStockLevel();
            }, 300);
        }

        // Create particles for background animation
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 25 + 's';
                particle.style.animationDuration = (20 + Math.random() * 10) + 's';

                // Random gradient colors
                const gradients = [
                    'var(--gradient-ocean)',
                    'var(--gradient-sunset)',
                    'var(--gradient-forest)',
                    'var(--gradient-fire)',
                    'var(--gradient-aurora)',
                    'var(--gradient-cosmic)'
                ];
                particle.style.background = gradients[Math.floor(Math.random() * gradients.length)];

                particlesContainer.appendChild(particle);
            }
        }

        // Validate input field for stock level calculator
        function validateInput(inputId, min, max) {
            const input = document.getElementById(inputId);
            const value = parseFloat(input.value);
            const errorElement = document.getElementById(inputId + '-error');

            if (isNaN(value) || value < min || value > max) {
                input.classList.add('is-invalid-win11');
                errorElement.classList.add('show');
                return false;
            } else {
                input.classList.remove('is-invalid-win11');
                errorElement.classList.remove('show');
                return true;
            }
        }

        // Validate all inputs for stock level calculator
        function validateAllInputsStockLevel() {
            let isValid = true;

            // Validate all number inputs
            const inputs = [{
                    id: 'furnaceDiameter',
                    min: 5,
                    max: 20
                },
                {
                    id: 'burdenDensity',
                    min: 1,
                    max: 3
                },
                {
                    id: 'productionRate',
                    min: 1000,
                    max: 15000
                },
                {
                    id: 'specificConsumption',
                    min: 1,
                    max: 3
                },
                {
                    id: 'chargingRate',
                    min: 50,
                    max: 500
                },
                {
                    id: 'blastVolume',
                    min: 50000,
                    max: 300000
                },
                {
                    id: 'oxygenVolume',
                    min: 0,
                    max: 50000
                }
            ];

            inputs.forEach(input => {
                if (!validateInput(input.id, input.min, input.max)) {
                    isValid = false;
                }
            });

            // Validate target inputs based on mode
            if (calculationMode === '') {
                if (!validateInput('targetStockRise', 0.5, 30)) {
                    isValid = false;
                }
            } else {
                if (!validateInput('targetTime', 1, 24)) {
                    isValid = false;
                }
            }

            return isValid;
        }

        // Set calculation mode for stock level calculator
        function setCalculationMode(mode) {
            calculationMode = mode;

            // Update UI
            if (mode === '') {
                document.getElementById('Mode').classList.add('active');
                document.getElementById('timeMode').classList.remove('active');
                document.getElementById('InputContainer').style.display = 'block';
                document.getElementById('timeInputContainer').style.display = 'none';
            } else {
                document.getElementById('Mode').classList.remove('active');
                document.getElementById('timeMode').classList.add('active');
                document.getElementById('InputContainer').style.display = 'none';
                document.getElementById('timeInputContainer').style.display = 'block';
            }

            // Recalculate with new mode
            calculateAllStockLevel();
        }

        // Animate number changes for stock level calculator
        function animateNumber(element, start, end, duration, decimals = 1) {
            const startTime = performance.now();
            const updateNumber = (currentTime) => {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = start + (end - start) * progress;
                element.textContent = current.toFixed(decimals);

                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            };
            requestAnimationFrame(updateNumber);
        }

        // Calculate all values for stock level calculator
        function calculateAllStockLevel() {
            // Validate all inputs first
            if (!validateAllInputsStockLevel()) {
                return;
            }

            // Get input values
            const furnaceDiameter = parseFloat(document.getElementById('furnaceDiameter').value);
            const burdenDensity = parseFloat(document.getElementById('burdenDensity').value);
            const productionRate = parseFloat(document.getElementById('productionRate').value);
            const specificConsumption = parseFloat(document.getElementById('specificConsumption').value);
            const chargingRate = parseFloat(document.getElementById('chargingRate').value);
            const blastVolume = parseFloat(document.getElementById('blastVolume').value);
            const oxygenVolume = parseFloat(document.getElementById('oxygenVolume').value);

            // Get target values based on calculation mode
            let targetStockRise, targetTime;

            if (calculationMode === '') {
                targetStockRise = parseFloat(document.getElementById('targetStockRise').value);
                targetTime = null; // Will be calculated
            } else {
                targetTime = parseFloat(document.getElementById('targetTime').value);
                targetStockRise = null; // Will be calculated
            }

            // Store calculation data
            calculationData = {
                furnaceDiameter,
                burdenDensity,
                productionRate,
                specificConsumption,
                chargingRate,
                targetStockRise,
                targetTime,
                blastVolume,
                oxygenVolume,
                calculationMode
            };

            // Calculate baseline values
            const crossSectionalArea = Math.PI * Math.pow(furnaceDiameter / 2, 2);
            const productionRateHourly = productionRate / 24;

            const burdenConsumptionRate = productionRateHourly * specificConsumption;
            const volumetricConsumptionRate = burdenConsumptionRate / burdenDensity;
            const linearConsumptionRate = volumetricConsumptionRate / crossSectionalArea;

            const chargingRateLinear = chargingRate / crossSectionalArea;
            const netFillRate = chargingRateLinear - linearConsumptionRate;

            // Calculate time or stock rise based on mode
            let timeToFill, stockRise;
            if (calculationMode === '') {
                timeToFill = targetStockRise / netFillRate;
                stockRise = targetStockRise;

                // Update the time input field
                document.getElementById('targetTime').value = timeToFill.toFixed(1);
            } else {
                stockRise = targetTime * netFillRate;
                timeToFill = targetTime;

                // Update the stock rise input field
                document.getElementById('targetStockRise').value = stockRise.toFixed(1);
            }

            // Update baseline values with animation
            animateNumber(document.getElementById('paramDiameter'), 0, furnaceDiameter, 600, 1);
            animateNumber(document.getElementById('paramArea'), 0, crossSectionalArea, 600, 2);
            animateNumber(document.getElementById('paramDensity'), 0, burdenDensity, 600, 2);
            animateNumber(document.getElementById('paramProduction'), 0, productionRateHourly, 600, 1);
            animateNumber(document.getElementById('burdenConsumption'), 0, burdenConsumptionRate, 600, 1);
            animateNumber(document.getElementById('volumetricConsumption'), 0, volumetricConsumptionRate, 600, 1);
            animateNumber(document.getElementById('linearConsumption'), 0, linearConsumptionRate, 600, 2);
            animateNumber(document.getElementById('chargingRateDisplay'), 0, chargingRate, 600, 0);
            animateNumber(document.getElementById('netFillRate'), 0, netFillRate, 600, 2);
            animateNumber(document.getElementById('timeToFill'), 0, timeToFill, 600, 1);

            // Update calculation result text based on mode
            const resultText = document.getElementById('calculationResultText');
            if (calculationMode === '') {
                resultText.innerHTML = `Time to achieve <span class="badge-win11 badge-win11-gradient">${stockRise.toFixed(1)}m</span> rise: <strong>${timeToFill.toFixed(1)}</strong> hours`;
            } else {
                resultText.innerHTML = `Stock rise achievable in <span class="badge-win11 badge-win11-gradient">${timeToFill.toFixed(1)}hrs</span>: <strong>${stockRise.toFixed(1)}</strong> meters`;
            }

            // Update progress bar
            const progress = Math.min((netFillRate / 2) * 100, 100);
            setTimeout(() => {
                document.getElementById('Progress').style.width = progress + '%';
                document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            }, 300);

            // Calculate scenarios
            const scenarios = [];
            for (let i = 1; i <= 3; i++) {
                const reductionPercent = parseFloat(document.getElementById(`scenario${i}Reduction`).value);
                const scenarioProductionRate = productionRateHourly * (1 - reductionPercent / 100);
                const scenarioBurdenConsumption = scenarioProductionRate * specificConsumption;
                const scenarioVolumetricConsumption = scenarioBurdenConsumption / burdenDensity;
                const scenarioLinearConsumption = scenarioVolumetricConsumption / crossSectionalArea;
                const scenarioNetFillRate = chargingRateLinear - scenarioLinearConsumption;

                // Calculate scenario time or stock rise based on mode
                let scenarioTime, scenarioStockRise;
                if (calculationMode === '') {
                    scenarioTime = targetStockRise / scenarioNetFillRate;
                    scenarioStockRise = targetStockRise;
                } else {
                    scenarioStockRise = targetTime * scenarioNetFillRate;
                    scenarioTime = targetTime;
                }

                // Update badge and value display
                const badgeElement = document.getElementById(`scenario${i}Badge`);
                badgeElement.textContent = `${reductionPercent}%`;

                // Update badge color based on reduction level
                badgeElement.classList.remove('badge-win11-success', 'badge-win11-warning', 'badge-win11-danger');
                if (reductionPercent === 0) {
                    badgeElement.classList.add('badge-win11-success');
                } else if (reductionPercent <= 30) {
                    badgeElement.classList.add('badge-win11-warning');
                } else {
                    badgeElement.classList.add('badge-win11-danger');
                }

                document.getElementById(`scenario${i}ReductionValue`).textContent = `${reductionPercent}%`;

                // Update description
                updateScenarioDescription(i, reductionPercent, blastVolume, oxygenVolume);

                // Animate values
                animateNumber(document.getElementById(`scenario${i}Production`), 0, scenarioProductionRate, 600, 1);
                animateNumber(document.getElementById(`scenario${i}NetFill`), 0, scenarioNetFillRate, 600, 2);
                animateNumber(document.getElementById(`scenario${i}Time`), 0, scenarioTime, 600, 1);

                scenarios.push({
                    title: document.getElementById(`scenario${i}Title`).value,
                    time: scenarioTime,
                    netFillRate: scenarioNetFillRate,
                    reductionPercent: reductionPercent,
                    stockRise: scenarioStockRise
                });
            }

            // Find optimal scenario
            const times = [timeToFill, ...scenarios.map(s => s.time)];
            const minTimeIndex = times.indexOf(Math.min(...times));
            const scenarioNames = ["Baseline", ...scenarios.map(s => s.title)];

            // Update optimal scenario display
            if (minTimeIndex === 0) {
                document.getElementById('optimalScenarioName').textContent = 'Baseline';
                document.getElementById('optimalImpact').textContent = '0%';
            } else {
                document.getElementById('optimalScenarioName').textContent = scenarios[minTimeIndex - 1].title;
                document.getElementById('optimalImpact').textContent = '-' + scenarios[minTimeIndex - 1].reductionPercent + '%';
            }

            animateNumber(document.getElementById('optimalTime'), 0, times[minTimeIndex], 600, 1);
            animateNumber(document.getElementById('optimalRate'), 0, minTimeIndex === 0 ? netFillRate : scenarios[minTimeIndex - 1].netFillRate, 600, 2);

            // Update chart
            updateStockLevelChart(times, scenarioNames, stockRise);

            // Store calculated values
            calculationData.calculated = {
                crossSectionalArea,
                productionRateHourly,
                burdenConsumptionRate,
                linearConsumptionRate,
                netFillRate,
                timeToFill,
                stockRise
            };
        }

        // Update scenario description for stock level calculator
        function updateScenarioDescription(scenarioNumber, reductionPercent, blastVolume, oxygenVolume) {
            const descriptionElement = document.getElementById(`scenario${scenarioNumber}Description`);
            let newDescription = '';

            switch (scenarioNumber) {
                case 1:
                    const newBlastVolume = Math.round(blastVolume * (1 - reductionPercent / 100));
                    newDescription = `Reduce blast volume by ${reductionPercent}% (to ${newBlastVolume.toLocaleString()} NmÂ³/hr)`;
                    break;
                case 2:
                    const newOxygenVolume = Math.round(oxygenVolume * (1 - reductionPercent / 100));
                    newDescription = `Reduce oxygen by ${reductionPercent}% (to ${newOxygenVolume.toLocaleString()} NmÂ³/hr)`;
                    break;
                case 3:
                    newDescription = `Combined approach with ${reductionPercent}% total reduction`;
                    break;
            }

            descriptionElement.textContent = newDescription;
        }

        // Update chart for stock level calculator
        function updateStockLevelChart(times, scenarioNames, targetValue) {
            const canvas = document.getElementById('resultsChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            if (resultsChart) {
                resultsChart.destroy();
            }

            // Set chart label based on calculation mode
            let chartLabel;
            if (calculationMode === '') {
                chartLabel = `Time to Fill ${targetValue.toFixed(1)}m (hours)`;
            } else {
                chartLabel = `Stock Rise in ${targetValue.toFixed(1)}hrs (meters)`;
            }

            // Windows 11 color palette
            const colors = [
                'rgba(0, 120, 212, 0.7)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(236, 72, 153, 0.7)',
                'rgba(16, 185, 129, 0.7)'
            ];

            const borderColors = [
                'rgba(0, 120, 212, 1)',
                'rgba(139, 92, 246, 1)',
                'rgba(236, 72, 153, 1)',
                'rgba(16, 185, 129, 1)'
            ];

            const chartConfig = {
                type: currentChartType,
                data: {
                    labels: scenarioNames,
                    datasets: [{
                        label: chartLabel,
                        data: times,
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 2,
                        tension: 0.4,
                        borderRadius: currentChartType === 'bar' ? 4 : 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    weight: '600',
                                    size: 12
                                },
                                padding: 12,
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            titleColor: '#323130',
                            bodyColor: '#605e5c',
                            borderColor: '#e1e1e1',
                            borderWidth: 1,
                            titleFont: {
                                family: "'Segoe UI Variable', sans-serif",
                                weight: '600',
                                size: 12
                            },
                            bodyFont: {
                                family: "'Segoe UI Variable', sans-serif",
                                size: 11
                            },
                            padding: 8,
                            cornerRadius: 4,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    if (calculationMode === '') {
                                        return `Time: ${context.raw.toFixed(2)} hours`;
                                    } else {
                                        return `Stock Rise: ${context.raw.toFixed(2)} meters`;
                                    }
                                }
                            }
                        }
                    },
                    scales: currentChartType !== 'radar' ? {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: calculationMode === '' ? 'Time (hours)' : 'Stock Rise (meters)',
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    weight: '600',
                                    size: 12
                                },
                                color: '#605e5c'
                            },
                            grid: {
                                color: '#f3f2f1',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    size: 10
                                },
                                color: '#605e5c'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Scenarios',
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    weight: '600',
                                    size: 12
                                },
                                color: '#605e5c'
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    size: 10
                                },
                                color: '#605e5c'
                            }
                        }
                    } : {
                        r: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: calculationMode === '' ? 'Time (hours)' : 'Stock Rise (meters)',
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    weight: '600',
                                    size: 12
                                }
                            },
                            grid: {
                                color: '#f3f2f1'
                            },
                            pointLabels: {
                                font: {
                                    family: "'Segoe UI Variable', sans-serif",
                                    size: 10
                                },
                                color: '#605e5c'
                            }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeInOutQuart'
                    }
                }
            };

            resultsChart = new Chart(ctx, chartConfig);
        }

        // Update chart type for stock level calculator
        function updateChartType(type) {
            currentChartType = type;

            // Update button states
            document.querySelectorAll('.chart-option-btn-win11').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.chart-option-btn-win11').classList.add('active');

            // Recalculate and update chart
            calculateAllStockLevel();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            initViewSwitcher();
        });
    </script>
</body>

</html>